{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Filter definitions",
    "description": "Independent file for filter description.",
    "type": "object",
    "required": [ "format_version"],
    "properties": {
        "format_version" : {"$ref" : "#/format_version"},
        "revision" :       {"$ref" : "definitions.schema.json#/revision"},
        "yaml_anchors" :   {"$ref" : "definitions.schema.json#/yaml_anchors"},
        "notes" :          {"$ref": "definitions.schema.json#/note_list"},
        "filter" :         {"$ref" : "#/definitions/filter"}
    },
    "additionalProperties" : false,
    "format_version" : {
        "type": "string",
        "anyOf": [
            {"pattern": "^1\\.0$"},
            {"$ref": "definitions.schema.json#/format_version"}
        ]
    },
    "definitions": {
       "filter": {
            "type" : "object",
            "required" : ["type"],
            "properties": {
                "type": {
                    "enum": [
                        "PolesZeros",
                        "FIR",
                        "Coefficients",
                        "ResponseList",
                        "Polynomial",
                        "ADConversion",
                        "Analog",
                        "Digital"
                    ]
                }
            },
            "if": {
                "properties": {"type": {"const": "PolesZeros"}},
                "required": ["type"]
            },
            "then": {"$ref": "#/definitions/POLESZEROS"},
            "else": { 
                "if": {
                    "properties": {"type": {"const": "FIR"}},
                    "required": ["type"]
                },
                "then": {"$ref": "#/definitions/FIR"},
                "else": { 
                    "if": {
                        "properties": {"type": {"const": "Coefficients"}},
                        "required": ["type"]
                    },
                    "then": {"$ref": "#/definitions/COEFFICIENTS"},
                    "else": {
                        "if": {
                            "properties": {"type": {"const": "ResponseList"}},
                            "required": ["type"]
                        },
                        "then": {"$ref": "#/definitions/RESPONSELIST"},
                        "else": {
                            "if": {
                                "properties": {"type": {"const": "Polynomial"}},
                                "required": ["type"]
                            },
                            "then": {"$ref": "#/definitions/POLYNOMIAL"},
                            "else": {
                                "if": {
                                    "properties": {"type": {"const": "ADConversion"}},
                                    "required": ["type"]
                                },
                                "then": {"$ref": "#/definitions/A2D"},
                                "else": {
                                    "if": {
                                        "properties": {"type": {"const": "Analog"}},
                                        "required": ["type"]
                                    },
                                    "then": {"$ref": "#/definitions/ANALOG"},
                                    "else": {
                                        "if": {
                                            "properties": {"type": {"const": "Digital"}},
                                            "required": ["type"]
                                        },
                                        "then": {"$ref": "#/definitions/DIGITAL"}
                                    }
                                }
                            }
                        }
                    }
                 }
             }
        },
        "POLESZEROS": {
            "type" : "object",
            "description" : "Poles-zeros response formulation",
            "required" : ["type", "poles", "zeros"],
            "properties": {
                "type":                    {"enum": ["PolesZeros"] },
                "offset":                  {"type": "number"},
                "transfer_function_type":  {"$ref": "#/definitions/pz_units"},
                "normalization_frequency": {"$ref": "#/definitions/norm_freq"},
                "normalization_factor":    {"$ref": "#/definitions/norm_fact"},
                "poles":                   {"$ref": "#/definitions/pole_list"},
                "zeros":                   {"$ref": "#/definitions/zero_list"}
            },
            "additionalProperties": false
        },
        "FIR": {
            "type" : "object",
            "description" : "FIR response formulation",
            "required": ["type", "symmetry", "coefficients", "offset"],
            "properties" : {
                "type":                 {"enum": ["FIR"] },
                "offset":               {"type": "number"},
                "symmetry":             {"$ref": "#/definitions/symmetry"},
                "coefficient_divisor":  {"type": "number", "description": "number to divide coefficients by to get sum=1"},
                "coefficients":         {"$ref": "#/definitions/coefficient_list"}
            },
            "additionalProperties": false
        },
        "COEFFICIENTS": {
            "type" : "object",
            "description" : "Coefficients response formulation (often used for FIRs)",
            "required" : ["type", "numerator_coefficients", "denominator_coefficients"],
            "properties" : {
                "type":                     {"enum": ["Coefficients"]},
                "offset":                   {"type": "number"},
                "transfer_function_type":   {"$ref": "#/definitions/coefficients_transfer_function_type"},
                "numerator_coefficients":   {"$ref": "#/definitions/coefficient_list"},
                "denominator_coefficients": {"$ref": "#/definitions/coefficient_list"}
            },
            "additionalProperties": false
        },
        "RESPONSELIST": {
            "type" : "object",
            "description" : "Response list formulation",
            "required" : [ "type", "elements" ],
            "properties" : {
                "type":     {"enum": ["ResponseList"]},
                "offset":   {"type": "number"},
                "elements": {"$ref": "#/definitions/response_element_list"}
            },
            "additionalProperties": false
        },
        "POLYNOMIAL": {
            "type": "object",
            "offset": {"type": "number"},
            "description": "NOT IMPLEMENTED",
            "required": ["type"],
            "properties": {
                "type": {"enum": ["Polynomial"]}
            },
            "additionalProperties": false
        },
        "A2D": {
            "type": "object",
            "offset": {"type": "number"},
            "description": "A/D specifics",
            "required": ["type"],
            "properties" : {
                "type":              {"enum": ["ADConversion"]},
                "input_full_scale":  {"$ref": "#/definitions/AD_full_scale"},
                "output_full_scale": {"$ref": "#/definitions/AD_full_scale"}
            },
            "additionalProperties": false
        },
        "ANALOG": {
            "type": "object",
            "offset": {"type": "number"},
            "description": "ANALOG filter (map into PoleZeros with no poles or zeros)",
            "required": ["type"],
            "properties" : {
                "type": {"enum": ["Analog"]}
            },
            "additionalProperties": false
        },
        "DIGITAL": {
            "type": "object",
            "offset": {"type": "number"},
            "description": "DIGITAL filter (map into Coefficients with no coefficients)",
            "required": ["type"],
            "properties" : {
                "type": {"enum": ["Digital"]}
            },
            "additionalProperties": false
        },
        "filter_wo_required_fields": {
             "type" : "object",
             "description" : "Generic filter for attribute modifications in channel_modifications",
             "properties": {
                "type":                    {"enum": ["PolesZeros", "FIR", "Coefficients", "ResponseList", "ADConversion", "Analog", "Digital"]},
                "offset":                  {"type": "number"},
                "transfer_function_type":  {"$ref": "#/definitions/pz_units"},
                "normalization_frequency": {"$ref": "#/definitions/norm_freq"},
                "normalization_factor":    {"$ref": "#/definitions/norm_fact"},
                "poles":                   {"$ref": "#/definitions/pole_list"},
                "zeros":                   {"$ref": "#/definitions/zero_list"},
                "symmetry":                {"$ref": "#/definitions/symmetry"},
                "coefficient_divisor":     {"type": "number"},
                "coefficients":            {"$ref": "#/definitions/coefficient_list"},
                "numerator_coefficients":  {"$ref": "#/definitions/coefficient_list"},
                "denominator_coefficients":{"$ref": "#/definitions/coefficient_list"},
                "elements":                {"$ref": "#/definitions/response_element_list"}, 
                "input_full_scale":        {"$ref": "#/definitions/AD_full_scale"},
                "output_full_scale":       {"$ref": "#/definitions/AD_full_scale"}
             },
             "additionalProperties": false        
        },
        "pz_units": {
            "type" : "string",
            "enum" : ["LAPLACE (RADIANS/SECOND)", "LAPLACE (HERTZ)", "DIGITAL (Z-TRANSFORM)"],
            "default" : "LAPLACE (RADIANS/SECOND)"
        },
        "norm_freq": {
            "type": "number",
            "description": "If undefined, will use gain:frequency",
            "minimum" : 0.0
        },
        "norm_fact": {
            "type": "number",
            "description": "If undefined, will be calculated from normalization_frequency and poles and zeros",
            "minimum" : 0.0
        },
        "pole_list": {
            "description": "Instrument poles (rad/s)",
            "type": "array",
            "items": { "$ref" : "#/definitions/complex_number"}
        },
        "zero_list": {
            "description": "Instrument zeros (rad/s)",
            "type": "array",
            "items": { "$ref" : "#/definitions/complex_number"}
        },
        "complex_number": {
            "type":"array",
            "description" : "real and complex parts",
            "minItems" : 2, "maxItems" : 2,
            "items": { "type" : "number" }
        },
        "symmetry": {
            "type": "string",
            "enum": ["NONE", "EVEN", "ODD"]
        },
        "coefficient_list": {
            "type": "array",
            "minItems": 0,
            "items" : { "type" : "number" }
        },
        "coefficients_transfer_function_type": {
            "type" : "string",
            "enum" : [ "ANALOG (RADIANS/SECOND)", "ANALOG (HERTZ)", "DIGITAL"]
        },
        "response_element_list": {
            "type" : "array",
            "items" : {
                "type" : "array",
                "description" : "[frequency (Hz), amplitude, phase (degrees)]",
                "minItems": 3, "maxItems": 3
            }
        },
        "AD_full_scale": {
            "type": "number",
            "description": "Used for ADConversion, ..."
        }
    }
}
