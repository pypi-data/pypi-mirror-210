{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Station",
    "description": "A seismological station",
    "type": "object",
    "required": ["format_version","station" ],
    "properties": {
        "format_version": {"$ref": "#/format_version"},
        "revision":       {"$ref": "definitions.schema.json#/revision"},
        "yaml_anchors":   {"$ref": "definitions.schema.json#/yaml_anchors"},
        "notes" :         {"$ref": "definitions.schema.json#/note_list"},
        "station":        {"$ref": "#/definitions/station"}
    },
    "additionalProperties" : false,
    "format_version" : {
        "type": "string",
        "anyOf": [
            {"pattern": "^1\\.0$"},
            {"$ref": "definitions.schema.json#/format_version"}
        ]
    },
    "definitions" : {
        "station" : {
            "type" : "object",
            "description" : "OBS station",
            "required": [
                "site",
                "start_date",
                "end_date",
                "locations",
                "location_code"
            ],
            "properties": {
                "site":              {"type": "string", "minLength" : 1},
                "end_date":          {"$ref": "definitions.schema.json#/date-time-Z"},
                "start_date":        {"$ref": "definitions.schema.json#/date-time-Z"},
                "location_code":     {"$ref": "#/definitions/location_code"},
                "locations":         {"$ref": "#/definitions/locations_map"},
                "instrumentation":   {"$ref": "instrumentation.schema.json#/definitions/instrumentation"}, 
                "serial_number":     {"type": "string"}, 
                "operator":          {"$ref": "definitions.schema.json#/operator"},
                "processing":        {"$ref": "#/definitions/processing_list"},
                "notes" :            {"$ref": "definitions.schema.json#/note_list"},
                "comments":          {"$ref" : "definitions.schema.json#/note_list"},
                "extras":            {"$ref" : "definitions.schema.json#/extras"},
                "restricted_status": {"type": "string",
                                      "enum": ["open", "closed", "partial", "unknown"]},
                "channel_modifications": {"$ref": "#/definitions/channel_mods"}
            },
            "additionalProperties": false
        },
       "channel_mods": {  
            "type": "object",
            "description": "individual changes specified by das channel",
            "patternProperties": {
                   "^[N, E, Z, 1, 2, 3, H, \\*]-[0-9, \\*]+$": { "$ref": "#/definitions/channel_modif"},
                   "^[N, E, Z, 1, 2, 3, H, \\*]": { "$ref": "#/definitions/channel_modif"}
            },
            "additionalProperties": false
        }, 
        "channel_modif": { 
            "type": "object",
            "description": "DAS channel, modifications",
            "properties" : {
                "orientation_code": {"$ref": "instrumentation.schema.json#/definitions/orientation_code"},
                "datalogger" :      {"$ref": "datalogger.schema.json#/definitions/datalogger_modifier"},
                "preamplifier":     {"$ref": "preamplifier.schema.json#/definitions/preamplifier_modifier"},
                "sensor" :          {"$ref": "sensor.schema.json#/definitions/sensor_modifier"},
                "datalogger_configuration" :  { 
                    "type": "string",
                    "description": "configuration selector for datalogger, preamplifier or sensor"
                 },
                 "preamplifier_configuration":      {
                    "type": "string",
                    "description": "configuration selector for datalogger, preamplifier or sensor"
                 },
                 "sensor_configuration" :           {
                    "type": "string",
                    "description": "configuration selector for datalogger, preamplifier or sensor"
                 }
            },
            "additionalProperties" : false
        },
        "location_code" : {
            "type" : "string",
            "description" : "SEED location code",
            "pattern" : "^[0-9]{2}$"
        },
        "locations_map" : {
            "type" : "object",
            "description" : "sensor position by location code (two digits)",
            "patternProperties": {
                "^[0-9]{2}$": { "$ref": "#/definitions/location_specification" }
            }
        },
         "location_specification": {
            "type" : "object",
            "required": [
                "base",
                "position"
            ],
            "properties": {
                "base":      {"$ref": "#/definitions/location_base"},
                "position" : {"$ref": "#/definitions/GeoJSON" }
            },
            "additionalProperties" : false
        },
        "location_base": {"$ref": "location_base.schema.json#/definitions/location_base"},
        "instrumentation_list": {
           "type": "array",
           "description":" list of instrumentation",
           "minItems" : 1,
           "items" : {"$ref": "#/definitions/instrumentation"}
        },
                
        "processing_list": {
            "type": "array",
            "description": "other information",
            "items": {
                "type": "object",
                "description": "other informations that will be appear as comments ",
                "properties": {
                    "clock_correction_linear": {"$ref": "#/definitions/clock_correction_linear"},
                    "clock_correction_leapsecond":   {"$ref": "#/definitions/clock_correction_leapsecond"}
                },
                "additionalProperties" : false
            }
        },
        "clock_correction_linear": {
            "type" : "object",
            "description" : "Linear clock drift observed and any correction applied",
            "required" : [
                "time_base",
                "reference",
                "start_sync_reference",
                "start_sync_instrument",
                "end_sync_reference",
                "end_sync_instrument"
            ],
            "properties" : {
                "time_base" :             {"type": "string","description" : "time base used in OBS"},
                "reference" :             {"$ref": "#/definitions/synchronization_reference"},
                "start_sync_reference" :  {"$ref": "definitions.schema.json#/date-time-Z" },
                "start_sync_instrument" : {"$ref": "#/definitions/start_sync_instrument" },
                "end_sync_reference" :    {"$ref": "definitions.schema.json#/date-time-Z" },
                "end_sync_instrument" :   {"$ref": "definitions.schema.json#/date-time-Z" }
            },
            "additionalProperties" : false
        },
        "clock_correction_leapsecond" : {
                "type" : "object",
                "description" : "Leap-second information",
                "required" : ["time", "type", "corrected_in_end_sync"],
                "properties" : {
                    "time" :                 {"$ref": "definitions.schema.json#/date-time-Z" },
                    "type" :                 {"$ref": "#/definitions/lpsec_type"},
                    "description" :          {"$ref": "#/definitions/lpsec_description" },
                    "corrected_in_end_sync": {"$ref": "#/definitions/lpsec_corrected_in_end_sync"},
                    "corrected_in_basic_miniseed": {"$ref": "#/definitions/lpsec_corrected_in_basic_miniseed" }
                },
                "additionalProperties": false
        },
        "synchronization_reference":  {
            "type": "string",
            "description": "time reference used for synchronization (for example: 'GNSS', or 'ambient noise correlation')"
        },
        "start_sync_instrument": {
            "if": {"type": "integer"},
            "then": {
                "minimum": 0,
                "maximum": 0,
                "description": "sets start_sync_instrument equal to to start_sync_reference"
            },
            "else": {"$ref": "definitions.schema.json#/date-time-Z"}
        },
       "lpsec_type" : {
            "type" : "string",
            "description" : "Leapsecond direction",
            "enum" : ["+","-"]
        },
        "lpsec_description" : {
            "type": "string",
            "enum": [
                "Positive leapsecond (a 61-second minute)",
                "Negative leapsecond (a 59-second minute)"
            ]
        },
        "lpsec_corrected_in_end_sync" : {
            "type": "boolean",
            "description": "True if end_sync_instrument was corrected for the leap second (subtracted one second if positive leapsecond, added one if negative)"
        },
        "lpsec_corrected_in_basic_miniseed" : {
            "type": "boolean",
            "description": "True if basic miniseed data is already corrected for the leap second"
        },
        "GeoJSON": {
            "type": "object",
            "description": "Object position: lat and lon in deg, elevation in m",
            "required": ["lat","lon","elev"],
            "properties": {
                "lat":  {"type": "number"},
                "lon":  {"type": "number"},
                "elev": {"type" :"number"}
            },
            "additionalProperties" : false
        }
    }
}
