"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{92306:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(40039),o=function(e,t){var n,o={},i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var u=n.value,a=t(u);a in o?o[a].push(u):o[a]=[u]}}catch(s){i.e(s)}finally{i.f()}return o}},81582:function(e,t,n){n.d(t,{DJ:function(){return i},LZ:function(){return r},Nn:function(){return f},Ny:function(){return l},Q4:function(){return o},RQ:function(){return a},SO:function(){return s},T0:function(){return _},iJ:function(){return c},pB:function(){return u}});var r=32143==n.j?["migration_error","setup_error","setup_retry"]:null,o=32143==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,i=function(e,t,n){var r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((function(e){return t(e)}),r)},u=function(e,t){var n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get_matching"},n))},a=function(e,t){return e.callWS({type:"config_entries/get",entry_id:t})},s=function(e,t,n){return e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n))},c=function(e,t){return e.callApi("DELETE","config/config_entries/entry/".concat(t))},f=function(e,t){return e.callApi("POST","config/config_entries/entry/".concat(t,"/reload"))},l=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"})},_=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null})}},55424:function(e,t,n){n.d(t,{Bm:function(){return w},Cj:function(){return W},G9:function(){return I},Jj:function(){return L},KU:function(){return x},P:function(){return j},UB:function(){return J},ZC:function(){return O},_Z:function(){return E},b:function(){return Q},gy:function(){return C},iK:function(){return T},jB:function(){return K},o1:function(){return k},rl:function(){return S},vE:function(){return N},xZ:function(){return P},yH:function(){return B}});var r,o,i=n(53709),u=n(68990),a=n(40039),s=n(99312),c=n(81043),f=n(88514),l=n(39244),_=n(27088),y=n(83008),p=n(70390),g=n(47538),d=n(59699),m=n(97330),h=n(92306),v=n(81582),b=n(38014),Z=[],w=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},k=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},T=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},S=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},j=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},x=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},W=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},P=function(e){return e.callWS({type:"energy/info"})},C=32143==n.j?(r=(0,c.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}):null,O=function(e){return e.callWS({type:"energy/get_prefs"})},E=32143==n.j?(o=(0,c.Z)((0,s.Z)().mark((function e(t,n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),M(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)}):null,D=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,i){var u,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:u}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),L=function(e){return(0,h.v)(e.energy_sources,(function(e){return e.type}))},B=function(e,t,n){var r,o=[],i=(0,a.Z)(e.energy_sources);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(!n||n.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var s,c=(0,a.Z)(u.flow_from);try{for(c.s();!(s=c.n()).done;){var f=s.value;o.push(f.stat_energy_from),f.stat_cost&&o.push(f.stat_cost);var l=t.cost_sensors[f.stat_energy_from];l&&o.push(l)}}catch(m){c.e(m)}finally{c.f()}var _,y=(0,a.Z)(u.flow_to);try{for(y.s();!(_=y.n()).done;){var p=_.value;o.push(p.stat_energy_to),p.stat_compensation&&o.push(p.stat_compensation);var g=t.cost_sensors[p.stat_energy_to];g&&o.push(g)}}catch(m){y.e(m)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var d=t.cost_sensors[u.stat_energy_from];d&&o.push(d)}else o.push(u.stat_energy_from)}}catch(m){i.e(m)}finally{i.f()}return o},H=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,c){var _,y,p,g,d,m,h,Z,w,k,T,S,j,x,W,C,O,E,L,H,M,J,K,A,I,N,Q,U,G,R,q,z,F,V,X,Y,$,ee,te,ne,re,oe,ie,ue,ae,se,ce;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,v.pB)(t,{domain:"co2signal"}),P(t)]);case 2:if(_=e.sent,y=(0,u.Z)(_,2),p=y[0],g=y[1],!(d=p.length?p[0]:void 0)){e.next=21;break}h=0,Z=Object.values(t.entities);case 9:if(!(h<Z.length)){e.next=21;break}if("co2signal"===(w=Z[h]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((k=t.states[w.entity_id])&&"%"===k.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return m=k.entity_id,e.abrupt("break",21);case 18:h++,e.next=9;break;case 21:T=[],S=(0,a.Z)(n.energy_sources);try{for(S.s();!(j=S.n()).done;)if("grid"===(x=j.value).type){W=(0,a.Z)(x.flow_from);try{for(W.s();!(C=W.n()).done;)O=C.value,T.push(O.stat_energy_from)}catch(s){W.e(s)}finally{W.f()}}}catch(s){S.e(s)}finally{S.f()}return E=B(n,g,["grid","solar","battery","gas"]),L=B(n,g,["water"]),H=[].concat((0,i.Z)(E),(0,i.Z)(L)),M=(0,f.Z)(o||new Date,r),J=M>35?"month":M>2?"day":"hour",K=t.config.unit_system.length||"",A={energy:"kWh",volume:"km"===K?"m続":"ft続"},I={volume:"km"===K?"L":"gal"},N=E.length?(0,b.dL)(t,r,o,E,J,A,["change"]):{},Q=L.length?(0,b.dL)(t,r,o,L,J,I,["change"]):{},q={},z={},c&&(R=(0,l.Z)(r,-1),E.length&&(q=(0,b.dL)(t,r,R,E,J,A,["change"])),L.length&&(z=(0,b.dL)(t,r,R,L,J,I,["change"]))),void 0!==m&&(F=D(t,r,T,m,o,M>35?"month":M>2?"day":"hour"),c&&(V=D(t,G,T,m,R,M>35?"month":M>2?"day":"hour"))),X={},Y=H.length?(0,b.Py)(t,H):[],e.next=42,Promise.all([N,Q,q,z,Y,F,V]);case 42:return $=e.sent,ee=(0,u.Z)($,7),te=ee[0],ne=ee[1],re=ee[2],oe=ee[3],ie=ee[4],ue=ee[5],ae=ee[6],se=Object.assign(Object.assign({},te),ne),c&&(U=Object.assign(Object.assign({},re),oe)),H.length&&ie.forEach((function(e){X[e.statistic_id]=e})),ce={start:r,end:o,startCompare:G,endCompare:R,info:g,prefs:n,stats:se,statsMetadata:X,statsCompare:U,co2SignalConfigEntry:d,co2SignalEntity:m,fossilEnergyConsumption:ue,fossilEnergyConsumptionCompare:ae},e.abrupt("return",ce);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),M=function(e){Z.forEach((function(t){var n=J(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];Z.push(t.key);var r=(0,m._)(e.connection,n,(0,c.Z)((0,s.Z)().mark((function t(){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,O(e);case 3:r.prefs=t.sent;case 4:return r._refreshTimeout&&clearTimeout(r._refreshTimeout),r._active&&(!r.end||r.end>new Date)&&((n=new Date).getMinutes()>=20&&n.setHours(n.getHours()+1),n.setMinutes(20,0,0),r._refreshTimeout=window.setTimeout((function(){return r.refresh()}),n.getTime()-Date.now())),t.abrupt("return",H(e,r.prefs,r.start,r.end,r.compare));case 7:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var i=new Date;r.start=i.getHours()>0?(0,_.Z)():(0,y.Z)(),r.end=i.getHours()>0?(0,p.Z)():(0,g.Z)();var u=function e(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,_.Z)(),r.end=(0,p.Z)(),e()}),(0,d.Z)((0,p.Z)(),1).getTime()-Date.now())};return u(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(e,t){var n;r.start=e,r.end=t,r.start.getTime()!==(0,_.Z)().getTime()||(null===(n=r.end)||void 0===n?void 0:n.getTime())!==(0,p.Z)().getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):u()},r.setCompare=function(e){r.compare=e},r},K=function(e){return e.callWS({type:"energy/solar_forecast"})},A=["volume","energy"],I=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,a.Z)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=n[i.stat_energy_from];if(A.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(s){o.e(s)}finally{o.f()}},N=function(e,t){var n=I(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},Q=function(e){return"km"===e.config.unit_system.length?"L":"gal"}}}]);
//# sourceMappingURL=55424--9Kw7ufS2Wo.js.map