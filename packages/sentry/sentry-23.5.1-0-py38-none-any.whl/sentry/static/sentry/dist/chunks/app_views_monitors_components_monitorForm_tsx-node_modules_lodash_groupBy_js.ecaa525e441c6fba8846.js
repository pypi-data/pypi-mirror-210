(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js"],{"./app/utils/slugify.tsx":(e,t,n)=>{"use strict";function r(e){return e.normalize("NFKD").toLowerCase().replace(" ","-").replace(/[^a-z0-9-_]/g,"")}n.d(t,{Z:()=>r})},"./app/views/monitors/components/monitorForm.tsx":(e,t,n)=>{"use strict";n.d(t,{G:()=>U,Z:()=>G});var r=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),i=n("../node_modules/mobx-react-lite/es/index.js"),a=n("./app/components/alert.tsx"),l=n("./app/components/alertLink.tsx"),c=n("./app/components/forms/fields/numberField.tsx"),u=n("./app/components/forms/fields/radioField.tsx"),d=n("./app/components/forms/fields/selectField.tsx"),m=n("./app/components/avatar/index.tsx"),p=n("./app/locale.tsx"),h=n("../node_modules/lodash/uniqBy.js"),f=n.n(h),g=n("./app/stores/memberListStore.tsx"),y=n("./app/stores/organizationStore.tsx"),b=n("./app/stores/useLegacyStore.tsx"),x=n("./app/utils/parseLinkHeader.tsx"),Z=n("./app/utils/useApi.tsx");async function v(e,t){let{emails:n,search:r,limit:o,lastSearch:s,cursor:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a={};void 0!==n&&n.length>0&&(a.query=n.map((e=>`email:${e}`)).join(" ")),r&&(a.query=`${a.query??""} ${r}`.trim()),(s===r||!s&&!r)&&i&&(a.cursor=i),void 0!==o&&(a.per_page=o);let l=!1,c=null;const[u,,d]=await e.requestPromise(`/organizations/${t}/members/`,{includeAllArgs:!0,query:a}),m=d?.getResponseHeader("Link");if(m){const e=(0,x.Z)(m);l=e?.next?.results,c=e?.next?.cursor}return{results:u,hasMore:l,nextCursor:c}}var w=n("./app/utils/useTeams.tsx"),_=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function k(e){let{avatarSize:t=20,placeholder:n=(0,p.t)("Choose Teams and Members"),...r}=e;const{members:o,fetching:i,onSearch:a,loadMore:l}=function(){let{emails:e,limit:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=(0,Z.Z)(),{organization:r}=(0,b.X)(y.Z),o=(0,b.X)(g.Z),i=r?.slug,a=(0,s.useMemo)((()=>new Set(o.members.map((e=>e.email)))),[o.members]),l=(0,s.useMemo)((()=>e?.filter((e=>!a.has(e)))??[]),[e,a]),c=l.length>0,u=!c&&o.members.length>0,[d,m]=(0,s.useState)({initiallyLoaded:u,fetching:!1,hasMore:o.hasMore,lastSearch:null,nextCursor:o.cursor,fetchError:null}),p=(0,s.useRef)(null);if(void 0!==e){const t=e??[];null===p.current&&(p.current=new Set(t)),(t.length!==p.current.size||t.some((e=>!p.current?.has(e))))&&(p.current=new Set(t))}const h=(0,s.useCallback)((async function(){if(void 0!==i){m((e=>({...e,fetching:!0})));try{const{results:e,hasMore:r,nextCursor:s}=await v(n,i,{emails:l,limit:t}),a=e.map((e=>e.user)).filter((e=>null!==e)),c=f()([...a,...o.members],(e=>{let{id:t}=e;return t}));g.Z.loadInitialData(c),m((e=>({...e,hasMore:r,fetching:!1,initiallyLoaded:!0,nextCursor:s})))}catch(e){console.error(e),m((t=>({...t,fetching:!1,initiallyLoaded:!0,fetchError:e})))}}}),[n,l,t,i,o.members]),x=(0,s.useCallback)((async function(e){const r=d.lastSearch,s=e?d.nextCursor:o.cursor;if(void 0!==i){m((e=>({...e,fetching:!0})));try{n.clear();const{results:a,hasMore:l,nextCursor:c}=await v(n,i,{search:e,limit:t,lastSearch:r,cursor:s}),u=a.map((e=>e.user)).filter((e=>null!==e)),d=f()([...o.members,...u],(e=>{let{email:t}=e;return t}));e?d.length>o.members.length&&g.Z.loadInitialData(d):g.Z.loadInitialData(d,l,c),m((t=>({...t,hasMore:l&&o.hasMore,fetching:!1,lastSearch:e??null,nextCursor:c})))}catch(e){console.error(e),m((t=>({...t,fetching:!1,fetchError:e})))}}else console.error("Cannot fetch members without an organization in context")}),[n,t,i,d.lastSearch,d.nextCursor,o.cursor,o.hasMore,o.members]),w=(0,s.useCallback)((function(e){return""!==e?x(e):(d.hasMore===o.hasMore&&d.nextCursor===o.cursor||m((t=>({...t,lastSearch:e,hasMore:o.hasMore,nextCursor:o.cursor}))),Promise.resolve())}),[x,d.hasMore,d.nextCursor,o.cursor,o.hasMore]);return(0,s.useEffect)((()=>{c&&h()}),[c,h]),{members:(0,s.useMemo)((()=>e?o.members.filter((t=>e.includes(t.email))):o.members),[o.members,e]),fetching:d.fetching||o.loading,initiallyLoaded:d.initiallyLoaded,fetchError:d.fetchError,hasMore:d.hasMore??o.hasMore,onSearch:w,loadMore:x}}(),c=o?.map((e=>({value:`member:${e.id}`,label:e.name,leadingItems:(0,_.tZ)(m.Z,{user:e,size:t})}))),{teams:u,fetching:h,onSearch:x,loadMore:k}=(0,w.y)({provideUserTeams:!0}),S=u?.map((e=>({value:`team:${e.id}`,label:e.name,leadingItems:(0,_.tZ)(m.Z,{team:e,size:t})})));return(0,s.useEffect)((()=>{l(),k()}),[]),(0,_.tZ)(d.Z,{placeholder:n,allowClear:!0,onInputChange:e=>{a(e),x(e)},isLoading:i||h,options:[{label:(0,p.t)("Members"),options:c},{label:(0,p.t)("Teams"),options:S}],...r})}k.displayName="SentryMemberTeamSelectorField";const S=k;var j=n("./app/components/forms/fields/sentryProjectSelectorField.tsx"),M=n("./app/components/forms/fields/textField.tsx"),C=n("./app/components/forms/form.tsx"),E=n("./app/components/forms/model.tsx"),I=n("./app/components/links/externalLink.tsx"),T=n("./app/components/list/index.tsx"),q=n("./app/components/list/listItem.tsx"),A=n("./app/components/text.tsx"),R=n("./app/data/timezones.tsx"),N=n("./app/styles/space.tsx"),z=n("./app/utils/isActiveSuperuser.tsx"),D=n("./app/utils/slugify.tsx"),L=n("./app/utils/theme.tsx"),O=n("./app/utils/usePageFilters.tsx"),B=n("./app/utils/useProjects.tsx"),F=n("./app/utils/withDomainRequired.tsx"),V=n("./app/views/monitors/utils.tsx"),P=n("./app/views/monitors/types.tsx");const $=[[P.Ix.CRONTAB,(0,p.t)("Crontab")],[P.Ix.INTERVAL,(0,p.t)("Interval")]],X="cron_job",U=30;function H(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,r]=t;if("alertRule"===n){const t=r?.map((e=>{const[t,n]=e.split(":");return{targetType:{team:"Team",member:"Member"}[t],targetIdentifier:n}}));return e[n]={targets:t},e}return n.startsWith("config.")?(e.config??={},"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[1,"hour"]),Array.isArray(e.config.schedule)&&"config.schedule.frequency"===n?(e.config.schedule[0]=parseInt(r,10),e):Array.isArray(e.config.schedule)&&"config.schedule.interval"===n?(e.config.schedule[1]=r,e):(e.config[n.substring(7)]=r,e)):(e[n]=r,e)}),{})}function K(e){if(void 0===e.config)return e;const{config:t,...n}=e;return{...n,...Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[`config.${t}`,n]})))}}function J(e){let{monitor:t,submitLabel:n,apiEndpoint:o,apiMethod:c,onSubmitSuccess:d}=e;const m=(0,s.useRef)(new E.Z({transformData:H,mapFormErrors:K})),{projects:h}=(0,B.Z)(),{selection:f}=(0,O.Z)(),g=f.projects[0],y=g?h.find((e=>e.id===g+"")):null,b=(0,z.M)(),x=h.filter((e=>b||e.isMember));return(0,_.tZ)(C.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:o,apiMethod:c,model:m.current,initialData:t?{name:t.name,slug:t.slug,type:t.type??X,project:t.project.slug,...function(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):(n["config.schedule"]=t.schedule,n["config.timezone"]=t.timezone)),n}(t.type,t.config)}:{project:y?y.slug:null,type:X},onSubmitSuccess:d,submitLabel:n,children:(0,_.BX)(W,{symbol:"colored-numeric",children:[(0,_.tZ)(re,{children:(0,p.t)("Add a name and project")}),(0,_.tZ)(se,{children:(0,p.t)("The monitor name will show up in alerts and notifications")}),(0,_.BX)(ie,{children:[(0,_.tZ)(ee,{name:"name",placeholder:(0,p.t)("My Cron Job"),required:!0,stacked:!0,inline:!1}),t&&(0,_.tZ)(ee,{name:"slug",help:(0,p._N)("The [strong:monitor-slug] is used to uniquely identify your monitor within your organization. Changing this slug will require updates to any instrumented check-in calls.",{strong:(0,_.tZ)("strong",{})}),placeholder:(0,p.t)("monitor-slug"),required:!0,stacked:!0,inline:!1,transformInput:D.Z}),(0,_.tZ)(te,{name:"project",projects:x,placeholder:(0,p.t)("Choose Project"),disabled:!!t,disabledReason:(0,p.t)("Existing monitors cannot be moved between projects"),valueIsSlug:!0,required:!0,stacked:!0,inline:!1})]}),(0,_.tZ)(re,{children:(0,p.t)("Choose your schedule type")}),(0,_.tZ)(se,{children:(0,p._N)("You can use [link:the crontab syntax] or our interval schedule.",{link:(0,_.tZ)(I.Z,{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,_.tZ)(ie,{children:(0,_.tZ)(u.Z,{name:"config.schedule_type",choices:$,defaultValue:P.Ix.CRONTAB,orientInline:!0,required:!0,stacked:!0,inline:!1})}),(0,_.tZ)(re,{children:(0,p.t)("Choose your schedule")}),(0,_.tZ)(se,{children:(0,p.t)("How often you expect your recurring jobs to run.")}),(0,_.BX)(ie,{children:[void 0!==t&&(0,_.tZ)(a.ZP,{type:"info",children:(0,p.t)("Any changes you make to the execution schedule will only be applied after the next expected check-in.")}),(0,_.tZ)(i.Qj,{children:()=>{const e=m.current.getValue("config.schedule_type"),t="crontab"===e?(0,V.Z)(m.current.getValue("config.schedule")?.toString()??""):null;return"crontab"===e?(0,_.BX)(ae,{children:[(0,_.tZ)(ee,{name:"config.schedule",placeholder:"* * * * *",defaultValue:"0 0 * * *",css:(0,r.iv)({input:{fontFamily:L.ZP.text.familyMono}},"",""),required:!0,stacked:!0,inline:!1}),(0,_.tZ)(Q,{name:"config.timezone",defaultValue:"UTC",options:R.f,required:!0,stacked:!0,inline:!1}),t&&(0,_.BX)(le,{children:['"',t,'"']})]}):"interval"===e?(0,_.BX)(ae,{interval:!0,children:[(0,_.tZ)(oe,{children:(0,p.t)("Every")}),(0,_.tZ)(Y,{name:"config.schedule.frequency",placeholder:"e.g. 1",defaultValue:"1",required:!0,stacked:!0,inline:!1}),(0,_.tZ)(Q,{name:"config.schedule.interval",options:(n=Number(m.current.getValue("config.schedule.frequency")??1),[{value:"minute",label:(0,p.tn)("minute","minutes",n)},{value:"hour",label:(0,p.tn)("hour","hours",n)},{value:"day",label:(0,p.tn)("day","days",n)},{value:"week",label:(0,p.tn)("week","weeks",n)},{value:"month",label:(0,p.tn)("month","months",n)},{value:"year",label:(0,p.tn)("year","years",n)}]),defaultValue:"day",required:!0,stacked:!0,inline:!1})]}):null;var n}})]}),(0,_.tZ)(re,{children:(0,p.t)("Set a missed status")}),(0,_.tZ)(se,{children:(0,p.t)("The number of minutes we'll wait before we consider a check-in as missed.")}),(0,_.tZ)(ie,{children:(0,_.tZ)(Y,{name:"config.checkin_margin",placeholder:"Defaults to 0 minutes",stacked:!0,inline:!1})}),(0,_.tZ)(re,{children:(0,p.t)("Set a failed status")}),(0,_.tZ)(se,{children:(0,p.t)("The number of minutes a check-in is allowed to run before it's considered failed.")}),(0,_.tZ)(ie,{children:(0,_.tZ)(Y,{name:"config.max_runtime",placeholder:`Defaults to ${U} minutes`,stacked:!0,inline:!1})}),(void 0===t||t.config.alert_rule_id)&&(0,_.BX)(s.Fragment,{children:[(0,_.tZ)(re,{children:(0,p.t)("Notify members")}),(0,_.tZ)(se,{children:(0,p.t)("Tell us who to notify when a check-in reaches the thresholds above or has an error. You can send notifications to members or teams.")}),(0,_.tZ)(ie,{children:void 0===t?(0,_.tZ)(ne,{name:"alertRule",multiple:!0,stacked:!0,inline:!1}):(0,_.tZ)(l.Z,{priority:"muted",to:(0,F.D)(`/alerts/rules/${t.project.slug}/${t.config.alert_rule_id}/`),children:(0,p.t)("Customize this monitors notification configuration in Alerts")})})]})]})})}J.displayName="MonitorForm";const G=J,W=(0,o.Z)(T.Z,{target:"epnopid11"})({name:"yrf9ut",styles:"width:600px"}),Y=(0,o.Z)(c.Z,{target:"epnopid10"})({name:"1hcx8jb",styles:"padding:0"}),Q=(0,o.Z)(d.Z,{target:"epnopid9"})({name:"1hcx8jb",styles:"padding:0"}),ee=(0,o.Z)(M.Z,{target:"epnopid8"})({name:"1hcx8jb",styles:"padding:0"}),te=(0,o.Z)(j.Z,{target:"epnopid7"})({name:"1hcx8jb",styles:"padding:0"}),ne=(0,o.Z)(S,{target:"epnopid6"})({name:"1hcx8jb",styles:"padding:0"}),re=(0,o.Z)(q.Z,{target:"epnopid5"})("font-size:",(e=>e.theme.fontSizeExtraLarge),";font-weight:bold;line-height:1.3;"),oe=(0,o.Z)(A.Z,{target:"epnopid4"})("font-weight:bold;color:",(e=>e.theme.subText),";"),se=(0,o.Z)(oe,{target:"epnopid3"})("font-weight:normal;padding-left:",(0,N.D)(4),";"),ie=(0,o.Z)("div",{target:"epnopid2"})("padding-left:",(0,N.D)(4),";margin-top:",(0,N.D)(1),";margin-bottom:",(0,N.D)(4),";display:flex;flex-direction:column;gap:",(0,N.D)(1),";"),ae=(0,o.Z)("div",{target:"epnopid1"})("display:grid;align-items:center;gap:",(0,N.D)(1),";grid-template-columns:",(e=>e.interval&&"auto")," 1fr 2fr;"),le=(0,o.Z)(oe,{target:"epnopid0"})("font-weight:normal;font-size:",(e=>e.theme.fontSizeExtraSmall),";font-family:",(e=>e.theme.text.familyMono),";grid-column:auto/span 2;")},"./app/views/monitors/types.tsx":(e,t,n)=>{"use strict";let r,o,s,i;n.d(t,{Ix:()=>o,NI:()=>i,wo:()=>s}),function(e){e.UNKNOWN="unknown",e.CRON_JOB="cron_job"}(r||(r={})),function(e){e.CRONTAB="crontab",e.INTERVAL="interval"}(o||(o={})),function(e){e.OK="ok",e.ERROR="error",e.DISABLED="disabled",e.ACTIVE="active",e.MISSED_CHECKIN="missed_checkin",e.TIMEOUT="timeout"}(s||(s={})),function(e){e.OK="ok",e.ERROR="error",e.IN_PROGRESS="in_progress",e.MISSED="missed",e.TIMEOUT="timeout"}(i||(i={}))},"./app/views/monitors/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{J:()=>c,Z:()=>l});var r=n("../node_modules/cronstrue/dist/cronstrue.js"),o=n.n(r),s=n("./app/locale.tsx"),i=n("./app/utils/dates.tsx"),a=n("./app/views/monitors/types.tsx");function l(e){if(!e)return null;let t;try{t=o().toString(e,{verbose:!0,use24HourTimeFormat:(0,i.gn)()})}catch(e){return null}return t}function c(e){if(e.schedule_type===a.Ix.CRONTAB)return l(e.schedule)??(0,s.t)("Unknown schedule");const[t,n]=e.schedule;return"minute"===n?(0,s.tn)("Every minute","Every %s minutes",t):"hour"===n?(0,s.tn)("Every hour","Every %s hours",t):"day"===n?(0,s.tn)("Every day","Every %s days",t):"week"===n?(0,s.tn)("Every week","Every %s weeks",t):"month"===n?(0,s.tn)("Every month","Every %s months",t):(0,s.t)("Unknown schedule")}},"../node_modules/lodash/groupBy.js":(e,t,n)=>{var r=n("../node_modules/lodash/_baseAssignValue.js"),o=n("../node_modules/lodash/_createAggregator.js"),s=Object.prototype.hasOwnProperty,i=o((function(e,t,n){s.call(e,n)?e[n].push(t):r(e,n,[t])}));e.exports=i}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js.b7beef6e3d9c615bb5e925dc8aaa733d.js.map