"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spanSummary_index_tsx"],{"./app/components/gridEditable/sortLink.tsx":(e,t,a)=>{a.d(t,{Z:()=>u});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=a("../node_modules/react-router/es/index.js"),s=a("./app/components/links/link.tsx"),r=a("./app/icons/index.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:a,canSort:n,generateSortLink:s,onClick:r,direction:l,replace:u}=e;const m=s();if(!m||!n)return(0,o.tZ)(c,{align:t,children:a});const h=l?(0,o.tZ)(p,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,o.BX)(d,{align:t,to:m,onClick:e=>{u&&(e.preventDefault(),i.browserHistory.replace(m)),r?.(e)},children:[a," ",h]})}l.displayName="SortLink";const d=(0,n.Z)((e=>{const{align:t,css:a,...n}=e;return(0,o.tZ)(s.Z,{...n})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),c=(0,n.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,n.Z)(r.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),u=l},"./app/components/performanceDuration.tsx":(e,t,a)=>{a.d(t,{Z:()=>o});var n=a("./app/components/duration.tsx"),i=a("./app/utils.tsx"),s=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(e){const t=function(e){return(0,i.ri)(e.nanoseconds)}(e)?e.nanoseconds/1e9:function(e){return(0,i.ri)(e.milliseconds)}(e)?e.milliseconds/1e3:e.seconds;return(0,s.tZ)(n.Z,{abbreviation:e.abbreviation,seconds:t,fixedDigits:2})}r.displayName="PerformanceDuration";const o=r},"./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx":(e,t,a)=>{a.d(t,{Z:()=>_,i:()=>$});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=a("../node_modules/react/index.js"),s=a("./app/components/gridEditable/index.tsx"),r=a("./app/components/gridEditable/sortLink.tsx"),o=a("./app/components/links/link.tsx"),l=a("./app/components/pagination.tsx"),d=a("./app/components/performance/waterfall/rowBar.tsx"),c=a("./app/components/performance/waterfall/utils.tsx"),p=a("./app/components/performanceDuration.tsx"),u=a("./app/components/tooltip.tsx"),m=a("./app/locale.tsx"),h=a("./app/styles/space.tsx"),g=a("./app/utils.tsx"),y=a("./app/utils/discover/fieldRenderers.tsx"),f=a("./app/utils/discover/fields.tsx"),x=a("./app/utils/formatters.tsx"),Z=a("./app/utils/performanceForSentry/index.tsx"),v=a("./app/views/performance/transactionSummary/utils.tsx"),D=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function _(e){const{location:t,organization:a,project:n,examples:r,suspectSpan:o,transactionName:d,isLoading:c,pageLinks:p}=e;if(!(0,g.ri)(r))return null;const u=r.filter((e=>e.spans.length>0)).map((e=>({id:e.id,project:n?.slug,timestamp:1e3*e.finishTimestamp,transactionDuration:1e3*(e.finishTimestamp-e.startTimestamp),spanDuration:e.nonOverlappingExclusiveTime,occurrences:e.spans.length,cumulativeDuration:e.spans.reduce(((e,t)=>e+t.exclusiveTime),0),spans:e.spans})));return(0,D.BX)(i.Fragment,{children:[(0,D.tZ)(Z.oF,{id:"SpanDetails-SpanDetailsTable",hasData:!!u.length,isLoading:c,children:(0,D.tZ)(s.ZP,{isLoading:c,data:u,columnOrder:T,columnSortBy:[],grid:{renderHeadCell:b,renderBodyCell:S(t,a,d,o)},location:t})}),(0,D.tZ)(l.Z,{pageLinks:p??null})]})}function b(e,t){const a=(0,f.qG)(e.key,w[e.key]);return(0,D.tZ)(r.Z,{title:e.name,align:a,direction:void 0,canSort:!1,generateSortLink:()=>{}})}function S(e,t,a,n){return function(i,s){if("spanDuration"===i.key&&s.transactionDuration)return(0,D.tZ)($,{spanOp:n?.op??"",spanDuration:s.spanDuration,transactionDuration:s.transactionDuration});let r=(0,y.Js)(i.key,w)(s,{location:e,organization:t});if("id"===i.key){const n=s.spans.length?s.spans.reduce(((e,t)=>e.exclusiveTime>=t.exclusiveTime?e:t)):null,i=(0,v.vd)(a)(t,s,e.query,n.id);r=(0,D.tZ)(o.Z,{to:i,children:r})}return r}}_.displayName="SpanTable",b.displayName="renderHeadCell";const w={id:"string",timestamp:"date",spanDuration:"duration",occurrences:"integer",cumulativeDuration:"duration"},T=[{key:"id",name:(0,m.t)("Event ID"),width:s.z7},{key:"timestamp",name:(0,m.t)("Timestamp"),width:s.z7},{key:"spanDuration",name:(0,m.t)("Span Duration"),width:s.z7},{key:"occurrences",name:(0,m.t)("Count"),width:s.z7},{key:"cumulativeDuration",name:(0,m.t)("Cumulative Duration"),width:s.z7}],k=(0,n.Z)("div",{target:"e1y3mgni1"})("position:relative;display:flex;top:",(0,h.D)(.5),";background-color:",(e=>e.theme.gray100),";"),E=(0,n.Z)(d.e,{target:"e1y3mgni0"})({name:"1ics03r",styles:"position:relative;width:100%;top:0"});function $(e){const{spanOp:t,spanDuration:a,transactionDuration:n}=e,i=a/n,s=i<.7?"right":"inset";return(0,D.tZ)(k,{children:(0,D.tZ)("div",{style:{width:(0,c.yI)(i)},children:(0,D.tZ)(u.u,{title:(0,m._N)("[percentage] of the transaction",{percentage:(0,x.rl)(i)}),containerDisplayMode:"block",children:(0,D.tZ)(E,{style:{backgroundColor:(0,c.hd)(t)},children:(0,D.tZ)(d.R,{durationDisplay:s,showDetail:!1,children:(0,D.tZ)(p.Z,{abbreviation:!0,milliseconds:a})})})})})})}$.displayName="SpanDurationBar"},"./app/views/starfish/views/spanSummary/index.tsx":(e,t,a)=>{a.r(t),a.d(t,{OverflowEllipsisTextContainer:()=>Se,default:()=>be});var n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react/index.js")),s=a("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),r=a("../node_modules/lodash/keyBy.js"),o=a.n(r),l=a("../node_modules/moment/moment.js"),d=a.n(l),c=a("./app/components/datePageFilter.tsx"),p=a("./app/components/dateTime.tsx"),u=a("./app/components/events/interfaces/keyValueList/index.tsx"),m=a("./app/components/gridEditable/index.tsx"),h=a("./app/components/layouts/thirds.tsx"),g=a("./app/components/links/link.tsx"),y=a("./app/components/switchButton.tsx"),f=a("./app/locale.tsx"),x=a("./app/styles/space.tsx"),Z=a("./app/utils/performance/contexts/pageError.tsx"),v=a("./app/utils/queryClient.tsx"),D=a("./app/utils/usePageFilters.tsx"),_=a("./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx"),b=a("./app/views/starfish/components/chart.tsx"),S=a("./app/views/starfish/components/chartPanel.tsx"),w=a("./app/views/starfish/components/formattedCode.tsx"),T=a("./app/views/starfish/modules/APIModule/endpointTable.tsx"),k=a("./app/views/starfish/modules/databaseModule/panel/index.tsx"),E=a("./app/views/starfish/modules/databaseModule/queries.ts"),$=a("./app/views/starfish/utils/dates.tsx"),q=a("./app/views/starfish/utils/zeroFillSeries.tsx"),N=a("../node_modules/lodash/orderBy.js"),A=a.n(N),C=a("../node_modules/query-string/index.js"),I=a("./app/components/duration.tsx"),O=a("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),L=a("./app/components/tooltip.tsx"),j=a("./app/components/version.tsx"),B=a("./app/utils.tsx"),F=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function M(e){let{colors:t=R,isLoading:a=!1,hasError:n=!1,renderLoading:s=(()=>null),renderEmpty:r=(()=>(0,F.tZ)("p",{children:(0,f.t)("No recent data.")})),renderError:o=(()=>null),showReleasePackage:l=!1,showTitle:d=!0,segments:c,title:p,totalValues:u,onTagClick:m}=e;const h=c.reduce(((e,t)=>e+t.count),0);return h<u&&c.push({isOther:!0,name:(0,f.t)("Other"),value:"other",count:u-h,url:""}),(0,F.BX)(X,{children:[d&&function(){if(!Array.isArray(c)||c.length<=0)return(0,F.tZ)(G,{children:(0,F.tZ)(K,{children:p})});const e=c[0],t=(0,B.aQ)(e.count,u),i=Math.floor(t);return(0,F.BX)(G,{children:[(0,F.tZ)(K,{children:p}),(0,F.BX)(W,{children:["release"===p?(0,F.tZ)(H,{children:(0,F.tZ)(j.Z,{version:e.name,anchor:!1,tooltipRawVersion:!0,withPackage:l,truncate:!0})}):(0,F.tZ)(H,{children:e.name||(0,f.t)("n/a")}),a||n?null:(0,F.BX)(Y,{children:[i,"%"]})]})]})}(),a?s():n?(0,F.tZ)(z,{children:o()}):0===u?(0,F.tZ)(z,{children:r()}):(0,F.tZ)(z,{children:c.map(((e,a)=>{const n=(0,B.aQ)(e.count,u),s=Math.floor(n),r=(0,F.BX)(i.Fragment,{children:[(0,F.tZ)("div",{className:"truncate",children:"release"===p?(0,F.tZ)(j.Z,{version:e.name,anchor:!1,withPackage:l}):e.name||(0,f.t)("n/a")}),s,"%"]}),o={index:a,to:e.url,onClick:()=>m?.(p,e)};return(0,F.tZ)("div",{style:{width:n+"%"},children:(0,F.tZ)(L.u,{title:r,containerDisplayMode:"block",children:e.isOther?(0,F.tZ)(Q,{"aria-label":(0,f.t)("Other"),color:t[t.length-1]}):(0,F.tZ)(U,{"aria-label":(0,f.t)("Add the %s %s segment tag to the search query",p,e.value),color:t[a],...o})})},e.value)}))})]})}M.displayName="TagDistributionMeter";const P=M,R=["#3A3387","#5F40A3","#8C4FBD","#B961D3","#DE76E4","#EF91E8","#F7B2EC","#FCD8F4","#FEEBF9"],X=(0,n.Z)("div",{target:"e1xupb248"})("margin-bottom:",(0,x.D)(1),";"),z=(0,n.Z)("div",{target:"e1xupb247"})("display:flex;overflow:hidden;border-radius:",(e=>e.theme.borderRadius),";"),G=(0,n.Z)("div",{target:"e1xupb246"})("display:flex;font-size:",(e=>e.theme.fontSizeSmall),";justify-content:space-between;margin-bottom:",(0,x.D)(.25),";line-height:1.1;"),K=(0,n.Z)("div",{target:"e1xupb245"})("color:",(e=>e.theme.textColor),";font-weight:bold;",(e=>e.theme.overflowEllipsis),";"),W=(0,n.Z)("div",{target:"e1xupb244"})("display:flex;color:",(e=>e.theme.gray300),";text-align:right;"),H=(0,n.Z)("div",{target:"e1xupb243"})((e=>e.theme.overflowEllipsis),";max-width:150px;"),Y=(0,n.Z)("div",{target:"e1xupb242"})("font-weight:bold;font-variant-numeric:tabular-nums;padding-left:",(0,x.D)(.5),";color:",(e=>e.theme.textColor),";"),Q=(0,n.Z)("span",{target:"e1xupb241"})("display:block;width:100%;height:16px;color:inherit;outline:none;background-color:",(e=>e.color),";"),U=(0,n.Z)(g.Z,{shouldForwardProp:O.Z,target:"e1xupb240"})("display:block;width:100%;height:16px;color:inherit;outline:none;background-color:",(e=>e.color),";border-radius:0;");var V=a("./app/utils/formatters.tsx"),J=a("./app/utils/useLocation.tsx"),ee=a("./app/views/starfish/modules/databaseModule/utils.ts"),te=a("./app/views/starfish/modules/APIModule/queries.tsx"),ae=a("./app/views/starfish/utils/constants.tsx");let ne;!function(e){e.FASTEST="fastest",e.MEDIAN="median",e.SLOWEST="slowest"}(ne||(ne={}));const ie=e=>{const{groupId:t,transactionName:a,user:n,p50:i}=e,s=(0,D.Z)(),r={queryKey:[t,a,n,s.selection.datetime,"spanSamples"],retry:!1,initialData:[]},o={groupId:t,transactionName:a,user:n,datetime:s.selection.datetime,p50:i};return(0,v.hu)({queries:[{...r,queryKey:[...r.queryKey,"spanSamplesSlowest"],queryFn:()=>fetch(`${ae.M}/?query=${de({...o,populationType:ne.SLOWEST})}`).then((e=>e.json()))},{...r,queryKey:[...r.queryKey,"spanSamplesMedian"],queryFn:()=>fetch(`${ae.M}/?query=${de({...o,populationType:ne.MEDIAN})}`).then((e=>e.json()))},{...r,queryKey:[...r.queryKey,"spanSamplesFastest"],queryFn:()=>fetch(`${ae.M}/?query=${de({...o,populationType:ne.FASTEST})}`).then((e=>e.json()))}]})},se=e=>{const{groupId:t,transactionName:a}=e,n=(0,D.Z)(),{startTime:i,endTime:s}=(0,$.tZ)(n),r=`\n      SELECT\n      user, domain\n    FROM spans_experimental_starfish\n    WHERE\n    group_id = '${t}'\n    AND transaction = '${a}'\n    ${(0,E.zD)(i,s)}\n  `;return(0,v.aM)({queryKey:["facetBreakdown",t,a],queryFn:()=>fetch(`${ae.M}/?query=${r}`).then((e=>e.json())),retry:!1,initialData:[]})},re=e=>{const{groupId:t}=e,a=(0,D.Z)(),{startTime:n,endTime:i}=(0,$.tZ)(a),s=`\n      SELECT\n      count() AS count,\n      quantile(0.5)(exclusive_time) as p50,\n      span_operation,\n      action,\n      module,\n      description\n    FROM\n      spans_experimental_starfish\n    WHERE\n    group_id = '${t}'\n    ${(0,E.zD)(n,i)}\n    GROUP BY\n      span_operation,\n      description,\n      action,\n      module\n  `;return(0,v.aM)({queryKey:["spansInTransaction",t],queryFn:()=>fetch(`${ae.M}/?query=${s}&format=sql`).then((e=>e.json())),retry:!1,initialData:[]})},oe=e=>{const{description:t,groupId:a,transactionName:n,module:i}=e,s=(0,D.Z)(),r=ue({description:t,transactionName:n,datetime:s.selection.datetime,groupId:a,module:i});return(0,v.aM)({queryKey:["span-aggregates",n,a,t],queryFn:()=>fetch(`${ae.M}/?query=${r}&referrer=sidebar-aggregates`).then((e=>e.json())),retry:!1,initialData:[]})},le=e=>{const{description:t,groupId:a,spanGroupOperation:n,transactionName:i,module:s}=e,r=(0,D.Z)(),{getSeriesQuery:o}=function(e){switch(e){case"db":case"cache":default:return{getSeriesQuery:pe,getAggregatesQuery:ue};case"http.client":return{getSeriesQuery:te.Zn,getAggregatesQuery:ue}}}(n),l=o({datetime:r.selection.datetime,groupId:a,module:s,description:t,interval:12,transactionName:i});return(0,v.aM)({queryKey:["seriesdata",i,s,r.selection.datetime,a],queryFn:()=>fetch(`${ae.M}/?query=${l}&referrer=sidebar-aggregates`).then((e=>e.json())),retry:!1,initialData:[]})},de=e=>{let{groupId:t,transactionName:a,user:n,populationType:i,datetime:s,p50:r}=e;const{start_timestamp:o,end_timestamp:l}=(0,$.SW)(s);return`\n    SELECT transaction_id, transaction, description, user, domain, span_id, sum(exclusive_time) as exclusive_time, abs(minus(exclusive_time, ${r})) as diff\n    FROM spans_experimental_starfish\n    WHERE group_id = '${t}'\n    ${a?`AND transaction = '${a}'`:""}\n    ${n?`AND user = '${n}'`:""}\n    ${o?`AND greaterOrEquals(start_timestamp, '${o}')`:""}\n    ${l?`AND lessOrEquals(start_timestamp, '${l}')`:""}\n    GROUP BY transaction_id, transaction, description, user, domain, span_id\n    ORDER BY ${i!==ne.SLOWEST&&i?i===ne.FASTEST?"exclusive_time asc":"diff asc":"exclusive_time desc"}\n    LIMIT 3\n `},ce=e=>{const{transactionName:t}=e,{selection:{datetime:a}}=(0,D.Z)(),n=`?field=count%28%29&query=transaction%3A${encodeURIComponent(t)}${a?a.period?`&statsPeriod=${a.period}`:a.start&&a.end?`&start=${encodeURIComponent(a.start.toISOString())}&end=${encodeURIComponent(a.end.toISOString())}`:null:null}&dataset=metricsEnhanced&project=1`;return(0,v.aM)({queryKey:["uniqueTransactionCount",t],queryFn:()=>fetch(`/api/0/organizations/sentry/events/${n}`).then((e=>e.json())),retry:!1,initialData:[]})},pe=e=>{let{description:t,transactionName:a,datetime:n,groupId:i,module:s,interval:r}=e;const{start_timestamp:o,end_timestamp:l}=(0,$.SW)(n);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     count() as count,\n     divide(count(), multiply(${r}, 60)) as spm,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = '${s}'\n     ${t?`AND description = '${t}'`:""}\n     ${i?`AND group_id = '${i}'`:""}\n     ${a?`AND transaction = '${a}'`:""}\n     ${o?`AND greaterOrEquals(start_timestamp, '${o}')`:""}\n     ${l?`AND lessOrEquals(start_timestamp, '${l}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `},ue=e=>{let{description:t,transactionName:a,datetime:n,groupId:i,module:s}=e;const{start_timestamp:r,end_timestamp:o}=(0,$.SW)(n);return`\n    SELECT\n    count() AS count,\n    quantile(0.5)(exclusive_time) as p50,\n    quantile(0.95)(exclusive_time) as p95,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count() as failure_rate,\n    sum(exclusive_time) as total_exclusive_time,\n    count(DISTINCT transaction_id) as count_unique_transaction_id,\n    count(DISTINCT transaction) as count_unique_transaction,\n    min(timestamp) as first_seen,\n    max(timestamp) as last_seen\n    FROM spans_experimental_starfish\n    WHERE 1 == 1\n    ${s?`AND module = '${s}'`:""}\n    ${t?`AND description = '${t}'`:""}\n    ${i?`AND group_id = '${i}'`:""}\n    ${a?`AND transaction = '${a}'`:""}\n    ${r?`AND greaterOrEquals(start_timestamp, '${r}')`:""}\n    ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n    ORDER BY count DESC\n    LIMIT 5\n `};function me(e){let{spanGroupOperation:t,groupId:a,description:n,transactionName:i,module:r}=e;const o=(0,s.u)(),l=(0,D.Z)(),c=(0,J.T)(),{isLoading:p,data:u}=se({groupId:a,transactionName:i}),{isLoading:m,data:h}=oe({description:n,groupId:a,module:r,transactionName:i}),{isLoading:g,data:y}=le({description:n,groupId:a,module:r,spanGroupOperation:t,transactionName:i}),{data:x,isLoading:Z}=ce({transactionName:i}),{failure_rate:v,count:_,total_exclusive_time:b,count_unique_transaction_id:S}=h[0]||{},[w,T,k]=l.selection.datetime.period?.match($.Pr)??[],E=T&&k?d()().subtract(T,k):d()(l.selection.datetime.start),N=d()(l.selection.datetime.end??void 0),[,,,O,L]=ve(y).map((e=>(0,q.b)(e,d().duration(12,"hours"),E,N))),j=S&&x?.data?.[0]?.["count()"]?S/x.data[0]["count()"]:0,B=Math.round(100*(_&&x?.data?.[0]?.["count()"]?_/x.data[0]["count()"]:0))/100,M=o.charts.getColorPalette(2);return(0,F.BX)(he,{children:[(0,F.BX)(ge,{children:[(0,F.tZ)(fe,{children:(0,f.t)("Total Time")}),(0,F.BX)(xe,{children:[(0,F.tZ)(I.Z,{seconds:b/1e3,fixedDigits:2,abbreviation:!0})," "]})]}),(0,F.BX)(ge,{children:[(0,F.tZ)(fe,{children:(0,f.t)("Total Spans")}),(0,F.tZ)(xe,{children:_})]}),(0,F.BX)(ge,{children:[(0,F.tZ)(fe,{children:(0,f.t)("Frequency")}),(0,F.tZ)(xe,{children:(0,V.rl)(j)})]}),(0,F.BX)(ge,{children:[(0,F.tZ)(fe,{children:(0,f.t)("Avg Spans")}),(0,F.BX)(xe,{children:[B," ",(0,f.t)("per event")]})]}),"http.client"===t&&(0,F.BX)(ye,{children:[(0,F.tZ)(fe,{children:(0,f.t)("Error Rate")}),(0,F.tZ)(xe,{children:(0,V.rl)(v)}),(0,F.tZ)(Ze,{series:L,isLoading:g,chartColor:M[3]})]}),(0,F.tZ)(ye,{children:p?(0,F.tZ)("span",{children:"LOADING"}):(0,F.BX)("div",{children:[(0,F.tZ)("h3",{children:(0,f.t)("Facets")}),["user"].map((e=>{const t=u.map((t=>t[e])),n=Array.from(new Set(t));let i=0;const s=A()(n.map((n=>{const s=t.filter((e=>e===n)).length;i+=s;const r={...c.query,[e]:n};return{key:e,name:n,value:n,url:`/starfish/span/${a}?${C.stringify(r)}`,count:_}})),"count","desc");return(0,F.tZ)(P,{title:e,segments:s,totalValues:i},e)}))]})})]})}me.displayName="Sidebar";const he=(0,n.Z)("div",{target:"eq180hl4"})({name:"1o7d3sk",styles:"display:flex;align-items:center;flex-wrap:wrap"}),ge=(0,n.Z)("div",{target:"eq180hl3"})("flex:1 1 50%;margin-bottom:",(0,x.D)(4),";"),ye=(0,n.Z)("div",{target:"eq180hl2"})("flex:1 1 100%;margin-bottom:",(0,x.D)(4),";"),fe=(0,n.Z)("h3",{target:"eq180hl1"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,x.D)(.5),";"),xe=(0,n.Z)("h4",{target:"eq180hl0"})({name:"3in70x",styles:"margin:0;font-weight:normal"});function Ze(e){return(0,F.tZ)(b.Z,{statsPeriod:"24h",height:110,data:e.series?[e.series]:[],start:"",end:"",loading:e.isLoading,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0,chartColors:[e.chartColor],grid:{left:"0",right:"0",top:"8px",bottom:"16px"},scatterPlot:[{data:e.sampledSpanDataSeries,seriesName:"Sampled Span Duration"}]})}function ve(e){const t=[];return e.length>0&&Object.keys(e[0]).filter((e=>"interval"!==e)).forEach((e=>{t.push({seriesName:`${e}()`,data:[]})})),e.forEach((e=>{Object.keys(e).forEach((a=>{"interval"!==a&&t.find((e=>e.seriesName===`${a}()`))?.data.push({name:e.interval,value:e[a]})}))})),t}Ze.displayName="SidebarChart";const De=(e,t)=>{const a=(0,ee.F)(e,"group","p50(transaction.duration)",t.startTime,t.endTime,12)[0],n=(0,ee.F)(e,"group","epm()",t.startTime,t.endTime,12)[0];return e.length&&(a.seriesName="p50()",n.seriesName="epm()"),{p50TransactionSeries:a,throughputTransactionSeries:n}},_e=[{key:"transaction_id",name:"Event ID",width:200},{key:"timestamp",name:"Timestamp",width:300},{key:"duration",name:"Span Duration",width:200},{key:"p50_comparison",name:"Compared to P50",width:200}];function be(e){let{location:t,params:a}=e;const[n,r]=(0,i.useState)({plotSamples:!1,megaChart:!1}),l=(0,D.Z)(),u=(0,s.u)(),x=(0,$.tZ)(l),w=a.groupId,k=t.query.transaction,N=t.query.user,{isLoading:A,data:C}=re({groupId:w}),I=C[0]?.p50??0,O=ie({groupId:w,transactionName:k,user:N,p50:I}),{isLoading:L,data:j}=O.reduce(((e,t)=>t.isLoading?(e.isLoading=!0,e):(t.data.forEach((t=>{e.spanIds.has(t.span_id)||(e.spanIds.add(t.span_id),e.data.push(t))})),e)),{isLoading:!1,data:[],spanIds:new Set}),B=j?.[0]?.description,M=j?.[0]?.domain,P=C?.[0]?.span_operation,R=C?.[0]?.module,X=C?.[0]?.formatted_desc,z=C?.[0]?.action,{isLoading:G,data:K}=le({groupId:w,spanGroupOperation:P,transactionName:k,description:B,module:R}),[W,H,Y]=l.selection.datetime.period?.match($.Pr)??[],Q=H&&Y?d()().subtract(H,Y):d()(l.selection.datetime.start),U=d()(l.selection.datetime.end??void 0),{isLoading:V,data:J}=(0,E.Tu)([k],12),{p50TransactionSeries:ee,throughputTransactionSeries:te}=De(J,x),[ae,ne,se]=ve(K).map((e=>(e.lineStyle={type:"dotted"},(0,q.b)(e,d().duration(12,"hours"),Q,U)))),{data:oe,isLoading:de}=(0,v.WE)([`/organizations/sentry/events/?field=id&field=timestamp&field=transaction.duration&field=project.name&query=id:[${j.map((e=>e.transaction_id.replaceAll("-",""))).join(",")}]&referrer=api.starfish.span-summary-table&sort=-transaction.duration&statsPeriod=14d`],{staleTime:0,enabled:j.length>0}),ce=o()(oe?.data,"id"),pe=j.map((e=>{const t=ce[e.transaction_id.replaceAll("-","")];return{transaction:e.transaction,transaction_id:e.transaction_id,"project.name":t?.["project.name"],span_id:e.span_id,timestamp:t?.timestamp,spanOp:e.span_operation,spanDuration:e.exclusive_time,transactionDuration:t?.["transaction.duration"],exclusive_time:e.exclusive_time,p50Comparison:e.p50_comparison,user:e.user}})),ue=pe.map((e=>{let{timestamp:t,spanDuration:a}=e;return{name:t,value:a}}));return(0,F.tZ)(h.T3,{children:(0,F.BX)(Z.V_,{children:[(0,F.tZ)(h.h4,{children:(0,F.tZ)(h.oB,{children:(0,F.tZ)(h.Dx,{children:k})})}),(0,F.tZ)(h.uT,{children:(0,F.BX)(h.or,{fullWidth:!0,children:[(0,F.tZ)(Z.YY,{}),(0,F.BX)(Ee,{children:[(0,F.tZ)(c.Z,{alignDropdown:"left"}),(0,F.BX)($e,{children:[(0,F.tZ)(qe,{active:n.plotSamples,children:(0,f.t)("Plot samples on charts")}),(0,F.tZ)(y.Z,{isActive:n.plotSamples,toggle:()=>{r({...n,plotSamples:!n.plotSamples})}})]})]}),(0,F.BX)(we,{children:[(0,F.BX)(Te,{children:[A?(0,F.tZ)("span",{children:"LOADING"}):(0,F.BX)("div",{children:[(0,F.tZ)("h3",{children:(0,f.t)("Info")}),(0,F.tZ)(Ie,{data:C,spanGroupOperation:P,spanDescription:B,formattedDescription:X,spanDomain:M,action:z,transactionName:k})]}),(0,F.BX)(Ce,{children:[(0,F.tZ)(S.Z,{title:(0,f.t)("Throughput (TPM)"),children:(0,F.tZ)(b.Z,{statsPeriod:"24h",height:140,data:[te??[]],start:"",end:"",loading:V,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,definedAxisTicks:4})}),(0,F.tZ)(S.Z,{title:(0,f.t)("Transaction Duration (P50)"),children:(0,F.tZ)(b.Z,{statsPeriod:"24h",height:140,chartColors:u.charts.getColorPalette(4).slice(5,6),data:[ee??[]],start:"",end:"",loading:V,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,definedAxisTicks:4})}),(0,F.tZ)(S.Z,{title:(0,f.t)("Throughput (SPM)"),children:(0,F.tZ)(b.Z,{statsPeriod:"24h",height:140,data:[ne??[]],start:"",end:"",loading:G,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,definedAxisTicks:4})}),(0,F.tZ)(S.Z,{title:(0,f.t)("Span Duration (P50)"),children:(0,F.tZ)(b.Z,{statsPeriod:"24h",height:140,data:[ae??[]],start:"",end:"",loading:G,utc:!1,chartColors:u.charts.getColorPalette(4).slice(5,6),scatterPlot:n.plotSamples?[{data:ue,seriesName:"Sampled Span Duration"}]:void 0,stacked:!0,isLineChart:!0,disableXAxis:!0,definedAxisTicks:4})})]}),L?(0,F.tZ)("span",{children:"LOADING SAMPLE LIST"}):(0,F.tZ)("div",{children:(0,F.tZ)(m.ZP,{isLoading:A||de,data:pe,columnOrder:_e,columnSortBy:[],grid:{renderHeadCell:function(e){return"p50_comparison"===e.key?(0,F.tZ)(T.Dq,{children:(0,F.tZ)(Se,{children:e.name})}):(0,F.tZ)(Se,{children:e.name})},renderBodyCell:function(e,t){if("transaction_id"===e.key)return(0,F.tZ)(g.Z,{to:`/performance/${t["project.name"]}:${t.transaction_id}#span-${t.span_id.slice(19).replace("-","")}`,children:t.transaction_id.slice(0,8)});if("duration"===e.key)return(0,F.tZ)(_.i,{spanOp:t.spanOp,spanDuration:t.spanDuration,transactionDuration:t.transactionDuration});if("p50_comparison"===e.key){const e=t.spanDuration-I;if(Math.floor(t.spanDuration)===Math.floor(I))return(0,F.tZ)(Ne,{children:(0,f.t)("At baseline")});const a=e>0?`+${e.toFixed(2)}ms above`:`${e.toFixed(2)}ms below`;return(0,F.tZ)(Ae,{value:e,children:a})}return"timestamp"===e.key?(0,F.tZ)(p.Z,{date:t.timestamp,year:!0,timeZone:!0,seconds:!0}):(0,F.tZ)("span",{children:t[e.key]})}},location:t})})]}),(0,F.tZ)(ke,{children:(0,F.tZ)(me,{groupId:w,spanGroupOperation:P,transactionName:k,sampledSpanData:n.plotSamples?pe:[],module:R})})]})]})})]})})}be.displayName="SpanSummary";const Se=(0,n.Z)("span",{target:"e1ysathp9"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"}),we=(0,n.Z)("div",{target:"e1ysathp8"})("display:flex;flex-wrap:wrap;gap:",(0,x.D)(4),";"),Te=(0,n.Z)("div",{target:"e1ysathp7"})({name:"185jlqp",styles:"flex:100 0 800px"}),ke=(0,n.Z)("div",{target:"e1ysathp6"})({name:"r99fwb",styles:"flex:1 1 500px"}),Ee=(0,n.Z)("div",{target:"e1ysathp5"})("display:flex;flex-direction:row;gap:",(0,x.D)(1),";align-items:center;margin-bottom:",(0,x.D)(2),";"),$e=(0,n.Z)("div",{target:"e1ysathp4"})("display:flex;flex-direction:row;gap:",(0,x.D)(1),";align-items:center;flex:1;justify-content:flex-end;"),qe=(0,n.Z)("span",{target:"e1ysathp3"})("font-size:",(e=>e.theme.fontSizeSmall),";color:",(e=>e.active?e.theme.purple300:e.theme.gray300),";"),Ne=(0,n.Z)("div",{target:"e1ysathp2"})({name:"2qga7i",styles:"text-align:right"}),Ae=(0,n.Z)("div",{target:"e1ysathp1"})("text-align:right;color:",(e=>e.value<0?e.theme.green400:e.theme.red400),";"),Ce=(0,n.Z)("div",{target:"e1ysathp0"})("display:grid;grid-template-columns:repeat(2, 1fr);column-gap:",(0,x.D)(1.5),";");function Ie(e){let{spanDescription:t,spanGroupOperation:a,spanDomain:n,formattedDescription:i,action:s}=e;switch(i&&s&&n&&(0,k._b)(i,{action:s,domain:n}),a){case"db":case"cache":return(0,F.tZ)(u.Z,{data:[{key:"desc",value:s&&n?(0,F.tZ)(w.K,{children:(0,k._b)(i,{action:s,domain:n})}):i,subject:"Query"}],shouldSort:!1});case"http.client":return(0,F.tZ)(u.Z,{data:[{key:"desc",value:t,subject:"URL"},{key:"domain",value:n,subject:"Domain"}],shouldSort:!1});default:return null}}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spanSummary_index_tsx.b56b0bbdb4a9ff2b1e7b26edcba2b696.js.map