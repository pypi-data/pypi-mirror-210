"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_components_breakdownBar_tsx"],{"./app/views/starfish/components/breakdownBar.tsx":(t,e,s)=>{s.d(e,{c_:()=>x,An:()=>E});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/react/index.js"),s("../node_modules/react-router/es/index.js"),s("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),s("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js")),i=(s("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),s("../node_modules/query-string/index.js"),s("./app/components/truncate.tsx"),s("./app/locale.tsx")),r=s("./app/styles/space.tsx"),o=(s("./app/utils.tsx"),s("./app/utils/dates.tsx"),s("./app/utils/queryClient.tsx"),s("./app/utils/usePageFilters.tsx")),m=(s("./app/views/starfish/views/webServiceView/queries.js"),s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/moment/moment.js")),p=s.n(m),d=s("./app/views/starfish/components/chart.tsx"),l=s("./app/views/starfish/components/chartPanel.tsx"),u=s("./app/views/starfish/utils/dates.tsx"),c=s("./app/views/starfish/utils/zeroFillSeries.tsx"),_=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function h(t){let{segments:e,isTopDataLoading:s,topData:a,isOtherDataLoading:r,otherData:m,cumulativeSummary:h}=t;const E=(0,o.Z)(),f=(0,n.u)(),O={},[w,b,D]=E.selection.datetime.period?.match(u.Pr)??[],$=b&&D?p()().subtract(b,D):p()(E.selection.datetime.start),g=p()(E.selection.datetime.end??void 0);!s&&!r&&e.length>0&&(e.forEach((t=>{const e=x(t.span_operation,t.action,t.domain);O[e]={seriesName:`${e}`,data:[]}})),a.forEach((t=>{O[x(t.span_operation,t.action,t.domain)].data.push({value:t.p75,name:t.interval})})),O.Other={seriesName:"Other",data:[]},m.forEach((t=>{O.Other.data.push({value:t.p75,name:t.interval})})));const R=Object.values(O).map((t=>(0,c.b)(t,p().duration(1,"day"),$,g)));return(0,_.tZ)(l.Z,{title:(0,i.t)("Duration breakdown (p50)"),children:(0,_.BX)(v,{children:[(0,_.tZ)(d.Z,{statsPeriod:"24h",height:350,data:R,start:"",end:"",loading:s,utc:!1,grid:{left:"0",right:"0",top:"16px",bottom:"8px"},definedAxisTicks:4,stacked:!0,chartColors:f.charts.getColorPalette(5)}),h]})})}h.displayName="WebServiceBreakdownChart";const v=(0,a.Z)("div",{target:"e1m9i42s0"})("display:grid;grid-auto-flow:column;grid-auto-columns:1fr min-content;align-items:center;justify-self:flex-end;gap:",(0,r.D)(2),";");function x(t,e,s){return"http.client"===t?(0,i.t)("%s requests to %s",e,s):"db"===t?(0,i.t)("%s queries on %s",e,s):t||s||void 0}function E(t,e,s){const a=x(t,e,s);return"http.client"===t?(0,i.t)("%s (http.client spans)",a):"db"===t?(0,i.t)("%s (db spans)",a):(0,i.t)("%s spans",a)}(0,r.D)(2),(0,r.D)(1),(0,r.D)(1),(0,r.D)(.5),(0,r.D)(1),(0,r.D)(1)},"./app/views/starfish/views/webServiceView/queries.js":(t,e,s)=>{s.d(e,{Lb:()=>i,Sy:()=>r,hj:()=>o,u4:()=>n});var a=s("./app/views/starfish/utils/dates.tsx");const n=t=>{let{transaction:e,datetime:s}=t;const{start_timestamp:n,end_timestamp:i}=(0,a.SW)(s);return`SELECT domain, action, span_operation, module, sum(exclusive_time) as sum, uniq(description) as num_spans\n   FROM spans_experimental_starfish\n   WHERE span_operation NOT IN ['base.dispatch.execute', 'middleware.django', 'base.dispatch.request']\n   ${e?`AND transaction = '${e}'`:""}\n   ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n   ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n   GROUP BY domain, action, span_operation, module\n   ORDER BY -sum(exclusive_time)\n   LIMIT 5\n `},i=t=>{let{transaction:e,topConditions:s,datetime:n}=t;const{start_timestamp:i,end_timestamp:r}=(0,a.SW)(n);return`SELECT\n quantile(0.75)(exclusive_time) as p75, domain, action, span_operation, module,\n toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval\n FROM default.spans_experimental_starfish\n WHERE greaterOrEquals(start_timestamp, '${i}')\n ${r?`AND lessOrEquals(start_timestamp, '${r}')`:""}\n ${s?`AND (${s})`:""}\n ${e?`AND transaction = '${e}'`:""}\n GROUP BY interval, domain, action, span_operation, module\n ORDER BY interval, domain, action, span_operation, module\n `},r=t=>{let{transaction:e,topConditions:s,datetime:n}=t;const{start_timestamp:i,end_timestamp:r}=(0,a.SW)(n);return`SELECT\n quantile(0.75)(exclusive_time) as p75,\n toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval\n FROM default.spans_experimental_starfish\n WHERE greaterOrEquals(start_timestamp, '${i}')\n ${r?`AND lessOrEquals(start_timestamp, '${r}')`:""}\n ${s?`AND NOT (${s})`:""}\n ${e?`AND transaction = '${e}'`:""}\n GROUP BY interval\n ORDER BY interval\n `},o=t=>{let{transaction:e,datetime:s}=t;const{start_timestamp:n,end_timestamp:i}=(0,a.SW)(s);return`SELECT sum(exclusive_time) as sum\n   FROM spans_experimental_starfish\n   WHERE greaterOrEquals(start_timestamp, '${n}')\n   ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n   ${e?`AND transaction = '${e}'`:""}\n `}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_components_breakdownBar_tsx.ed69fa8fcb42603f09ddfbf813c45734.js.map