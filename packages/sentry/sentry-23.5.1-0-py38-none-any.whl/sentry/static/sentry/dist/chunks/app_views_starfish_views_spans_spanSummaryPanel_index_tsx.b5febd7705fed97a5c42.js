(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spans_spanSummaryPanel_index_tsx"],{"./app/views/starfish/views/spans/spanSummaryPanel/index.tsx":(e,t,n)=>{"use strict";n.d(t,{U:()=>se});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),i=n("./app/components/duration.tsx"),r=n("./app/components/timeSince.tsx"),o=n("./app/locale.tsx"),l=n("./app/styles/space.tsx"),d=n("./app/views/starfish/components/chart.tsx"),p=n("./app/views/starfish/components/detailPanel.tsx"),c=n("./app/components/version.tsx"),u=n("./app/components/versionHoverCard.tsx"),m=n("./app/utils/useOrganization.tsx"),h=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function g(e){let{release:t}=e;const n=(0,m.Z)();return(0,h.tZ)(y,{children:(0,h.tZ)(u.ZP,{organization:n,projectSlug:"sentry",releaseVersion:t.version,showUnderline:!0,underlineColor:"linkUnderline",children:(0,h.tZ)(c.Z,{version:String(t.version),truncate:!0})})})}g.displayName="ReleasePreview";const y=(0,a.Z)("div",{target:"e1y7n0iv0"})("font-size:",(e=>e.theme.fontSizeMedium),";");var _=n("./app/views/starfish/components/formattedCode.tsx"),f=n("./app/views/starfish/modules/databaseModule/panel/index.tsx");function v(e){let{span:t}=e;return t.span_operation.startsWith("db")?(0,h.tZ)(Z,{span:t}):(0,h.tZ)("div",{children:t.description})}function Z(e){let{span:t}=e;return(0,h.tZ)(x,{children:(0,h.tZ)(_.K,{children:(0,f._b)(t.formatted_desc||t.description||"",{action:t.action||"",domain:t.domain||""})})})}v.displayName="SpanDescription",Z.displayName="DatabaseSpanDescription";const x=(0,a.Z)("div",{target:"e16k9e3c0"})("font-size:",(e=>e.theme.fontSizeMedium),";");var S=n("../node_modules/react/index.js"),E=n("../node_modules/query-string/index.js"),$=n("./app/components/gridEditable/index.tsx"),b=n("./app/components/links/link.tsx"),L=n("./app/components/truncate.tsx"),R=n("./app/constants/chartPalette.tsx"),w=n("./app/utils/useLocation.tsx"),k=n("./app/views/starfish/components/sparkline.tsx"),M=n("../node_modules/lodash/keyBy.js"),q=n.n(M),B=n("./app/utils/queryClient.tsx"),C=n("./app/views/starfish/utils/constants.tsx");const j=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-transaction-metrics";const a=e&&t&&t.length>0?D(e,t):"",{isLoading:s,error:i,data:r}=(0,B.aM)({queryKey:["span-transactions-metrics",e?.group_id,t?.join(",")||""],queryFn:()=>fetch(`${C.M}/?query=${a}&referrer=${n}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(a)});return{isLoading:s,error:i,data:q()(r,"transaction")}},D=(e,t)=>`\n    SELECT\n      transaction,\n      quantile(0.5)(exclusive_time) as p50,\n      divide(count(), multiply(12, 60)) as spm\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    AND transaction IN ('${t.join("','")}')\n    GROUP BY transaction\n `;var O=n("../node_modules/lodash/groupBy.js"),F=n.n(O),P=n("../node_modules/moment/moment.js"),T=n.n(P),N=n("./app/views/starfish/utils/zeroFillSeries.tsx");const A=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"span-transaction-metrics-series";const a=e&&t&&t.length>0?I(e,t):"",{isLoading:s,error:i,data:r}=(0,B.aM)({queryKey:["span-metrics-series",e?.group_id,t?.join(",")||""],queryFn:()=>fetch(`${C.M}/?query=${a}&referrer=${n}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(a)}),o={},l=F()(r,"transaction");return Object.keys(l).forEach((e=>{const t=q()(["spm","p50"].map((e=>{const t={seriesName:e,data:r.map((t=>({value:t[e],name:t.interval})))};return(0,N.b)(t,T().duration(12,"hours"))})),"seriesName");o[e]=t})),{isLoading:s,error:i,data:o}},I=(e,t)=>`SELECT\n    transaction,\n    toStartOfInterval(start_timestamp, INTERVAL 12 hour) as interval,\n    quantile(0.50)(exclusive_time) AS p50,\n    divide(count(), multiply(12, 60)) as spm\n  FROM spans_experimental_starfish\n  WHERE\n    transaction IN ('${t.join("','")}')\n    AND group_id = '${e.group_id}'\n  GROUP BY transaction, interval\n  ORDER BY transaction, interval\n`,Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-transactions";const n=e?X(e):"",{isLoading:a,error:s,data:i}=(0,B.aM)({queryKey:["span-transactions",e?.group_id],queryFn:()=>fetch(`${C.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:a,error:s,data:i}},X=e=>`\n    SELECT\n      transaction,\n      count() AS count\n    FROM spans_experimental_starfish\n    WHERE\n      group_id = '${e.group_id}'\n    GROUP BY transaction\n    ORDER BY -power(10, floor(log10(count()))), -quantile(0.75)(exclusive_time)\n    LIMIT 5\n`;function H(e){let{span:t}=e;const n=(0,w.T)(),{data:a,isLoading:s}=Y(t),{data:i}=j(t,a.map((e=>e.transaction))),{data:r}=A(t,a.map((e=>e.transaction))),o=a.map((e=>({...e,metrics:i[e.transaction],metricSeries:r[e.transaction]})));return(0,h.tZ)($.ZP,{isLoading:s,data:o,columnOrder:G,columnSortBy:[],grid:{renderHeadCell:e=>(0,h.tZ)("span",{children:e.name}),renderBodyCell:(e,n)=>(0,h.tZ)(z,{span:t,column:e,row:n})},location:n})}function z(e){let{span:t,column:n,row:a}=e;return"transaction"===n.key?(0,h.tZ)(K,{span:t,row:a,column:n}):"p50"===n.key?(0,h.tZ)(U,{span:t,row:a,column:n}):"spm"===n.key?(0,h.tZ)(W,{span:t,row:a,column:n}):(0,h.tZ)("span",{children:a[n.key]})}function K(e){let{span:t,column:n,row:a}=e;return(0,h.BX)(S.Fragment,{children:[(0,h.tZ)(b.Z,{to:`/starfish/span/${encodeURIComponent(t.group_id)}?${E.stringify({transaction:a.transaction})}`,children:(0,h.tZ)(L.Z,{value:a[n.key],maxLength:50})}),(0,h.BX)("span",{children:[a.count," spans"]})]})}function U(e){let{row:t}=e;const n=(0,s.u)();return(0,h.tZ)(S.Fragment,{children:t.metricSeries?.p50?(0,h.tZ)(k.ZP,{color:R.$[3][0],series:t.metricSeries.p50,markLine:t.metrics?.p50?(0,k.Fk)(`${t.metrics.p50.toFixed(2)}`,t.metrics.p50,n):void 0}):null})}function W(e){let{row:t}=e;const n=(0,s.u)();return(0,h.tZ)(S.Fragment,{children:t.metricSeries?.spm?(0,h.tZ)(k.ZP,{color:R.$[3][1],series:t.metricSeries.spm,markLine:t.metrics?.spm?(0,k.Fk)(`${t.metrics.spm.toFixed(2)}`,t.metrics.spm,n):void 0}):null})}H.displayName="SpanTransactionsTable",z.displayName="BodyCell",K.displayName="TransactionCell",U.displayName="P50Cell",W.displayName="SPMCell";const G=[{key:"transaction",name:"Transaction",width:-1},{key:"spm",name:"SPM",width:-1},{key:"p50",name:"p50",width:-1}],V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-metrics";const n=e?J(e):"",{isLoading:a,error:s,data:i}=(0,B.aM)({queryKey:["span-metrics",e?.group_id],queryFn:()=>fetch(`${C.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:a,error:s,data:i[0]}},J=e=>`\n    SELECT\n    count() as count,\n    min(timestamp) as first_seen,\n    max(timestamp) as last_seen,\n    sum(exclusive_time) as total_time\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n `,Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-metrics-series";const n=e?ee(e):"",{isLoading:a,error:s,data:i}=(0,B.aM)({queryKey:["span-metrics-series",e?.group_id],queryFn:()=>fetch(`${C.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{isLoading:a,error:s,data:q()(["spm","p50","p95","failure_rate"].map((e=>{const t={seriesName:e,data:i.map((t=>({value:t[e],name:t.interval})))};return(0,N.b)(t,T().duration(12,"hours"))})),"seriesName")}},ee=e=>`\n  SELECT\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    count() as count,\n    divide(count, multiply(12, 60)) as spm,\n    quantile(0.95)(exclusive_time) as p95,\n    quantile(0.50)(exclusive_time) as p50,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as "failure_count",\n    "failure_count" / "count" as "failure_rate"\n  FROM spans_experimental_starfish\n  WHERE group_id = '${e.group_id}'\n  GROUP BY interval\n  ORDER BY interval\n`;var te=n("./app/views/starfish/modules/databaseModule/queries.ts");const ne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-first-seen-event";const{data:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"first-seen-span";const n=e?`\n    SELECT transaction_id\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    ORDER BY start_timestamp ASC\n    LIMIT 1\n `:null,a=(0,B.aM)({queryKey:["span","first",e?.group_id],queryFn:()=>fetch(`${C.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{...a,data:a.data[0]}}(e,t);return(0,te.Ep)(n?.transaction_id)},ae=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span-last-seen-event";const{data:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"last-seen-span";const n=e?`\n    SELECT transaction_id\n    FROM spans_experimental_starfish\n    WHERE group_id = '${e.group_id}'\n    ORDER BY start_timestamp DESC\n    LIMIT 1\n `:null,a=(0,B.aM)({queryKey:["span","last",e?.group_id],queryFn:()=>fetch(`${C.M}/?query=${n}&referrer=${t}`).then((e=>e.json())),retry:!1,initialData:[],enabled:Boolean(e)});return{...a,data:a.data[0]}}(e,t);return(0,te.Ep)(n?.transaction_id)};function se(e){let{span:t,onClose:n}=e;const a=(0,s.u)(),{data:l}=V(t),{data:c}=Q(t),{data:u}=ne(t),{data:m}=ae(t);return(0,h.BX)(p.Z,{detailKey:t?.group_id,onClose:n,children:[(0,h.tZ)(re,{children:(0,o.t)("Span Summary")}),(0,h.BX)(de,{children:[(0,h.BX)(ie,{title:(0,o.t)("First Seen"),children:[(0,h.tZ)(r.Z,{date:l?.first_seen}),u?.release&&(0,h.tZ)(g,{release:u?.release})]}),(0,h.BX)(ie,{title:(0,o.t)("Last Seen"),children:[(0,h.tZ)(r.Z,{date:l?.last_seen}),m?.release&&(0,h.tZ)(g,{release:m?.release})]}),(0,h.tZ)(ie,{title:(0,o.t)("Total Spans"),children:l?.count}),(0,h.tZ)(ie,{title:(0,o.t)("Total Time"),children:(0,h.tZ)(i.Z,{seconds:l?.total_time/1e3,fixedDigits:2,abbreviation:!0})})]}),(0,h.tZ)(de,{children:t&&(0,h.tZ)(ie,{title:(0,o.t)("Description"),children:(0,h.tZ)(v,{span:t})})}),(0,h.BX)(de,{children:[(0,h.tZ)(ie,{title:(0,o.t)("SPM"),children:(0,h.tZ)(d.Z,{statsPeriod:"24h",height:140,data:[c.spm],start:"",end:"",loading:!1,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0})}),(0,h.tZ)(ie,{title:(0,o.t)("Duration"),children:(0,h.tZ)(d.Z,{statsPeriod:"24h",height:140,data:[c.p50,c.p95],start:"",end:"",loading:!1,chartColors:a.charts.getColorPalette(4).slice(3,5),utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0})}),"http.client"===t?.span_operation?(0,h.tZ)(ie,{title:(0,o.t)("Failure Rate"),children:(0,h.tZ)(d.Z,{statsPeriod:"24h",height:140,data:[c.failure_rate],start:"",end:"",loading:!1,chartColors:[a.charts.getColorPalette(2)[2]],utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0})}):null]}),(0,h.tZ)(de,{children:t&&(0,h.tZ)(H,{span:t})})]})}function ie(e){let{title:t,children:n}=e;return(0,h.BX)(pe,{children:[(0,h.tZ)(oe,{children:t}),(0,h.tZ)(le,{children:n})]})}se.displayName="SpanSummaryPanel",ie.displayName="Block";const re=(0,a.Z)("h2",{target:"eykum1n4"})(""),oe=(0,a.Z)("h3",{target:"eykum1n3"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,l.D)(1),";"),le=(0,a.Z)("h4",{target:"eykum1n2"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),de=(0,a.Z)("div",{target:"eykum1n1"})("display:flex;&>div:last-child{padding-right:",(0,l.D)(1),";}padding-bottom:",(0,l.D)(2),";"),pe=(0,a.Z)("div",{target:"eykum1n0"})("padding-right:",(0,l.D)(4),";flex:1;")},"../node_modules/lodash/groupBy.js":(e,t,n)=>{var a=n("../node_modules/lodash/_baseAssignValue.js"),s=n("../node_modules/lodash/_createAggregator.js"),i=Object.prototype.hasOwnProperty,r=s((function(e,t,n){i.call(e,n)?e[n].push(t):a(e,n,[t])}));e.exports=r}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spans_spanSummaryPanel_index_tsx.c24a5e20db081c7c9f9a7c0d20393c61.js.map