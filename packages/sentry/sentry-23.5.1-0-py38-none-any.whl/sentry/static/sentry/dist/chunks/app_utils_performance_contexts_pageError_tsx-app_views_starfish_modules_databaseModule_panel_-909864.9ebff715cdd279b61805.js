"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_pageError_tsx-app_views_starfish_modules_databaseModule_panel_-909864"],{"./app/utils/performance/contexts/pageError.tsx":(e,t,s)=>{s.d(t,{De:()=>l,V_:()=>r,YY:()=>d});var n=s("../node_modules/react/index.js"),a=s("./app/components/alert.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const o=(0,n.createContext)({pageError:void 0,setPageError:e=>{}});function r(e){let{children:t}=e;const[s,a]=(0,n.useState)();return(0,i.tZ)(o.Provider,{value:{pageError:s,setPageError:a},children:t})}function d(){const{pageError:e}=(0,n.useContext)(o);return e?(0,i.tZ)(a.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}r.displayName="PageErrorProvider",d.displayName="PageErrorAlert";const l=()=>(0,n.useContext)(o)},"./app/utils/useKeyPress.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("../node_modules/react/index.js");const a=(e,t)=>{const[s,a]=(0,n.useState)(!1),i=t??document.body;return(0,n.useEffect)((()=>{const t=t=>{let{key:s}=t;s===e&&a(!0)},s=t=>{let{key:s}=t;s===e&&a(!1)};return i.addEventListener("keydown",t),i.addEventListener("keyup",s),()=>{i.removeEventListener("keydown",t),i.removeEventListener("keyup",s)}}),[e,i]),s}},"./app/utils/useOnClickOutside.tsx":(e,t,s)=>{s.d(t,{Z:()=>a});var n=s("../node_modules/react/index.js");const a=function(e,t){(0,n.useEffect)((()=>{const s=s=>{const n=e?.current;n&&!n.contains(s.target)&&t(s)};return document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}}),[e,t])}},"./app/views/starfish/components/detailPanel.tsx":(e,t,s)=>{s.d(t,{Z:()=>x});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("../node_modules/react/index.js"),i=s("./app/components/button.tsx"),o=s("./app/icons/iconClose.tsx"),r=s("./app/locale.tsx"),d=s("./app/styles/space.tsx"),l=s("./app/utils/useKeyPress.tsx"),c=s("./app/utils/useOnClickOutside.tsx"),p=s("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),u=s("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),m=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h="50vw",g=(0,a.forwardRef)(f);function f(e,t){let{collapsed:s,children:n}=e;return(0,m.tZ)(v,{ref:t,collapsed:s,initial:{opacity:0,x:h},animate:s?{opacity:0,x:h}:{opacity:1,x:0},transition:{type:"spring",stiffness:500,damping:50},children:n})}f.displayName="SlideOverPanel";const v=(0,n.Z)(u.E.div,{shouldForwardProp:e=>["animate","transition"].includes(e)||"collapsed"!==e&&(0,p.Z)(e),target:"e1iwvxg00"})("width:",h,";position:fixed;top:0;bottom:0;right:0;background:",(e=>e.theme.background),";color:",(e=>e.theme.textColor),";border-left:1px solid ",(e=>e.theme.border),";text-align:left;z-index:",(e=>e.theme.zIndex.sidebar-1),";",(e=>e.collapsed?"overflow: hidden;":"overflow-x: hidden;\n  overflow-y: scroll;"),";");function x(e){let{children:t,detailKey:s,onClose:n}=e;const[i,d]=(0,a.useState)({collapsed:!0}),p=(0,l.Z)("Escape");(0,a.useEffect)((()=>{s&&d({collapsed:!1})}),[s]);const u=(0,a.useRef)(null);return(0,c.Z)(u,(()=>{i.collapsed||(n?.(),d({collapsed:!0}))})),(0,a.useEffect)((()=>{p&&(i.collapsed||(n?.(),d({collapsed:!0})))}),[p]),(0,m.BX)(g,{collapsed:i.collapsed,ref:u,children:[(0,m.tZ)(b,{children:(0,m.tZ)(Z,{priority:"link",size:"zero",borderless:!0,"aria-label":(0,r.t)("Close Details"),icon:(0,m.tZ)(o.b,{size:"sm"}),onClick:()=>{d({collapsed:!0}),n?.()}})}),(0,m.tZ)(y,{children:t})]})}x.displayName="Detail";const Z=(0,n.Z)(i.zx,{target:"e1clb2dw2"})("color:",(e=>e.theme.gray300),";&:hover{color:",(e=>e.theme.gray400),";}"),b=(0,n.Z)("div",{target:"e1clb2dw1"})("justify-content:flex-end;display:flex;padding:",(0,d.D)(2),";"),y=(0,n.Z)("div",{target:"e1clb2dw0"})("padding:0 ",(0,d.D)(4),";")},"./app/views/starfish/components/formattedCode.tsx":(e,t,s)=>{s.d(t,{K:()=>i});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=s("./app/styles/space.tsx");const i=(0,n.Z)("div",{target:"e1enucjs0"})("padding:",(0,a.D)(1),";margin-bottom:",(0,a.D)(3),";background:",(e=>e.theme.backgroundSecondary),";border-radius:",(e=>e.theme.borderRadius),";overflow-x:auto;white-space:pre;")},"./app/views/starfish/modules/databaseModule/panel/index.tsx":(e,t,s)=>{s.d(t,{ZP:()=>A,_b:()=>U});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),i=s("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),o=s("../node_modules/lodash/keyBy.js"),r=s.n(o),d=s("../node_modules/moment/moment.js"),l=s.n(d),c=s("./app/components/badge.tsx"),p=s("./app/components/button.tsx"),u=s("./app/components/buttonBar.tsx"),m=s("./app/components/timeSince.tsx"),h=s("./app/components/version.tsx"),g=s("./app/components/versionHoverCard.tsx"),f=s("./app/icons/index.tsx"),v=s("./app/locale.tsx"),x=s("./app/styles/space.tsx"),Z=s("./app/utils/useOrganization.tsx"),b=s("./app/utils/usePageFilters.tsx"),y=s("./app/views/starfish/components/chart.tsx"),w=s("./app/views/starfish/components/detailPanel.tsx"),k=s("./app/views/starfish/components/formattedCode.tsx"),L=s("./app/views/starfish/components/sparkline.tsx"),S=s("./app/components/events/interfaces/spans/spanProfileDetails.tsx"),C=s("./app/components/loadingIndicator.tsx"),_=s("./app/views/profiling/profileGroupProvider.tsx"),P=s("./app/views/profiling/profilesProvider.tsx"),E=s("./app/views/starfish/modules/databaseModule/queries.ts"),j=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function B(e){const{spanHash:t,transactionNames:s}=e,n=(0,Z.Z)(),[i,o]=(0,a.useState)(0),r=(0,E.uw)(s),d=r?.data?.data?.map((e=>e.id))??[],l=(0,E.Ep)(d[i]);if(r.isLoading||l.isLoading||l.isRefetching)return(0,j.tZ)(C.Z,{});const c=()=>{o(i+1)};if(l.data.id&&i<d.length){const e=l.data,s=e.entries[0].data.find((e=>e.hash===t)),a=e.contexts?.profile?.profile_id??void 0;if(s&&a)return(0,j.tZ)(P.ProfilesProvider,{orgSlug:n.slug,profileId:a,projectSlug:"sentry",children:(0,j.tZ)(P.ProfileContext.Consumer,{children:t=>(0,j.tZ)(_.D,{type:"flamechart",input:"resolved"===t?.type?t.data:null,traceID:a||"",children:(0,j.tZ)(S.O,{onNoProfileFound:c,event:e,span:s})})})});c()}return(0,j.tZ)(a.Fragment,{children:"'No profile found'"})}B.displayName="ProfileView";const D=B;var X=s("./app/views/starfish/modules/databaseModule/panel/queryTransactionTable.tsx"),N=s("./app/components/gridEditable/index.tsx"),R=s("./app/utils/useLocation.tsx"),F=s("./app/views/starfish/modules/databaseModule/databaseTableView.tsx");const T=[{key:"description",name:"Query",width:300},{key:"epm",name:"Tpm"},{key:"p50",name:"p50"},{key:"p95",name:"p95"},{key:"total_time",name:"Total Time"}];function z(e){const{mainTableRow:t}=e,{isLoading:s,data:n}=(0,E.$R)({limit:410}),o=(0,R.T)(),r=(0,i.u)(),d=n.filter((e=>(0,F.h)(e.description,t.description)>.8));return!s&&d.length>0?(0,j.tZ)(N.ZP,{isLoading:s,data:d,columnOrder:T,columnSortBy:[],grid:{renderHeadCell:e=>(0,j.tZ)("span",{children:e.name}),renderBodyCell:(e,s)=>{const{key:n}=e;let i=s[n];if("description"===n){const e=new Set(t.description.split(" "));i=(0,j.tZ)("div",{children:s.description.split(" ").map((t=>e.has(t)?`${t} `:(0,j.tZ)("span",{style:{color:r.green400},children:`${t} `},t)))})}const o=["p50","p95","total_time"];if(["epm",...o].includes(n)){const e=s[n],d=t[n],l=e>d?"+":"",c=100*(e/d-1);let p="";o.includes(n)&&(p="ms"),i=(0,j.BX)(a.Fragment,{children:[e.toFixed(3),p," (",l,(0,j.BX)("span",{style:{color:l?r.red400:r.green400},children:[c.toFixed(2),"%"]}),")"]})}return(0,j.tZ)("span",{children:i})}},location:o}):(0,j.tZ)(a.Fragment,{})}z.displayName="SimilarQueryView";const O=z;var q=s("./app/views/starfish/modules/databaseModule/utils.ts"),M=s("./app/views/starfish/utils/dates.tsx"),H=s("./app/views/starfish/utils/zeroFillSeries.tsx");const I=12,Q=24;function A(e){let{row:t,nextRow:s,prevRow:n,isDataLoading:a,onClose:i,onRowChange:o,mainTableSort:r,transaction:d}=e;return(0,j.tZ)(w.Z,{detailKey:t?.description,onClose:i,children:t&&(0,j.tZ)(K,{mainTableSort:r,onRowChange:o,isDataLoading:a,row:t,nextRow:s,prevRow:n,transaction:d})})}function K(e){let{row:t,nextRow:s,prevRow:n,onRowChange:o,transaction:d,isDataLoading:p}=e;const u=(0,i.u)(),f=(0,b.Z)(),x=(0,Z.Z)(),{startTime:w,endTime:S}=(0,M.tZ)(f),C=1===t.newish,_=1===t.retired,[P,B]=(0,a.useState)({direction:void 0,sortHeader:void 0}),{isLoading:N,data:R}=(0,E.gy)(t,I),{isLoading:F,data:T}=(0,E.c0)(t,P.sortHeader?.key,P.direction,d),{isLoading:z,data:H}=(0,E.W3)(t,P.sortHeader?.key,P.direction,Q,d),{isLoading:A,data:K}=(0,E.Tu)(T.map((e=>e.transaction)).splice(0,5),Q),{isLoading:ee,data:te}=(0,E.Yy)(t),{isLoading:se,data:ne}=(0,E.mi)(t),{isLoading:ae,data:ie}=(0,E.Ep)(ne?.[0]?.first),{isLoading:oe,data:re}=(0,E.Ep)(ne?.[0]?.latest),de=N||F||ee||p||A||se||ae||oe||z,le=r()(te,"transaction"),ce=T.map((e=>{const t=e.transaction,s=le[t];if(s?.uniqueEvents){const t=e.count/s.uniqueEvents;return{...e,frequency:t,...s}}return e})),[pe,ue,me]=Y(R,w,S),he=(0,q.F)(H,"transaction","spm",w,S,Q),ge=(0,q.F)(H,"transaction","p50",w,S,Q),fe=(0,q.F)(K,"group","epm()",w,S,Q),ve=(0,q.F)(K,"group","p50(transaction.duration)",w,S,Q),xe=he?.[0]?.data&&(C||_)?(0,L.Ci)(C?"First Seen":"Last Seen",C?t.firstSeen:t.lastSeen,he[0].data,u):void 0;return(0,j.BX)("div",{children:[(0,j.BX)(G,{children:[(0,j.tZ)(J,{children:(0,j.tZ)("h2",{children:(0,v.t)("Query Detail")})}),(0,j.tZ)(J,{children:(0,j.tZ)(V,{disableLeft:!n,disableRight:!s,onLeftClick:()=>o(n),onRightClick:()=>o(s)})})]}),(0,j.BX)(G,{children:[(0,j.BX)(J,{children:[(0,j.BX)($,{children:[(0,v.t)("First Seen"),1===t.newish&&(0,j.tZ)(c.Z,{type:"new",text:"new"})]}),Math.abs(l()(t.firstSeen).diff(w,"minutes"))<720?(0,j.BX)(W,{children:["More than ",(0,j.tZ)(m.Z,{date:t.firstSeen})," "]}):(0,j.BX)("span",{children:[(0,j.BX)(W,{children:[(0,j.tZ)(m.Z,{date:t.firstSeen})," "]}),ie?.release&&(0,j.tZ)(g.ZP,{organization:x,projectSlug:"sentry",releaseVersion:ie.release.version,showUnderline:!0,underlineColor:"linkUnderline",children:(0,j.tZ)(h.Z,{version:String(ie.release.version),truncate:!0})})]})]}),(0,j.BX)(J,{children:[(0,j.BX)($,{children:[(0,v.t)("Last Seen"),1===t.retired&&(0,j.tZ)(c.Z,{type:"warning",text:"old"})]}),(0,j.tZ)(W,{children:(0,j.tZ)(m.Z,{date:t.lastSeen})}),re?.release&&(0,j.tZ)(g.ZP,{organization:x,projectSlug:"sentry",releaseVersion:re.release.version,showUnderline:!0,underlineColor:"linkUnderline",children:(0,j.tZ)(h.Z,{version:String(re.release.version),truncate:!0})})]}),(0,j.BX)(J,{children:[(0,j.tZ)($,{children:(0,v.t)("Total Time")}),(0,j.BX)(W,{children:[t.total_time.toFixed(2),"ms"]})]})]}),(0,j.tZ)($,{children:(0,v.t)("Query Description")}),(0,j.tZ)(k.K,{children:U(t.formatted_desc,t)}),(0,j.BX)(G,{children:[(0,j.BX)(J,{children:[(0,j.tZ)($,{children:(0,v.t)("Throughput (Spans Per Minute)")}),(0,j.tZ)(W,{children:t.epm.toFixed(3)}),(0,j.tZ)(y.Z,{statsPeriod:"24h",height:140,data:[pe],start:"",end:"",loading:de,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0})]}),(0,j.BX)(J,{children:[(0,j.tZ)($,{children:(0,v.t)("Duration P50 / P95")}),(0,j.BX)(W,{children:[t.p50.toFixed(3),"ms / ",t.p95.toFixed(3),"ms"]}),(0,j.tZ)(y.Z,{statsPeriod:"24h",height:140,data:[ue,me],start:"",end:"",loading:de,utc:!1,chartColors:u.charts.getColorPalette(4).slice(3,5),stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0})]})]}),(0,j.tZ)(X.Z,{isDataLoading:de,onClickSort:e=>B(e),row:t,sort:P,tableData:ce,spmData:he,tpmData:fe,spanP50Data:ge,txnP50Data:ve,markLine:xe}),(0,j.tZ)(G,{children:(0,j.BX)(J,{children:[(0,j.tZ)($,{children:(0,v.t)("Example Profile")}),(0,j.tZ)(D,{spanHash:t.group_id,transactionNames:T.map((e=>e.transaction))})]})}),(0,j.tZ)(G,{children:(0,j.BX)(J,{children:[(0,j.tZ)($,{children:(0,v.t)("Similar Queries")}),(0,j.tZ)(O,{mainTableRow:t})]})})]})}function V(e){return(0,j.BX)(u.ZP,{merged:!0,children:[(0,j.tZ)(p.zx,{icon:(0,j.tZ)(f.g6,{direction:"left",size:"sm"}),"aria-label":(0,v.t)("Previous"),disabled:e.disableLeft,onClick:e.onLeftClick}),(0,j.tZ)(p.zx,{icon:(0,j.tZ)(f.g6,{direction:"right",size:"sm"}),"aria-label":(0,v.t)("Next"),onClick:e.onRightClick,disabled:e.disableRight})]})}A.displayName="QueryDetail",K.displayName="QueryDetailBody",V.displayName="SimplePagination";const U=(e,t)=>{let s="";return e.split("").map(((n,a)=>{s+=n;let i=null;if(s===t.action?i=(0,j.BX)(ee,{children:[t.action," "]},a):s===t.domain?i=(0,j.BX)(te,{children:[t.domain," "]},a):["FROM","INNER","JOIN","WHERE","ON","AND","NOT","NULL","IS"].includes(s)?i=(0,j.tZ)(se,{children:s},a):["(",")"].includes(s)?i=(0,j.tZ)(ne,{children:s},a):(" "===n||"\n"===n||")"===e[a+1]||a===e.length-1)&&(i=s),i){s="";const e=i;return i=null,e}return null}))},Y=(e,t,s)=>{const n={seriesName:"spm()",data:[]},a={seriesName:"p50()",data:[]},i={seriesName:"p95()",data:[]};return e.forEach((e=>{let{count:t,p50:s,p95:o,interval:r}=e;n.data.push({value:t,name:r}),a.data.push({value:s,name:r}),i.data.push({value:o,name:r})})),[(0,H.b)(n,l().duration(I,"hours"),t,s),(0,H.b)(a,l().duration(I,"hours"),t,s),(0,H.b)(i,l().duration(I,"hours"),t,s)]},$=(0,n.Z)("h3",{target:"e1gfmqvs7"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeLarge),";"),W=(0,n.Z)("h4",{target:"e1gfmqvs6"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),G=(0,n.Z)("div",{target:"e1gfmqvs5"})("display:flex;&>div:last-child{padding-right:",(0,x.D)(1),";}padding-bottom:",(0,x.D)(2),";"),J=(0,n.Z)("div",{target:"e1gfmqvs4"})("padding-right:",(0,x.D)(4),";flex:1;"),ee=(0,n.Z)("b",{target:"e1gfmqvs3"})("color:",(e=>e.theme.blue400),";"),te=(0,n.Z)("b",{target:"e1gfmqvs2"})("color:",(e=>e.theme.green400),";margin-right:-",(0,x.D)(.5),";"),se=(0,n.Z)("b",{target:"e1gfmqvs1"})("color:",(e=>e.theme.yellow400),";"),ne=(0,n.Z)("b",{target:"e1gfmqvs0"})("color:",(e=>e.theme.pink400),";")},"./app/views/starfish/modules/databaseModule/utils.ts":(e,t,s)=>{s.d(t,{F:()=>o}),s("../node_modules/core-js/modules/es.array.push.js");var n=s("../node_modules/moment/moment.js"),a=s.n(n),i=s("./app/views/starfish/utils/zeroFillSeries.tsx");const o=(e,t,s,n,o,r,d)=>{const l={};return e.forEach((e=>{const n={value:e[s],name:e.interval};l[e[t]]||(l[e[t]]={seriesName:e[t],data:[]}),void 0!==n.value&&l[e[t]].data.push(n)})),n&&o&&r?Object.values(l).map((e=>(0,i.b)(e,a().duration(r,"hours"),n,o,d))):Object.values(l)}}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_pageError_tsx-app_views_starfish_modules_databaseModule_panel_-909864.4b75d9cfb071a7db6a59a02d6e743c08.js.map