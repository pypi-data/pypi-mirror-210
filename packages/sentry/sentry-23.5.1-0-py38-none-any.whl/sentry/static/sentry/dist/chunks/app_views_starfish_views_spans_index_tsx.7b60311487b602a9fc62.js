"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_spans_index_tsx"],{"./app/components/gridEditable/sortLink.tsx":(e,t,n)=>{n.d(t,{Z:()=>u});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=n("../node_modules/react-router/es/index.js"),s=n("./app/components/links/link.tsx"),r=n("./app/icons/index.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{align:t,title:n,canSort:a,generateSortLink:s,onClick:r,direction:l,replace:u}=e;const m=s();if(!m||!a)return(0,o.tZ)(p,{align:t,children:n});const h=l?(0,o.tZ)(c,{size:"xs",direction:"desc"===l?"down":"up"}):null;return(0,o.BX)(d,{align:t,to:m,onClick:e=>{u&&(e.preventDefault(),i.browserHistory.replace(m)),r?.(e)},children:[n," ",h]})}l.displayName="SortLink";const d=(0,a.Z)((e=>{const{align:t,css:n,...a}=e;return(0,o.tZ)(s.Z,{...a})}),{target:"esdhr0u2"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(e=>e.align?`text-align: ${e.align};`:""),";"),p=(0,a.Z)("div",{target:"esdhr0u1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),c=(0,a.Z)(r.CC,{target:"esdhr0u0"})({name:"40f4ru",styles:"vertical-align:top"}),u=l},"./app/components/searchBar.tsx":(e,t,n)=>{n.d(t,{Z:()=>x,p:()=>g});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=n("../node_modules/react/index.js"),s=n("./app/components/button.tsx"),r=n("./app/components/inputGroup.tsx"),o=n("./app/icons/index.tsx"),l=n("./app/icons/iconClose.tsx"),d=n("./app/locale.tsx"),p=n("./app/styles/space.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{query:t,defaultQuery:n="",onChange:a,onSearch:s,width:p,size:u,className:x,trailing:_,...y}=e;const v=(0,i.useRef)(null),[f,Z]=(0,i.useState)(t??n);(0,i.useEffect)((()=>{"string"==typeof t&&Z(t)}),[t]);const k=(0,i.useCallback)((e=>{const{value:t}=e.target;Z(t),a?.(t)}),[a]),b=(0,i.useCallback)((e=>{e.preventDefault(),v.current?.blur(),s?.(f)}),[s,f]),w=(0,i.useCallback)((()=>{Z(""),a?.(""),s?.("")}),[a,s]);return(0,c.tZ)(m,{onSubmit:b,className:x,children:(0,c.BX)(r.BZ,{children:[(0,c.tZ)(r.BZ.LeadingItems,{disablePointerEvents:!0,children:(0,c.tZ)(o.jV,{color:"subText",size:"xs"===u?"xs":"sm"})}),(0,c.tZ)(h,{...y,ref:v,type:"text",name:"query",autoComplete:"off",value:f,onChange:k,width:p,size:u}),(0,c.BX)(r.BZ.TrailingItems,{children:[_,!!f&&(0,c.tZ)(g,{size:"zero",borderless:!0,onClick:w,icon:(0,c.tZ)(l.b,{size:"xs"}),"aria-label":(0,d.t)("Clear")})]})]})})}u.displayName="SearchBar";const m=(0,a.Z)("form",{target:"elu65nr2"})({name:"4bgdod",styles:"display:block;position:relative"}),h=(0,a.Z)(r.BZ.Input,{target:"elu65nr1"})((e=>e.width&&`width: ${e.width};`),";"),g=(0,a.Z)(s.zx,{target:"elu65nr0"})("color:",(e=>e.theme.subText),";padding:",(0,p.D)(.5),";"),x=u},"./app/views/starfish/views/spans/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>de});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=n("../node_modules/react/index.js"),s=n("./app/components/layouts/thirds.tsx"),r=n("./app/components/organizations/pageFilters/container.tsx"),o=n("./app/locale.tsx"),l=n("./app/styles/space.tsx"),d=n("./app/utils/performance/contexts/pageError.tsx"),p=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{kkey:t,value:n}=e;return(0,c.BX)(m,{children:[(0,c.tZ)(g,{children:t}),(0,c.tZ)(x,{children:":"}),(0,c.tZ)(_,{children:n})]})}u.displayName="Filter";const m=(0,a.Z)("span",{target:"e1adjr1l3"})("--token-bg:",(e=>e.theme.searchTokenBackground.valid),";--token-border:",(e=>e.theme.searchTokenBorder.valid),";--token-value-color:",(e=>e.theme.blue400),";position:relative;"),h=(0,p.iv)("background:var(--token-bg);border:0.5px solid var(--token-border);padding:",(0,l.D)(.25)," 0;",""),g=(0,a.Z)("span",{target:"e1adjr1l2"})(h,";border-right:none;font-weight:bold;border-radius:2px 0 0 2px;padding-left:1px;margin-left:-2px;"),x=(0,a.Z)("span",{target:"e1adjr1l1"})(h,";border-left:none;border-right:none;margin:-1px 0;color:",(e=>e.theme.pink400),";"),_=(0,a.Z)("span",{target:"e1adjr1l0"})(h,";border-left:none;border-radius:0 2px 2px 0;color:var(--token-value-color);margin:-1px -2px -1px 0;padding-right:1px;");var y=n("./app/views/starfish/modules/databaseModule/panel/index.tsx"),v=n("./app/views/starfish/views/spans/spanSummaryPanel/index.tsx");function f(e){let{row:t,onClose:n}=e;return"db"===t?.span_operation?(0,c.tZ)(y.ZP,{row:t,onClose:n,isDataLoading:!1,mainTableSort:{direction:void 0,sortHeader:void 0},onRowChange:()=>null}):(0,c.tZ)(v.U,{span:t,onClose:n})}var Z=n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),k=n("./app/components/datePageFilter.tsx"),b=n("./app/components/searchBar.tsx"),w=n("./app/utils/usePageFilters.tsx"),S=n("./app/views/starfish/utils/constants.tsx"),C=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),$=n("../node_modules/moment/moment.js"),B=n.n($),D=n("./app/utils/useLocation.tsx"),j=n("./app/views/starfish/components/breakdownBar.tsx"),q=n("./app/views/starfish/components/chart.tsx"),T=n("./app/views/starfish/components/chartPanel.tsx"),E=n("./app/views/starfish/utils/dates.tsx"),N=n("./app/views/starfish/utils/useSpansQuery.tsx"),O=n("./app/views/starfish/utils/zeroFillSeries.tsx");function A(e){let{descriptionFilter:t,queryConditions:n}=e;const a=(0,C.u)(),i=(0,D.T)(),s=(0,w.Z)(),[r,l,d]=s.selection.datetime.period?.match(E.Pr)??[],p=l&&d?B()().subtract(l,d):B()(s.selection.datetime.start),u=B()(s.selection.datetime.end??void 0),{isLoading:m,data:h}=(0,N.bB)({queryString:`${L(s.selection.datetime,t,n)}&referrer=span-time-charts`,initialData:[]}),{span_operation:g,action:x,domain:_}=i.query,y=(0,j.c_)(g,x,_),v={[y]:h},f=Object.keys(v).map((e=>{const t=v[e];return(0,O.b)({seriesName:y??"Throughput",data:t.map((e=>({value:e.throughput,name:e.interval})))},B().duration(1,"day"),p,u)})),Z=Object.keys(v).map((e=>{const t=v[e];return(0,O.b)({seriesName:y??"Total Time",data:t.map((e=>({value:e.total_time,name:e.interval})))},B().duration(1,"day"),p,u)})),k=Object.keys(v).map((e=>{const t=v[e];return(0,O.b)({seriesName:y??"P50",data:t.map((e=>({value:e.p50,name:e.interval})))},B().duration(1,"day"),p,u)}));return(0,q.K)([!m]),(0,c.BX)(R,{children:[(0,c.tZ)(P,{children:(0,c.tZ)(T.Z,{title:(0,o.t)("Total Time"),children:(0,c.tZ)(q.Z,{statsPeriod:"24h",height:100,data:Z,start:"",end:"",loading:m,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,chartColors:a.charts.getColorPalette(2),disableXAxis:!0})})}),(0,c.tZ)(P,{children:(0,c.tZ)(T.Z,{title:(0,o.t)("Throughput"),children:(0,c.tZ)(q.Z,{statsPeriod:"24h",height:100,data:f,start:"",end:"",loading:m,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:a.charts.getColorPalette(2),disableXAxis:!0})})}),(0,c.tZ)(P,{children:(0,c.tZ)(T.Z,{title:(0,o.t)("p50"),children:(0,c.tZ)(q.Z,{statsPeriod:"24h",height:100,data:k,start:"",end:"",loading:m,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:a.charts.getColorPalette(2),disableXAxis:!0})})})]})}A.displayName="SpanTimeCharts";const L=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const{start_timestamp:a,end_timestamp:i}=(0,E.SW)(e),s=n.filter(Boolean);return`SELECT\n    count() AS throughput,\n    sum(exclusive_time) AS total_time,\n    quantile(0.50)(exclusive_time) AS p50,\n    toStartOfInterval(start_timestamp, INTERVAL 1 DAY) as interval\n    FROM spans_experimental_starfish\n    WHERE greaterOrEquals(start_timestamp, '${a}')\n    ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n    ${s.length>0?"AND":""}\n    ${s.join(" AND ")}\n    ${t?`AND match(lower(description), '${t}')`:""}\n    GROUP BY interval\n    ORDER BY interval ASC\n  `},R=(0,a.Z)("div",{target:"e1evs38o1"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,l.D)(2),";"),P=(0,a.Z)("div",{target:"e1evs38o0"})({name:"82a6rk",styles:"flex:1"}),F=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const{start_timestamp:s,end_timestamp:r}=(0,E.SW)(t),o=n.filter(Boolean);return`SELECT\n    group_id, span_operation, description, domain,\n    sum(exclusive_time) as total_exclusive_time,\n    uniq(transaction) as transactions,\n    quantile(0.95)(exclusive_time) as p95,\n    quantile(0.75)(exclusive_time) as p75,\n    quantile(0.50)(exclusive_time) as p50,\n    count() as count,\n    (divide(count, ${(B()(r??void 0).unix()-B()(s).unix())/60}) AS epm)\n    FROM spans_experimental_starfish\n    WHERE greaterOrEquals(start_timestamp, '${s}')\n    ${o.length>0?"AND":""}\n    ${o.join(" AND ")}\n    ${r?`AND lessOrEquals(start_timestamp, '${r}')`:""}\n    ${e?`AND match(lower(description), '${e}')`:""}\n    GROUP BY group_id, span_operation, domain, description\n    ORDER BY ${a??"count"} desc\n    ${i?`LIMIT ${i}`:""}`},z=(e,t,n)=>{const{start_timestamp:a,end_timestamp:i}=(0,E.SW)(t);return`\n    SELECT\n    group_id, span_operation,\n    toStartOfInterval(start_timestamp, INTERVAL 1 DAY) as interval,\n    quantile(0.50)(exclusive_time) as p50_trend,\n    quantile(0.95)(exclusive_time) as p95_trend,\n    divide(count(), multiply(24, 60)) as throughput\n    FROM spans_experimental_starfish\n    WHERE greaterOrEquals(start_timestamp, '${a}')\n    ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n    AND group_id IN (${n.map((e=>`'${e}'`)).join(",")})\n    ${e?`AND match(lower(description), '${e}')`:""}\n    GROUP BY group_id, span_operation, interval\n    ORDER BY interval asc\n  `};n("../node_modules/core-js/modules/es.array.push.js");var X=n("./app/components/duration.tsx"),I=n("./app/components/gridEditable/index.tsx"),Y=n("./app/components/gridEditable/sortLink.tsx"),W=n("./app/components/links/link.tsx"),H=n("./app/constants/chartPalette.tsx"),M=n("./app/utils/formatters.tsx"),U=n("./app/views/starfish/components/formattedCode.tsx"),V=n("./app/views/starfish/components/sparkline.tsx");function G(e){let{location:t,spansData:n,orderBy:a,onSetOrderBy:i,queryConditions:s,spansTrendsData:r,isLoading:o,onSelect:l}=e;const d=(0,C.u)(),p={p50_trend:{},p95_trend:{},throughput:{}};r?.forEach((e=>{let{group_id:t,span_operation:n,interval:a,...i}=e;["p50_trend","p95_trend","throughput"].forEach((e=>n in p[e]?t in p[e][n]?p[e][n][t].push({name:a,value:i[e]}):p[e][n][t]=[{name:a,value:i[e]}]:p[e][n]={[t]:[{name:a,value:i[e]}]}))}));const u=n?.map((e=>{const{group_id:t,span_operation:n}=e;if(void 0===p.p50_trend?.[n])return e;const a={seriesName:"p50_trend",data:p.p50_trend[n][t]},i={seriesName:"p95_trend",data:p.p95_trend[n][t]},s={seriesName:"throughput_trend",data:p.throughput[n][t]},r=(0,O.b)(a,B().duration(1,"day")),o=(0,O.b)(i,B().duration(1,"day")),l=(0,O.b)(s,B().duration(1,"day"));return{...e,p50_trend:r,p95_trend:o,throughput_trend:l}}));return(0,c.tZ)(I.ZP,{isLoading:o,data:u,columnOrder:J(s),columnSortBy:a?[]:[{key:a,order:"desc"}],grid:{renderHeadCell:K(a,i),renderBodyCell:(e,t)=>function(e,t,n,a){if("throughput_trend"===e.key&&t[e.key]){const a=(0,V.Fk)(`${t.epm.toFixed(2)}`,t.epm,n);return(0,c.tZ)(V.ZP,{color:H.$[3][0],series:t[e.key],width:e.width?e.width-e.width/5:void 0,markLine:a})}if("p50_trend"===e.key&&t[e.key]){const a=(0,V.Fk)(`${(0,M.g9)(t.p50/1e3,2,!0)}`,t.p50,n);return(0,c.tZ)(V.ZP,{color:H.$[3][1],series:t[e.key],width:e.width?e.width-e.width/5:void 0,markLine:a})}if("p95_trend"===e.key&&t[e.key]){const a=(0,V.Fk)(`${(0,M.g9)(t.p95/1e3,2,!0)}`,t.p95,n);return(0,c.tZ)(V.ZP,{color:H.$[3][2],series:t[e.key],width:e.width?e.width-e.width/5:void 0,markLine:a})}if("description"===e.key){const e=Q(t,t.span_operation);return(0,c.tZ)(te,{children:(0,c.tZ)(W.Z,{onClick:()=>a?.(e),to:"",children:"db"===t.span_operation?(0,c.tZ)(ee,{children:t.formatted_desc}):t.description||"<null>"})})}return e.key.toString().match(/^p\d\d/)||"total_exclusive_time"===e.key?(0,c.tZ)(X.Z,{seconds:t[e.key]/1e3,fixedDigits:2,abbreviation:!0}):t[e.key]}(e,t,d,l)},location:t})}function K(e,t){return function(n){return(0,c.tZ)(Y.Z,{align:"left",canSort:!0,direction:e===n.key?"desc":void 0,onClick:()=>{t(`${n.key}`)},title:n.name,generateSortLink:()=>({...location})})}}G.displayName="SpansTable";const Q=(e,t)=>{switch(t){case"http.client":return{...e,"p50(span.self_time)":e.p50,"p95(span.self_time)":e.p95};case"db":return{...e,total_time:e.total_exclusive_time};default:return e}};function J(e){const t=function(e){return e.includes("span_operation = 'db'")?"Query":e.includes("span_operation = 'http.client'")?"URL":"Description"}(e),n=function(e){return e.includes("span_operation = 'db'")?"Table":e.includes("span_operation = 'http.client'")?"Host":"Domain"}(e),a=e.some((e=>e.includes("domain =")));return[!e.some((e=>e.includes("span_operation =")))&&{key:"span_operation",name:"Operation",width:I.z7},{key:"description",name:t,width:I.z7},!a&&{key:"domain",name:n,width:I.z7},{key:"total_exclusive_time",name:"Total Time",width:I.z7},{key:"transactions",name:"Transactions",width:I.z7},{key:"throughput_trend",name:"throughput (spm)",width:175},{key:"p50_trend",name:"p50 trend",width:175},{key:"p95_trend",name:"p95 trend",width:175}].filter((e=>Boolean(e)))}const ee=(0,a.Z)(U.K,{target:"e5rrkpr1"})({name:"6wvegy",styles:"background:none;text-overflow:ellipsis"}),te=(0,a.Z)("span",{target:"e5rrkpr0"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"}),ne=25;function ae(e){const t=e.location,n=(0,w.Z)(),[a,s]=(0,i.useState)({orderBy:"total_exclusive_time"}),[r,o]=(0,i.useState)(""),[l,d]=(0,i.useState)(!1),{orderBy:p}=a,u=l&&r?`${r}`:void 0,m=le(t),{isLoading:h,data:g}=(0,Z.a)({queryKey:["spans",u,p,n.selection.datetime],queryFn:()=>fetch(`${S.M}/?query=${F(u,n.selection.datetime,m,p,ne)}&format=sql`).then((e=>e.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[]}),x=g.map((e=>{let{group_id:t}=e;return t})),{isLoading:_,data:y}=(0,Z.a)({queryKey:["spansTrends",u],queryFn:()=>fetch(`${S.M}/?query=${z(u,n.selection.datetime,x)}`).then((e=>e.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[],enabled:x.length>0});return(0,c.BX)(i.Fragment,{children:[(0,c.tZ)(se,{children:(0,c.tZ)(k.Z,{alignDropdown:"left"})}),(0,c.tZ)(ie,{children:(0,c.tZ)(b.Z,{onChange:e=>{o(e),d(!1)},placeholder:"Search Spans",query:r,onSearch:()=>{d(!0)}})}),(0,c.tZ)(ie,{children:(0,c.tZ)(A,{descriptionFilter:u||"",queryConditions:m})}),(0,c.tZ)(ie,{children:(0,c.tZ)(G,{location:e.location,queryConditions:m,isLoading:h||_,spansData:g,orderBy:p,onSetOrderBy:e=>s({orderBy:e}),spansTrendsData:y,onSelect:e.onSelect})})]})}ae.displayName="SpansView";const ie=(0,a.Z)("div",{target:"e1ojq8vq1"})("margin:",(0,l.D)(2),";"),se=(0,a.Z)(ie,{target:"e1ojq8vq0"})("display:flex;flex-direction:row;gap:",(0,l.D)(1),";margin-bottom:",(0,l.D)(2),";"),re=["action","span_operation","domain"],oe={action:"Action",span_operation:"Operation",domain:"Domain"},le=e=>{const{query:t}=e;return Object.keys(t).filter((e=>re.includes(e))).map((e=>`${e} = '${t[e]}'`))};function de(e){const[t,n]=(0,i.useState)({selectedRow:void 0}),{selectedRow:a}=t,l=Object.keys(e.location.query).map((t=>{const n=oe[t],a=e.location.query[t];return n&&a?{kkey:n,value:a}:null})).filter((e=>Boolean(e)));return(0,c.tZ)(s.T3,{children:(0,c.BX)(d.V_,{children:[(0,c.tZ)(s.h4,{children:(0,c.BX)(s.oB,{children:[(0,c.tZ)(s.Dx,{children:(0,o.t)("Spans")}),l.length>0?(0,c.BX)(pe,{children:["Applied Filters:",l.map((e=>(0,c.tZ)(u,{...e},e.kkey)))]}):null]})}),(0,c.tZ)(s.uT,{children:(0,c.BX)(s.or,{fullWidth:!0,children:[(0,c.tZ)(d.YY,{}),(0,c.BX)(r.Z,{children:[(0,c.tZ)(ae,{location:e.location,onSelect:e=>n({selectedRow:e})}),(0,c.tZ)(f,{row:a,onClose:()=>n({selectedRow:void 0})})]})]})})]})})}de.displayName="Spans";const pe=(0,a.Z)("span",{target:"e466xe40"})("display:flex;gap:",(0,l.D)(1),";padding:",(0,l.D)(1),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_spans_index_tsx.79d7c7e1a613cd436b492ad84df311ac.js.map