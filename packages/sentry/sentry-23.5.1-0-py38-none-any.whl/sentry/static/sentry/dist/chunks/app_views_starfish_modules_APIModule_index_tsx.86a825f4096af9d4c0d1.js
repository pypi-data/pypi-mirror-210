"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_modules_APIModule_index_tsx"],{"./app/views/starfish/modules/APIModule/index.tsx":(t,e,a)=>{a.r(e),a.d(e,{default:()=>ht});var i=a("../node_modules/react/index.js"),s=a("./app/components/layouts/thirds.tsx"),o=a("./app/components/organizations/pageFilters/container.tsx"),n=a("./app/locale.tsx"),r=a("./app/utils/performance/contexts/pageError.tsx"),l=a("./app/views/starfish/views/spans/spanSummaryPanel/index.tsx"),d=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),c=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js")),p=a("../node_modules/moment/moment.js"),u=a.n(p),m=a("./app/components/charts/utils.tsx"),h=a("./app/components/compactSelect/index.tsx"),g=a("./app/components/datePageFilter.tsx"),f=a("./app/components/organizations/pageFilters/parse.tsx"),v=a("./app/styles/space.tsx"),y=a("./app/utils/queryClient.tsx"),w=a("./app/utils/useOrganization.tsx"),Z=a("./app/utils/usePageFilters.tsx"),x=a("./app/views/starfish/components/chart.tsx"),b=a("./app/views/starfish/components/chartPanel.tsx");const k={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",408:"Request Timeout",429:"Too Many Requests",500:"Internal Server Error"},P={stripe:{statusPage:"https://status.stripe.com/",faviconLink:"https://stripe.com/favicon.ico",description:(0,n.t)("Stripe is a suite of payment APIs that powers commerce for online businesses of all sizes")},twilio:{statusPage:"https://status.twilio.com/",faviconLink:"https://www.twilio.com/favicon.ico",description:(0,n.t)("Twilio is a cloud communications platform as a service company.")},sendgrid:{statusPage:"https://status.sendgrid.com/",faviconLink:"https://sendgrid.com/favicon.ico",description:(0,n.t)("SendGrid is a cloud-based SMTP provider that allows you to send email without having to maintain email servers.")},plaid:{statusPage:"https://status.plaid.com/",faviconLink:"https://plaid.com/favicon.ico",description:(0,n.t)("Plaid is a technology platform that enables applications to connect with users bank accounts.")},paypal:{statusPage:"https://www.paypal-status.com/"},braintree:{statusPage:"https://status.braintreepayments.com/"},clickup:{statusPage:"https://clickup.statuspage.io/",faviconLink:"https://clickup.com/favicon.ico",description:(0,n.t)("ClickUp is a productivity platform that provides a fundamentally new way to work.")},github:{statusPage:"https://www.githubstatus.com/",faviconLink:"https://github.com/favicon.ico",description:(0,n.t)("GitHub is a provider of Internet hosting for software development and version control.")},gitlab:{statusPage:"https://status.gitlab.com/",faviconLink:"https://gitlab.com/favicon.ico",description:(0,n.t)("GitLab is a web-based DevOps lifecycle tool that provides a Git-repository manager providing wiki, issue-tracking and CI/CD pipeline features.")},bitbucket:{statusPage:"https://bitbucket.status.atlassian.com/",faviconLink:"https://bitbucket.org/favicon.ico",description:(0,n.t)("Bitbucket is a web-based version control repository hosting service.")},jira:{statusPage:"https://jira.status.atlassian.com/",faviconLink:"https://jira.com/favicon.ico",description:(0,n.t)("Jira is a proprietary issue tracking product developed by Atlassian.")},asana:{statusPage:"https://trust.asana.com/",faviconLink:"https://asana.com/favicon.ico",description:(0,n.t)("Asana is a web and mobile application designed to help teams organize, track, and manage their work.")},trello:{statusPage:"https://trello.status.atlassian.com/"},zendesk:{statusPage:"https://status.zendesk.com/"},intercom:{statusPage:"https://www.intercomstatus.com/"},freshdesk:{statusPage:"https://status.freshdesk.com/"},linear:{statusPage:"https://status.linear.app/"},gaussMoney:{}},_=/\d\.\d|localhost/;var T=a("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),j=a("./app/components/circleIndicator.tsx"),D=a("./app/icons/index.tsx"),S=a("../node_modules/lodash/groupBy.js"),B=a.n(S),L=a("../node_modules/lodash/orderBy.js"),F=a.n(L),I=a("./app/components/gridEditable/index.tsx"),q=a("./app/utils/formatters.tsx"),z=a("./app/views/starfish/components/sparkline.tsx"),C=a("./app/views/starfish/utils/constants.tsx"),A=a("./app/views/starfish/utils/zeroFillSeries.tsx"),M=a("./app/views/starfish/modules/APIModule/queries.tsx"),X=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const E=[{key:"host",name:"Host",width:I.z7},{key:"duration",name:"Response Time",width:220},{key:"failure_rate",name:"Failure Rate",width:220},{key:"p50",name:"P50",width:200},{key:"p95",name:"P95",width:200},{key:"total_exclusive_time",name:"Total Exclusive Time",width:200}];function R(t){let{location:e,setDomainFilter:a}=t;const i=(0,Z.Z)(),s=(0,c.u)(),o=(0,M.O6)({datetime:i.selection.datetime}),n=(0,M.S4)({datetime:i.selection.datetime}),{isLoading:r,data:l}=(0,T.a)({queryKey:["query",i.selection.datetime],queryFn:()=>fetch(`${C.M}/?query=${o}`).then((t=>t.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[]}),{isLoading:d,data:p}=(0,T.a)({queryKey:["aggregateQuery",i.selection.datetime],queryFn:()=>fetch(`${C.M}/?query=${n}`).then((t=>t.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[]}),m=B()(l,"domain"),h=Object.keys(m).filter((t=>!t.match(_))),g=u()(F()(l,"interval","asc")[0]?.interval),f=u()(F()(l,"interval","desc")[0]?.interval);let v=0,y=0,w=0;const x=h.map((t=>{const e=(0,A.b)({seriesName:t,data:m[t].map((t=>({name:t.interval,value:t.p99})))},u().duration(12,"hours"),g,f),a=(0,A.b)({seriesName:t,data:m[t].map((t=>({name:t.interval,value:t.failure_rate})))},u().duration(12,"hours"),g,f),{"p50(span.self_time)":i,"p99(span.self_time)":s,"p95(span.self_time)":o,"p100(span.self_time)":n,"sum(span.self_time)":r}=p?.find((e=>e.domain===t))??{};return v+=r,y+=i,w+=o,{host:t,duration:e,failure_rate:a,p50:i,p99:s,p95:o,max:n,total_exclusive_time:r}})).filter((t=>t.duration.data.length>0)).sort(((t,e)=>e.total_exclusive_time-t.total_exclusive_time));return(0,X.tZ)(I.ZP,{isLoading:r||d,data:x,columnOrder:E,columnSortBy:[],grid:{renderHeadCell:$,renderBodyCell:(t,e)=>function(t){let{column:e,row:a,theme:i,totalTotalExclusiveTime:s,totalP50:o,totalP95:n,setDomainFilter:r}=t;if("host"===e.key)return(0,X.tZ)("a",{onClick:()=>r(a.host),children:a[e.key]});if("duration"===e.key){const t=a[e.key];return t?(0,X.tZ)(z.ZP,{color:"rgb(242, 183, 18)",series:t}):"Loading"}if("failure_rate"===e.key){const t=a[e.key];return t?(0,X.tZ)(z.ZP,{color:"#ef7061",series:t}):"Loading"}return"total_exclusive_time"===e.key?(0,X.tZ)(N,{minWidth:.1,meterItems:["total_exclusive_time"],row:a,total:s,color:i.green300}):"p50"===e.key?(0,X.tZ)(N,{minWidth:.1,meterItems:["p50"],row:a,total:o,color:i.blue300}):"p95"===e.key?(0,X.tZ)(N,{minWidth:.1,meterItems:["p95"],row:a,total:n,color:i.red300}):a[e.key]}({column:t,row:e,theme:s,totalTotalExclusiveTime:v,totalP50:y,totalP95:w,setDomainFilter:a})},location:e,height:400,scrollable:!0,stickyHeader:!0})}function $(t){return t.name}function N(t){let{minWidth:e,meterItems:a,row:i,total:s,color:o,meterText:n}=t;const r=[];return a.reduce(((t,o,n)=>{const l=Math.max(Math.min(100*i[o]/s-t,100-t-e*(a.length-n)),e);return r.push(l),t+l}),0),(0,X.BX)("span",{children:[(0,X.tZ)(V,{children:n??`${(0,q.g9)(i[a[0]]/1e3,0,!0,!0)}`}),(0,X.tZ)(O,{width:100,children:(0,X.tZ)(W,{width:r[0],color:o})})]})}R.displayName="HostTable",N.displayName="MeterBar";const O=(0,d.Z)("span",{target:"e13ey8yf2"})("display:flex;width:",(t=>t.width),"%;height:",(0,v.D)(1),";background-color:",(t=>t.theme.gray100),";margin-bottom:4px;"),W=(0,d.Z)("span",{target:"e13ey8yf1"})("display:block;width:",(t=>t.width),"%;height:100%;background-color:",(t=>t.color),";"),V=(0,d.Z)("span",{target:"e13ey8yf0"})("font-size:",(t=>t.theme.fontSizeExtraSmall),";color:",(t=>t.theme.gray300),";white-space:nowrap;");var H=a("./app/views/starfish/utils/useSpansQuery.tsx");function K(t){let{host:e}=t;const a=(0,c.u)(),i=(0,Z.Z)(),{isLoading:s,data:o}=(0,H.bB)({queryString:(0,M.Rj)({domain:e,datetime:i.selection.datetime}),eventView:(0,M.eL)({domain:e,datetime:i.selection.datetime}),initialData:[]}),r=Object.keys(P).find((t=>e.includes(t))),l=o?.filter((t=>t.status>299)),d=o?.filter((t=>t.status<300)),p=o?.reduce(((t,e)=>t+e.count),0),u=r&&P[r],{isLoading:m,data:h}=(0,T.a)({queryKey:["domain-status",e],queryFn:()=>fetch(`${u?.statusPage}?format=json`).then((t=>t.json())),retry:!1,refetchOnWindowFocus:!1,initialData:{},enabled:!!u});return(0,X.BX)(G,{children:[(0,X.BX)(U,{children:[u?.faviconLink&&(0,X.tZ)("img",{src:u.faviconLink,width:"16",height:"16",style:{marginRight:(0,v.D)(1)}}),r?(0,X.BX)("span",{children:[(0,X.tZ)(Q,{children:r}),(0,X.tZ)("span",{children:` (${e})`})]}):(0,X.tZ)(Q,{children:e}),!m&&h.status?(0,X.BX)(Y,{children:[(0,X.tZ)(j.Z,{size:8,enabled:"none"===h.status.indicator})," ",h.status.description]}):null,(0,X.tZ)(tt,{children:u?.statusPage&&(0,X.BX)("a",{href:u.statusPage,target:"_blank",rel:"noreferrer",children:[(0,n.t)("Status"),(0,X.tZ)(J,{size:"xs"})]})})]}),(0,X.tZ)(st,{children:u?.description}),(0,X.BX)(et,{children:[s?null:l?.map((t=>{const e=k[t.status];return(0,X.tZ)(at,{children:(0,X.tZ)(N,{color:a.red300,meterItems:["count"],minWidth:.1,row:t,total:p,meterText:(0,X.tZ)(it,{children:`${t.status}${e?` ${e}`:""} (${t.count})`})})},t.status)})),s?null:d?.map((t=>(0,X.tZ)(at,{children:(0,X.tZ)(N,{color:a.green300,meterItems:["count"],minWidth:.1,row:t,total:p,meterText:`${t.status} (${t.count})`})},t.status)))]})]})}K.displayName="HostDetails";const G=(0,d.Z)("div",{target:"ed5l75i9"})("padding:",(0,v.D)(2),";border-radius:",(t=>t.theme.borderRadius),";border:1px solid ",(t=>t.theme.border),";margin-bottom:",(0,v.D)(2),";"),U=(0,d.Z)("div",{target:"ed5l75i8"})({name:"ho1qnd",styles:"display:flex;flex-direction:row"}),Q=(0,d.Z)("span",{target:"ed5l75i7"})({name:"1efi8gv",styles:"font-weight:bold"}),Y=(0,d.Z)("span",{target:"ed5l75i6"})("margin-left:",(0,v.D)(2),";"),J=(0,d.Z)(D.V$,{target:"ed5l75i5"})("flex:0;top:2px;position:relative;margin-left:",(0,v.D)(.5),";"),tt=(0,d.Z)("span",{target:"ed5l75i4"})({name:"1es6ihh",styles:"flex:1;text-align:right"}),et=(0,d.Z)("span",{target:"ed5l75i3"})("margin-top:",(0,v.D)(1),";flex:1;height:20px;display:flex;flex-direction:row;gap:",(0,v.D)(1),";"),at=(0,d.Z)("div",{target:"ed5l75i2"})({name:"o5832w",styles:"width:150px;top:-6px;position:relative"}),it=(0,d.Z)("span",{target:"ed5l75i1"})("font-weight:bold;color:",(t=>t.theme.red300),";"),st=(0,d.Z)("span",{target:"ed5l75i0"})("font-size:",(t=>t.theme.fontSizeSmall),";color:",(t=>t.theme.gray300),";");var ot=a("./app/views/starfish/modules/databaseModule/utils.ts"),nt=a("./app/views/starfish/utils/dates.tsx"),rt=a("./app/views/starfish/modules/APIModule/endpointTable.tsx");const lt=[{value:"",label:"All"},...["GET","POST","PUT","DELETE"].map((t=>({value:t,label:t})))];function dt(t){let{location:e,onSelect:a}=t;const s=(0,c.u)(),o=(0,Z.Z)(),[r,l]=(0,i.useState)({action:"",domain:"",transaction:""}),d=(0,i.useRef)(null),p=(0,w.Z)(),v=(0,M.Ao)({datetime:o.selection.datetime}),k=(0,M.S4)({datetime:o.selection.datetime}),{selection:P}=o,{projects:T,environments:j,datetime:D}=P;(0,y.WE)([`/organizations/${p.slug}/events-starfish/`,{query:{environment:j,project:T.map((t=>String(t))),...(0,f.fK)(D)}}],{staleTime:10});const{isLoading:S,data:B}=(0,H.bB)({eventView:v,queryString:k,initialData:[]}),L=(0,M.xI)({datetime:o.selection.datetime}),{isLoading:F,data:I}=(0,H.bB)({eventView:L,queryString:(0,M.YK)({datetime:o.selection.datetime}),initialData:[]}),q=["p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],z={};q.forEach((t=>{z[t]={seriesName:t,data:[]}}));const C={seriesName:"count",data:[]},E={seriesName:"failure_rate",data:[]};I.forEach((t=>{q.forEach((e=>{z[e].data.push({value:t[e],name:t.interval})})),C.data.push({value:t["count()"],name:t.interval}),E.data.push({value:t["failure_rate()"],name:t.interval})}));const[$,N,O]=o.selection.datetime.period?.match(nt.Pr)??[],W=N&&O?u()().subtract(N,O):u()(o.selection.datetime.start),V=u()(o.selection.datetime.end??void 0),[G,U,Q]=[z,[C],[E]].map((t=>Object.values(t).map((t=>(0,A.b)(t,u().duration(12,"hours"),W,V))))),Y=t=>{l({...r,domain:t})},J=[{value:"",label:"All"},...B.filter((t=>{let{domain:e}=t;return""!==e})).map((t=>{let{domain:e}=t;return{value:e,label:e}}))],tt=(0,m.ZS)(o.selection.datetime,"low"),{isLoading:et,data:at}=(0,M.yd)(B.map((t=>{let{domain:e}=t;return e})).filter((t=>!t.match(_))),tt),it=(0,ot.F)(at,"group","epm()"),st=(0,ot.F)(at,"group","p75(transaction.duration)");return(0,x.K)([!F]),(0,X.BX)(i.Fragment,{children:[(0,X.BX)(mt,{children:[(0,X.tZ)(h.Z,{triggerProps:{prefix:(0,n.t)("Service")},value:"project",options:[{value:"project",label:"Project"}],onChange:()=>{}}),(0,X.tZ)(g.Z,{alignDropdown:"left"})]}),(0,X.BX)(pt,{children:[(0,X.tZ)(ut,{children:(0,X.tZ)(b.Z,{title:(0,n.t)("Top Transactions Throughput"),children:(0,X.tZ)(ct,{data:it,loading:et})})}),(0,X.tZ)(ut,{children:(0,X.tZ)(b.Z,{title:(0,n.t)("Top Transactions p75"),children:(0,X.tZ)(ct,{data:st,loading:et})})})]}),(0,X.BX)(pt,{children:[(0,X.tZ)(ut,{children:(0,X.tZ)(b.Z,{title:(0,n.t)("Throughput"),children:(0,X.tZ)(ct,{data:U,loading:F})})}),(0,X.tZ)(ut,{children:(0,X.tZ)(b.Z,{title:(0,n.t)("Response Time"),children:(0,X.tZ)(ct,{data:G,loading:F})})}),(0,X.tZ)(ut,{children:(0,X.tZ)(b.Z,{title:(0,n.t)("Error Rate"),children:(0,X.tZ)(ct,{data:Q,loading:F,chartColors:[s.charts.getColorPalette(2)[2]]})})})]}),(0,X.tZ)(R,{location:e,setDomainFilter:t=>{Y(t),setTimeout((()=>{d.current?.scrollIntoView({behavior:"smooth",inline:"start"})}),200)}}),(0,X.BX)(mt,{children:[(0,X.tZ)(h.Z,{triggerProps:{prefix:(0,n.t)("Operation")},value:r.action,options:lt,onChange:t=>{let{value:e}=t;return a=e,void l({...r,action:a});var a}}),(0,X.tZ)(h.Z,{triggerProps:{prefix:(0,n.t)("Domain")},value:r.domain,options:J,onChange:t=>{let{value:e}=t;return Y(e)}})]}),(0,X.BX)("div",{ref:d,children:[r.domain&&(0,X.tZ)(K,{host:r.domain}),(0,X.tZ)(rt.ZP,{location:e,onSelect:a,filterOptions:{...r,datetime:o.selection.datetime}})]})]})}function ct(t){let{data:e,loading:a,chartColors:i}=t;return(0,X.tZ)(x.Z,{statsPeriod:"24h",height:140,data:e,start:"",end:"",loading:a,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:i,disableXAxis:!0})}dt.displayName="APIModuleView",ct.displayName="APIModuleChart";const pt=(0,d.Z)("div",{target:"ercz3dc2"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,v.D)(2),";"),ut=(0,d.Z)("div",{target:"ercz3dc1"})({name:"82a6rk",styles:"flex:1"}),mt=(0,d.Z)("div",{target:"ercz3dc0"})("display:flex;flex-direction:row;gap:",(0,v.D)(1),";margin-bottom:",(0,v.D)(2),";");function ht(t){const[e,a]=(0,i.useState)({selectedRow:void 0}),{selectedRow:d}=e;return(0,X.tZ)(s.T3,{children:(0,X.BX)(r.V_,{children:[(0,X.tZ)(s.h4,{children:(0,X.tZ)(s.oB,{children:(0,X.tZ)(s.Dx,{children:(0,n.t)("API")})})}),(0,X.tZ)(s.uT,{children:(0,X.BX)(s.or,{fullWidth:!0,children:[(0,X.tZ)(r.YY,{}),(0,X.BX)(o.Z,{children:[(0,X.tZ)(dt,{...t,onSelect:t=>a({selectedRow:t})}),(0,X.tZ)(l.U,{span:{...d,span_operation:"http.client",group_id:d?.group_id||""},onClose:()=>a({selectedRow:void 0})}),";"]})]})})]})})}ht.displayName="APIModule"}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_modules_APIModule_index_tsx.edae563c3c80a14dcf413d9b301648b3.js.map