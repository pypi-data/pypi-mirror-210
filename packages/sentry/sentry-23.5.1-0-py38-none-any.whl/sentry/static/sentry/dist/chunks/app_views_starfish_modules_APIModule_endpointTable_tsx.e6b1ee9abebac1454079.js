"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_modules_APIModule_endpointTable_tsx"],{"./app/views/starfish/modules/APIModule/endpointTable.tsx":(t,e,n)=>{n.d(e,{Dq:()=>$,ZP:()=>v,_F:()=>g,xe:()=>O});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(n("../node_modules/core-js/modules/es.array.push.js"),n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs")),i=n("../node_modules/moment/moment.js"),r=n.n(i),o=n("./app/components/duration.tsx"),u=n("./app/components/gridEditable/index.tsx"),l=n("./app/components/links/link.tsx"),m=n("./app/constants/chartPalette.tsx"),p=n("./app/views/starfish/components/sparkline.tsx"),d=n("./app/views/starfish/utils/constants.tsx"),c=n("./app/views/starfish/utils/useSpansQuery.tsx"),_=n("./app/views/starfish/utils/zeroFillSeries.tsx"),f=n("./app/views/starfish/modules/APIModule/queries.tsx"),h=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const E=[{key:"description",name:"URL",width:600},{key:"throughput",name:"throughput",width:200},{key:"p50_trend",name:"p50 Trend",width:200},{key:"p50(span.self_time)",name:"p50",width:u.z7},{key:"count_unique(user)",name:"Users",width:u.z7},{key:"count_unique(transaction)",name:"Transactions",width:u.z7},{key:"sum(span.self_time)",name:"Total Time",width:u.z7}];function v(t){let{location:e,onSelect:n,filterOptions:s,columns:i}=t;const{isLoading:o,data:l}=(0,c.bB)({queryString:(0,f.an)(s),eventView:(0,f.g9)(s),initialData:[]}),{isLoading:m,data:p}=(0,a.a)({queryKey:["endpointAggregates",s],queryFn:()=>fetch(`${d.M}/?query=${(0,f.jD)(s)}`).then((t=>t.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[]}),v={};p.forEach((t=>{let{description:e,interval:n,count:s,p50:a}=t;e in v?v[e].push({name:n,count:s,p50:a}):v[e]=[{name:n,count:s,p50:a}]}));const g=l.map((t=>{const e=t.description,n={seriesName:"throughput",data:v[e]?.map((t=>{let{name:e,count:n}=t;return{name:e,value:n}}))},s={seriesName:"p50 Trend",data:v[e]?.map((t=>{let{name:e,p50:n}=t;return{name:e,value:n}}))},a=(0,_.b)(n,r().duration(12,"hours")),i=(0,_.b)(s,r().duration(12,"hours"));return{...t,throughput:a,p50_trend:i}}));return(0,h.tZ)(u.ZP,{isLoading:o||m,data:g,columnOrder:i??E,columnSortBy:[],grid:{renderHeadCell:y,renderBodyCell:(t,e)=>q(t,e,n)},location:e})}function y(t){return"throughput"===t.key||"p50_trend"===t.key?(0,h.tZ)(O,{children:(0,h.tZ)(g,{children:t.name})}):t.key.toString().match(/^p\d\d/)||!["description","transaction"].includes(t.key.toString())?(0,h.tZ)($,{children:(0,h.tZ)(g,{children:t.name})}):(0,h.tZ)(g,{children:t.name})}function q(t,e,n){if("description"===t.key&&n)return(0,h.tZ)(g,{children:(0,h.tZ)(l.Z,{onClick:()=>n(e),to:"",children:e[t.key]})});if("throughput"===t.key)return(0,h.tZ)(p.ZP,{color:m.$[3][0],series:e[t.key],width:t.width?t.width-t.width/5:void 0});if("p50_trend"===t.key)return(0,h.tZ)(p.ZP,{color:m.$[3][3],series:e[t.key],width:t.width?t.width-t.width/5:void 0});let s=null;return s=t.key.toString().match(/^p\d\d/)||"sum(span.self_time)"===t.key?(0,h.tZ)(o.Z,{seconds:e[t.key]/1e3,fixedDigits:2,abbreviation:!0}):(["description","transaction"].includes(t.key.toString()),(0,h.tZ)(g,{children:e[t.key]})),t.key.toString().match(/^p\d\d/)||t.key.toString().match(/^.*\(.*\)/)?(0,h.tZ)($,{children:s}):(0,h.tZ)(O,{children:s})}v.displayName="EndpointTable",y.displayName="renderHeadCell",q.displayName="renderBodyCell";const g=(0,s.Z)("span",{target:"e6m90oa2"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"}),$=(0,s.Z)("span",{target:"e6m90oa1"})({name:"evqzij",styles:"text-align:right;width:100%"}),O=(0,s.Z)("span",{target:"e6m90oa0"})({name:"zq26zb",styles:"text-align:left;width:100%"})},"./app/views/starfish/modules/APIModule/queries.tsx":(t,e,n)=>{n.d(e,{Ao:()=>h,O6:()=>d,Rj:()=>q,S4:()=>f,YK:()=>E,Zn:()=>y,an:()=>c,eL:()=>g,g9:()=>_,jD:()=>$,xI:()=>v,yd:()=>O});var s=n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),a=n("./app/utils/discover/eventView.tsx"),i=n("./app/utils/discover/types.tsx"),r=n("./app/utils/useLocation.tsx"),o=n("./app/utils/usePageFilters.tsx"),u=n("./app/views/starfish/modules/databaseModule/queries.ts"),l=n("./app/views/starfish/utils/constants.tsx"),m=n("./app/views/starfish/utils/dates.tsx"),p=n("./app/views/starfish/utils/useSpansQuery.tsx");const d=t=>{let{datetime:e}=t;const{start_timestamp:n,end_timestamp:s}=(0,m.SW)(e);return`SELECT\n    domain,\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    quantile(0.99)(exclusive_time) as p99,\n    count() as count,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count as failure_rate\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    AND domain != ''\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY domain, interval\n    ORDER BY domain, interval asc\n `},c=t=>{let{domain:e,action:n,datetime:s,transaction:a}=t;const{start_timestamp:i,end_timestamp:r}=(0,m.SW)(s);return`SELECT\n    description,\n    group_id,\n    domain,\n    action,\n    quantile(0.5)(exclusive_time) AS "p50(span.self_time)",\n    quantile(0.95)(exclusive_time) AS "p95(span.self_time)",\n    sum(exclusive_time) AS "sum(span.self_time)",\n    uniq(user) AS "count_unique(user)", uniq(transaction) AS "count_unique(transaction)",\n    count() AS count,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) AS failure_count,\n    failure_count / count AS failure_rate\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${e?`AND domain = '${e}'`:""}\n    ${n?`AND action = '${n}'`:""}\n    ${a?`AND transaction = '${a}'`:""}\n    ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n    ${r?`AND lessOrEquals(start_timestamp, '${r}')`:""}\n    GROUP BY description, domain, action, group_id\n    ORDER BY count DESC\n    LIMIT 10\n  `},_=t=>{let{domain:e,action:n,datetime:s,transaction:r}=t;return a.ZP.fromSavedQuery({name:"",fields:["description","group_id","domain","action","p50(span.self_time)","p95(span.self_time)","sum(span.self_time)","count()","count_unique(user)","count_unique(transaction)"],orderby:"-count",query:`module:http ${e?`domain:${e}`:""} ${n?`action:${n}`:""} ${r?`transaction:${r}`:""}`,start:s.start,end:s.end,range:s.period,dataset:i.as.SPANS_INDEXED,projects:[1],version:2})},f=t=>{let{datetime:e}=t;const{start_timestamp:n,end_timestamp:s}=(0,m.SW)(e);return`SELECT domain, count(),\n    sum(exclusive_time) as "sum(span.self_time)",\n    max(exclusive_time) as "p100(span.self_time)",\n    quantile(0.99)(exclusive_time) as "p99(span.self_time)",\n    quantile(0.95)(exclusive_time) as "p95(span.self_time)",\n    quantile(0.50)(exclusive_time) as "p50(span.self_time)"\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY domain\n    ORDER BY count() DESC\n  `},h=t=>{let{datetime:e}=t;return a.ZP.fromSavedQuery({name:"",fields:["domain","count()","sum(span.self_time)","p100(span.self_time)","p99(span.self_time)","p95(span.self_time)","p50(span.self_time)"],orderby:"-count",query:"module:http",start:e.start,end:e.end,range:e.period,dataset:i.as.SPANS_INDEXED,projects:[1],version:2})},E=t=>{let{datetime:e}=t;const{start_timestamp:n,end_timestamp:s}=(0,m.SW)(e);return`SELECT\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    quantile(0.5)(exclusive_time) as "p50(span.self_time)",\n    quantile(0.75)(exclusive_time) as "p75(span.self_time)",\n    quantile(0.95)(exclusive_time) as "p95(span.self_time)",\n    quantile(0.99)(exclusive_time) as "p99(span.self_time)",\n    count() as "count()",\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as "failure_count()",\n    "failure_count()" / "count()" as "failure_rate()"\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY interval\n    ORDER BY interval asc\n `},v=t=>{let{datetime:e}=t;return a.ZP.fromSavedQuery({name:"",fields:["count()","p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],yAxis:["count()","p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],query:"module:http",start:e.start,end:e.end,range:e.period,dataset:i.as.SPANS_INDEXED,projects:[1],version:2})},y=t=>{let{description:e,transactionName:n,datetime:s,groupId:a}=t;const{start_timestamp:i,end_timestamp:r}=(0,m.SW)(s);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     count() as count,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = 'http'\n     ${e?`AND description = '${e}'`:""}\n     ${a?`AND group_id = '${a}'`:""}\n     ${n?`AND transaction = '${n}'`:""}\n     ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n     ${r?`AND lessOrEquals(start_timestamp, '${r}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `},q=t=>{let{domain:e,datetime:n}=t;const{start_timestamp:s,end_timestamp:a}=(0,m.SW)(n);return`\n    SELECT count() as count, status\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    AND domain = '${e}'\n    ${s?`AND greaterOrEquals(start_timestamp, '${s}')`:""}\n    ${a?`AND lessOrEquals(start_timestamp, '${a}')`:""}\n    GROUP BY status\n    ORDER BY count DESC\n  `},g=t=>{let{domain:e,datetime:n}=t;return a.ZP.fromSavedQuery({name:"",fields:["status","count()"],orderby:"-count",query:`module:http domain:${e}`,start:n.start,end:n.end,range:n.period,dataset:i.as.SPANS_INDEXED,projects:[1],version:2})},$=t=>{let{datetime:e,transaction:n}=t;const{start_timestamp:s,end_timestamp:a}=(0,m.SW)(e);return`\n    SELECT\n    description,\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    count() AS count,\n    quantile(0.5)(exclusive_time) as p50\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND transaction = '${n}'`:""}\n    ${s?`AND greaterOrEquals(start_timestamp, '${s}')`:""}\n    ${a?`AND lessOrEquals(start_timestamp, '${a}')`:""}\n    GROUP BY description, interval\n    ORDER BY interval asc\n  `},O=(t,e)=>{const n=(0,o.Z)(),d=(0,r.T)(),{startTime:c,endTime:_}=(0,m.tZ)(n),f=((t,e)=>`\n  SELECT\n    transaction\n  FROM default.spans_experimental_starfish\n  WHERE\n    startsWith(span_operation, 'http')\n    AND domain IN ('${t.join("', '")}')\n    ${e}\n  GROUP BY transaction\n  ORDER BY \n  -power(10, floor(log10(count()))), -quantile(0.75)(exclusive_time)\n\n  LIMIT 5\n`)(t,(0,u.zD)(c,_)),{start:h,end:E,period:v}=n.selection.datetime,{isLoading:y,data:q}=(0,s.a)({enabled:!!t?.length,queryKey:["topTransactionNames",t.join(","),h,E],queryFn:()=>fetch(`${l.M}/?query=${f}`).then((t=>t.json())),retry:!1,refetchOnWindowFocus:!1,initialData:[]}),g={id:void 0,name:"",query:`transaction:[${q?.map((t=>`"${t.transaction}"`)).join(",")}]`,projects:[1],fields:["transaction","epm()","p75(transaction.duration)"],version:1,topEvents:"5",start:h?.toString(),end:E?.toString(),dataset:i.as.METRICS_ENHANCED,interval:e,yAxis:["epm()","p75(transaction.duration)"]},$=a.ZP.fromNewQueryWithLocation(g,d);$.statsPeriod=v??void 0;const{isLoading:O,data:S,...D}=(0,p.Y7)({eventView:$,initialData:[],enabled:!y&&!!q.length});return{...D,isLoading:O,data:S}}}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_modules_APIModule_endpointTable_tsx.d61340af6c183371e73a748913fdfd8d.js.map