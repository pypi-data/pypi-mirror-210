"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_discover_discoverQuery_tsx-app_views_starfish_components_chart_tsx-app_views_starfi-db7430"],{"./app/components/charts/areaChart.tsx":(t,e,o)=>{o.d(e,{T:()=>n});var s=o("./app/components/charts/series/lineSeries.tsx"),a=o("./app/components/charts/baseChart.tsx"),r=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(t){let{series:e,stacked:o,colors:n,...i}=t;return(0,r.tZ)(a.Z,{...i,"data-test-id":"area-chart",colors:n,series:e.map(((t,e)=>{let{seriesName:a,data:r,...i}=t;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.Z)({...t})}({stack:o?"area":void 0,name:a,data:r.map((t=>{let{name:e,value:o}=t;return[e,o]})),lineStyle:{color:n?.[e],opacity:1,width:.4},areaStyle:{color:n?.[e],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...i})}))})}n.displayName="AreaChart"},"./app/components/charts/chartZoom.tsx":(t,e,o)=>{o.d(e,{Z:()=>v});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(o("../node_modules/core-js/modules/es.array.push.js"),o("../node_modules/react/index.js")),r=o("../node_modules/moment/moment.js"),n=o.n(r),i=o("../node_modules/query-string/index.js"),d=o("./app/actionCreators/pageFilters.tsx"),l=o("./app/components/charts/components/dataZoomInside.tsx");o("../node_modules/echarts/lib/component/dataZoomSlider.js");const c={realtime:!1,showDetail:!1,left:0,right:6,bottom:8};function m(t){return t&&Array.isArray(t)?t:[{...c,...t}]}var h=o("./app/components/charts/components/toolBox.tsx"),u=o("./app/utils/callIfFunction.tsx"),p=o("./app/utils/dates.tsx");const f=t=>t?n().utc(t).format(n().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class x extends a.Component{constructor(t){var e;super(t),e=this,(0,s.Z)(this,"history",void 0),(0,s.Z)(this,"currentPeriod",void 0),(0,s.Z)(this,"zooming",null),(0,s.Z)(this,"saveCurrentPeriod",(t=>{this.currentPeriod={period:t.period,start:f(t.start),end:f(t.end)}})),(0,s.Z)(this,"setPeriod",(function(t){let{period:o,start:s,end:a}=t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{router:n,onZoom:l,usePageDate:c}=e.props,m=f(s),h=f(a);r&&e.history.push(e.currentPeriod),l?.({period:o,start:m,end:h}),e.zooming=()=>{if(c&&n){const t={...n.location.query,pageStart:s?(0,p.v5)(s):void 0,pageEnd:a?(0,p.v5)(a):void 0,pageStatsPeriod:o??void 0};i.stringify(t)!==i.stringify(n.location.query)&&n.push({pathname:n.location.pathname,query:t})}else(0,d.dR)({period:o,start:m?(0,p.hC)(m):m,end:h?(0,p.hC)(h):h},n,{skipDesyncUpdate:!0});e.saveCurrentPeriod({period:o,start:s,end:a})}})),(0,s.Z)(this,"handleChartReady",(t=>{this.props.onChartReady?.(t)})),(0,s.Z)(this,"handleZoomRestore",((t,e)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],this.props.onRestore?.(t,e))})),(0,s.Z)(this,"handleDataZoom",((t,e)=>{const o=e.getModel(),{startValue:s,endValue:a}=o._payload.batch[0];if(null===s&&null===a){const t=this.history.pop();if(!t)return;this.setPeriod(t)}else{const t=n().utc(s),e=n().utc(a);this.setPeriod({period:null,start:t,end:e},!0)}this.props.onDataZoom?.(t,e)})),(0,s.Z)(this,"handleChartFinished",((t,e)=>{"function"==typeof this.zooming&&(this.zooming(),this.zooming=null);const o=e._componentsViews?.find((t=>t._features&&t._features.dataZoom));o&&!o._features.dataZoom._isZoomActive&&e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,u.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(t)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:t,start:e,end:o,disabled:s,children:a,xAxisIndex:r,router:n,onZoom:i,onRestore:d,onChartReady:c,onDataZoom:u,onFinished:f,showSlider:x,chartZoomOptions:v,...g}=this.props,y=t??void 0,Z=e?(0,p.hC)(e):void 0,_=o?(0,p.hC)(o):void 0;return a(s?{utc:y,start:Z,end:_,...g}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:y,start:Z,end:_,dataZoom:x?[...m({xAxisIndex:r,...v}),...(0,l.Z)({xAxisIndex:r,...v})]:(0,l.Z)({xAxisIndex:r,...v}),showTimeInTooltip:!0,toolBox:(0,h.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...g})}}x.displayName="ChartZoom";const v=x},"./app/components/charts/components/dataZoomInside.tsx":(t,e,o)=>{o.d(e,{Z:()=>a}),o("../node_modules/echarts/lib/component/dataZoomInside.js");const s={type:"inside",zoomOnMouseWheel:!1,zoomLock:!0,throttle:50};function a(t){return t&&Array.isArray(t)?t:[{...s,...t}]}},"./app/components/charts/components/toolBox.tsx":(t,e,o)=>{function s(){let{dataZoom:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...t?{dataZoom:{yAxisIndex:"none",title:{zoom:"zoom",back:"undo"},...t}}:{},...e}}function a(t,e){return{right:0,top:0,itemSize:16,z:-1,feature:s(e),...t}}o.d(e,{Z:()=>a})},"./app/utils/discover/discoverQuery.tsx":(t,e,o)=>{o.d(e,{Z:()=>d,_:()=>i});var s=o("./app/utils/discover/genericDiscoverQuery.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(t,e){return t.transactionName!==e.transactionName||t.transactionThreshold!==e.transactionThreshold||t.transactionThresholdMetric!==e.transactionThresholdMetric}function n(t){return(0,a.tZ)(s.ZP,{route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:o,...s}=t.meta??{};return{...t,meta:{...o,...s}}},...t})}function i(t){return(0,s.JC)({route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:o,...s}=t.meta??{};return{...t,meta:{...o,...s}}},...t})}n.displayName="DiscoverQuery";const d=n},"./app/views/starfish/components/chart.tsx":(t,e,o)=>{o.d(e,{Z:()=>P,K:()=>A}),o("../node_modules/core-js/modules/es.array.push.js");var s=o("../node_modules/react/index.js"),a=o("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),r=o("../node_modules/echarts/lib/core/echarts.js"),n=o("../node_modules/lodash/max.js"),i=o.n(n),d=o("../node_modules/lodash/min.js"),l=o.n(d),c=o("./app/components/charts/areaChart.tsx"),m=o("./app/components/charts/barChart.tsx"),h=o("./app/components/charts/baseChart.tsx"),u=o("./app/components/charts/chartZoom.tsx"),p=o("./app/components/charts/components/tooltip.tsx"),f=o("./app/components/charts/lineChart.tsx"),x=o("./app/components/charts/series/lineSeries.tsx"),v=(o("../node_modules/echarts/lib/chart/scatter.js"),o("./app/utils/theme.tsx"));function g(t){return{symbolSize:v.ZP.charts.symbolSize,...t,type:"scatter",emphasis:{...t.emphasis,scale:!0}}}var y=o("./app/utils/discover/charts.tsx"),Z=o("./app/utils/discover/fields.tsx"),_=o("./app/utils/useRouter.tsx"),b=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const C="starfish_chart_group";function j(t){const e=t.map((t=>t.data.map((t=>t.value))));return i()(e.map(i()))}function w(t){let{data:e,previousData:o,statsPeriod:r,start:n,end:d,utc:v,loading:w,height:P,grid:A,disableXAxis:D,definedAxisTicks:S,chartColors:T,isBarChart:I,isLineChart:N,stacked:k,log:z,hideYAxisSplitLine:L,showLegend:M,scatterPlot:R,throughput:F,aggregateOutputFormat:B,onClick:q}=t;const O=(0,_.Z)(),E=(0,a.u)(),Y=(0,s.useRef)(null),X=Y.current?.getEchartsInstance();if(X&&!X.group&&(X.group=C),!e||e.length<=0)return null;const G=T??E.charts.getColorPalette(4),Q="duration"===B||e.every((t=>"duration"===(0,Z.Px)(t.seriesName))),H="percentage"===B||e.every((t=>"percentage"===(0,Z.Px)(t.seriesName)));let V=Q?function(t){let e=0;if(t.length>2)for(let o=0;o<t.length;o++)e+=i()(t[o].data.map((t=>t.value)));else e=j(t);if(e<=1)return 1;const o=Math.log10(e),s=l()([i()([10**(o-Math.floor(o)),0]),10]);let a;a=s<=2.5?.2:s<=5?.5:s<=7.5?1:2;const r=10**Math.floor(o)*a;return Math.round(Math.ceil(e/r)*r)}([...e,...R?.[0]?.data?.length?R:[]]):H?j(e):void 0;1===V&&Q&&(V+=1);const W=(0,y.Xp)(e);let J;const U=[];F&&F.length>1&&(J=[(0,x.Z)({name:"Throughput",data:F.map((t=>{let{interval:e,count:o}=t;return[e,o]})),yAxisIndex:1,lineStyle:{type:"dashed",width:1,opacity:.5},animation:!1,animationThreshold:1,animationDuration:0})],U.push({minInterval:W,splitNumber:S,max:V,type:"value",axisLabel:{color:E.chartLabel,formatter:t=>(0,y.gu)(t,"number",!0)},splitLine:L?{show:!1}:void 0}));const $=[{minInterval:W,splitNumber:S,max:V,type:z?"log":"value",axisLabel:{color:E.chartLabel,formatter:t=>(0,y.gu)(t,B??(0,Z.Px)(e[0].seriesName),void 0,W)},splitLine:L?{show:!1}:void 0},...U],K={seriesOptions:{showSymbol:!1},grid:A,yAxes:$,utc:v,legend:M?{top:0,right:10}:void 0,isGroupedByDate:!0,showTimeInTooltip:!0,tooltip:{formatter:(t,e)=>Array.from(document.querySelectorAll(":hover")).find((t=>t.classList.contains("echarts-for-react")))===Y.current?.ele?(0,p.Pf)({isGroupedByDate:!0,showTimeInTooltip:!0,utc:v})(t,e):"",trigger:"axis",axisPointer:{type:"cross",label:{show:!1}},valueFormatter:(t,o)=>(0,y.CX)(t,B??(0,Z.Px)(e&&e.length?e[0].seriesName:o)),nameFormatter:t=>"epm()"===t?"tpm()":t}};if(w)return N?(0,b.tZ)(f.w,{height:P,series:[],...K}):I?(0,b.tZ)(m.v,{height:P,series:[],...K}):(0,b.tZ)(c.T,{height:P,series:[],...K});const tt=e.map(((t,e)=>({...t,yAxisIndex:0,xAxisIndex:0}))),et=D?{show:!1,axisLabel:{show:!0,margin:0},axisLine:{show:!1}}:void 0;return(0,b.tZ)(u.Z,{router:O,period:r,start:n,end:d,utc:v,children:t=>N?(0,b.tZ)(h.Z,{...t,ref:Y,height:P,previousPeriod:o,additionalSeries:J,xAxis:et,yAxes:K.yAxes,tooltip:K.tooltip,colors:G,grid:A,legend:M?{top:0,right:0}:void 0,onClick:q,series:[...tt.map((t=>{let{seriesName:e,data:o,...s}=t;return(0,x.Z)({...s,name:e,data:o?.map((t=>{let{value:e,name:o}=t;return[o,e]})),animation:!1,animationThreshold:1,animationDuration:0})})),...(R??[]).map((t=>{let{seriesName:e,data:o,...s}=t;return g({...s,name:e,data:o?.map((t=>{let{value:e,name:o}=t;return[o,e]})),animation:!1})}))]}):I?(0,b.tZ)(m.v,{height:P,series:tt,xAxis:et,additionalSeries:J,yAxes:K.yAxes,tooltip:K.tooltip,colors:G,grid:A,legend:M?{top:0,right:0}:void 0}):(0,b.tZ)(c.T,{forwardedRef:Y,height:P,...t,series:tt,previousPeriod:o,additionalSeries:J,xAxis:et,stacked:k,...K})})}w.displayName="Chart";const P=w;function A(t){const[e,o]=(0,s.useState)(!1);(0,s.useEffect)((()=>{t.every((t=>t))&&!e&&(r.$j(C),o(!0))}),[t,e])}},"./app/views/starfish/components/chartPanel.tsx":(t,e,o)=>{o.d(e,{Z:()=>i});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(o("../node_modules/react/index.js"),o("./app/components/panels/index.tsx")),r=o("./app/styles/space.tsx"),n=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(t){let{title:e,children:o,button:s}=t;return(0,n.tZ)(a.s_,{children:(0,n.BX)(a.N,{withPadding:!0,children:[(0,n.BX)(l,{children:[e&&(0,n.tZ)(d,{children:e}),s]}),o]})})}i.displayName="ChartPanel";const d=(0,s.Z)("p",{target:"e1tvnfsq1"})((t=>t.theme.text.cardTitle),";"),l=(0,s.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,r.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/utils/dates.tsx":(t,e,o)=>{o.d(e,{Pr:()=>d,SW:()=>c,ie:()=>i,tZ:()=>m}),o("../node_modules/core-js/modules/es.error.cause.js");var s=o("../node_modules/moment/moment.js"),a=o.n(s),r=o("./app/utils/dates.tsx");function n(t,e){const o=a()(e).diff(a()(t)),s=a()(t).add(o/2);return(0,r.v5)(s)}function i(t){let{start:e,end:o,statsPeriod:s}=t;if(s)return n((0,r.Yz)("hours",(0,r.YJ)(s)).toDate(),new Date);if(!e||!o)throw new Error("start and end required");return n(e,o)}const d=/^(\d+)([h,d])$/,l="YYYY-MM-DD HH:mm:ss",c=t=>{if(!t)return{};const[e,o,s]=t.period?.match(d)??[];return{start_timestamp:(t.start&&a()(t.start).format(l))??(o&&s&&a()().subtract(o,s).startOf("minute").format(l)),end_timestamp:t.end&&a()(t.end).format(l)}};function m(t){const[e,o,s]=t.selection.datetime.period?.match(d)??[];return{startTime:o&&s?a()().subtract(o,s):a()(t.selection.datetime.start),endTime:a()(t.selection.datetime.end??void 0)}}},"./app/views/starfish/utils/zeroFillSeries.tsx":(t,e,o)=>{o.d(e,{b:()=>r}),o("../node_modules/core-js/modules/es.array.push.js");var s=o("../node_modules/moment/moment.js"),a=o.n(s);function r(t,e,o,s,r){if(!t?.data?.length)return t;r||(r=0);const i=t.data[0],d=t.data[t.data.length-1],l=a()(i.name).creationData().format?.toString();if(!l)return t;const c=[],m=o&&n(o),h=s&&n(s),u=[...m&&m.diff(a()(i.name))<0?[{value:r,name:m.format(l)}]:[],...t.data,...h&&h.diff(a()(d.name))>0?[{value:r,name:h.format(l)}]:[]];let p,f,x,v,g;for(let t=0;t<u.length-1;t++){for(0===t&&c.push({...u[t],name:a()(u[t].name).format(l)}),p=u[t],f=u[t+1],x=a()(p.name),v=a()(f.name),g=a().duration(v.diff(x));g.asMilliseconds()>e.asMilliseconds();)x.add(e),c.push({value:r,name:a()(x).format(l)}),g=a().duration(a()(f.name).diff(x));c.push({...f,name:a()(f.name).format(l)})}return{...t,data:c}}function n(t){const e=t.hour(),o=t.clone().startOf("day");return e<12?o:o.add(12,"hour")}}}]);
//# sourceMappingURL=../sourcemaps/app_utils_discover_discoverQuery_tsx-app_views_starfish_components_chart_tsx-app_views_starfi-db7430.54c663cb4e9e84c1ff05e11c97148ee1.js.map