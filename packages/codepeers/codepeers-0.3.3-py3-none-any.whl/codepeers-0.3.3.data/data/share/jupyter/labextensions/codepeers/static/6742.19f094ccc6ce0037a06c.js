"use strict";(self.webpackChunkcodepeers=self.webpackChunkcodepeers||[]).push([[6742],{46742:(e,t,n)=>{n.r(t),n.d(t,{default:()=>De});var o=n(15510),s=n(1542),a=n(55767),r=n(81598),i=n(45442),l=n(56271),c=n.n(l);const d="codepeers",u=`${d}:plugin`,m=`${d}:cmd-code-ideas`,h=`${d}:cmd-code-review`,p=`${d}:icon-code-ideas`,g=`${d}:icon-code-review`,v=d,f="codepeers_login_user_name",y="https://codepeers-chat.hodlenx.workers.dev";var x=n(14093);const b=x.z.object({document_id:x.z.string(),user_id:x.z.string().optional(),user_name:x.z.string().optional(),admin_view:x.z.boolean().optional()}),w=x.z.object({topic_id:x.z.string(),submission_id:x.z.string().optional()}),C=x.z.object({delta:x.z.object({content:x.z.string().optional(),role:x.z.string().optional()}),finish_reason:x.z.string().nullable(),index:x.z.number()}),E=x.z.object({choices:x.z.array(C)});var _=n(51417),I=n(38602),k=n(52690);const S=()=>c().createElement(k.Global,{styles:k.css`
      .rfu-file-upload-button {
        line-height: 1 !important;
      }
    `}),M=()=>c().createElement(k.Global,{styles:k.css`
      .jp-Dialog-content {
        min-width: 300px;
        min-height: 200px;
        max-width: 80vw;
        max-height: 80vh;
        padding: 12px;
      }
    `}),N=({children:e})=>c().createElement(_.MantineProvider,{withGlobalStyles:!0,withNormalizeCSS:!0},c().createElement(S,null),c().createElement(M,null),c().createElement(_.Container,{fluid:!0,style:{minHeight:"40vh",minWidth:"50rem"}},e),c().createElement(I.Notifications,{zIndex:99999}));var j=n(38159),O=n(23761);n(58621);const T=()=>c().createElement(O.LoadingIndicator,null),z=(e,t=T)=>n=>!n||0===Object.keys(n).length||Object.values(n).some((e=>void 0===e))?c().createElement(t,null):c().createElement(e,Object.assign({},n));var L=n(92929);class R{constructor(e){this.value=e}static from(e){return new R(e)}static of(e){return new R(e)}static nothing(){return new R}static equals(e,t){return e.inner()===t.inner()}isJust(){return!this.isNothing()}isNothing(){return void 0===this.value}map(e){return this.isNothing()?new R:new R(e(this.value))}chain(e){return this.isNothing()?new R:e(this.value)}asyncChain(e){return this.isNothing()?Promise.resolve(new R):e(this.value)}unwrap(){if(this.isNothing())throw new Error("Nothing to unwrap");return this.value}inner(){return this.value}}const P=(e,t)=>{const n=t=>e(t).then((e=>R.from(e))),o=e=>{e.isJust()&&(null==t||t(e.unwrap()))};return e=>{const t=(0,l.useRef)(e),[s,a]=((e,t)=>{const[n,o]=(0,l.useState)(e);return(0,l.useEffect)((()=>()=>t(n)),[n,t]),[n,o]})(R.nothing(),o);return(0,l.useEffect)((()=>{e.isNothing()&&s.isJust()?a(R.nothing()):!e.isJust()||!s.isNothing()&&R.equals(e,t.current)||e.asyncChain(n).then(a),t.current=e}),[e,a]),s}},F=P((async({apiKey:e="ff9qgdngragp",userData:t,token:n})=>{const o=new L.StreamChat(e);return await o.connectUser(t,null!=n?n:o.devToken(t.id)),o}),(e=>{console.debug("user disconnected"),e.disconnectUser()})),$=P((async({chatClient:e,channelId:t})=>{const n=e.channel("livestream",t,{image:"https://www.drupal.org/files/project-images/react.png",name:t});return await n.watch(),n}),(e=>{console.debug("channel closed"),e.clean()})),U=({channelId:e,credentials:t})=>{const n=F((0,l.useMemo)((()=>R.from(t).map((e=>({userData:e.userData,token:e.token})))),[t]));return $((0,l.useMemo)((()=>n.map((t=>({chatClient:t,channelId:e})))),[n,e])).chain((e=>n.map((t=>({chatChannel:e,chatClient:t})))))},J=({userName:e,userId:t})=>(0,l.useMemo)((()=>({userData:{id:t,name:e,image:`https://getstream.io/random_png/?id=${t}&name=${e}`},token:void 0})),[e,t]),V=()=>{const[,e]=(0,l.useState)(0);return(0,l.useCallback)((()=>e((e=>e+1))),[])};function A(e){return t=>{const{chatChannel:n}=t,o=V();return c().useEffect((()=>{const e=e=>{console.debug("Channel event",e),o()};return n.on(e),()=>n.off(e)}),[n]),c().createElement(e,Object.assign({},t))}}const D=z(A((({chatClient:e,chatChannel:t})=>c().createElement(O.Chat,{client:e,theme:"str-chat__theme-light",customClasses:{chat:j.css`
          height: 100%;
          .str-chat__send-button {
            display: block !important;
          }
        `}},c().createElement(O.Channel,{channel:t},c().createElement(O.Window,null,c().createElement(O.ChannelHeader,null),c().createElement(O.MessageList,null),c().createElement(O.MessageInput,null)),c().createElement(O.Thread,null)))))),B=({userInfo:e,channelId:t})=>{const{userId:n,userName:o}=e,s=J({userId:n,userName:o}),a=U({channelId:t,credentials:s}).inner();return c().createElement(N,null,c().createElement(D,Object.assign({},a)))};var G=n(60721),Y=n(52355),q=n.n(Y),W=n(50955),H=n.n(W);const K=H().button`
  background-color: transparent;
  border: none;
`;var Z=n(70667);const Q=({code:e,styles:t})=>c().createElement(Z.CodeBlock,{language:"python",text:e,showLineNumbers:!1,customStyle:{fontFamily:'Menlo, Consolas, "DejaVu Sans Mono", monospace',fontWeight:400,...t}});var X=n(17977),ee=n(95643),te=n(73127),ne=n(86010);const oe=c().createContext(void 0),se=()=>{const e=c().useContext(oe);return q()(e,"useUserCodeContext must be used within a UserCodeProvider"),e},ae=({code:e,children:t})=>c().createElement(oe.Provider,{value:e},t),re=(e,t)=>n=>c().createElement(e,Object.assign({},t,n)),ie=({popoverText:e,children:t,popoverTimeout:n=5e3})=>{const[o,s]=(0,l.useState)(!1),a=c().useRef(null);return c().createElement(_.Popover,{opened:o},c().createElement(_.Popover.Target,null,c().createElement("div",{onClick:()=>{a.current&&clearTimeout(a.current),s(!0),a.current=setTimeout((()=>{s(!1)}),n)}},t)),c().createElement(_.Popover.Dropdown,{p:"xs"},c().createElement(_.Text,{size:"sm"},e)))};var le=n(55568);const ce=re(H()(_.Flex,{shouldForwardProp:()=>!0})`
    position: absolute;
    top: 8px;
    right: 8px;
    height: 36px;
    border-radius: 18px;
    padding: 6px 12px;
    background-color: #ffffff;
    border: 1px solid #ebebeb;

    > * {
      display: inline-flex;
      align-items: center;
      opacity: 0.5;
      cursor: pointer;
      &:hover {
        opacity: 1;
      }
    }
  `,{direction:"row",align:"center"}),de=re(_.Text,{size:"sm",weight:"bold",ml:"2px"}),ue=re(te.FontAwesomeIcon,{size:"lg"}),me=c().memo((e=>{var t,n,o,s,a,r,i,d,u,m,h;const{handleReaction:p,handleOpenThread:g,handleRetry:v,initialMessage:f,message:y,messageWrapperRef:x,onMentionsClickMessage:b,onMentionsHoverMessage:w,onUserClick:C,onUserHover:E,threadList:I}=e,{client:k}=(0,O.useChatContext)("MessageTeam"),{userId:S}=se(),[M,N]=(0,le.useLocalStorage)({key:"viewdReplyCounts",defaultValue:{},getInitialValueInEffect:!1,deserialize:JSON.parse}),j=e=>{var t,n;return null!==(n=null===(t=y.own_reactions)||void 0===t?void 0:t.some((t=>t.user&&t.type===e&&k.userID===t.user.id)))&&void 0!==n&&n},T=j("like"),z=null!==(t=y.reply_count)&&void 0!==t?t:0,L=null!==(o=null===(n=y.reaction_counts)||void 0===n?void 0:n.like)&&void 0!==o?o:0,R=(null===(s=y.codeMetadata)||void 0===s?void 0:s.userId)===S,P=R?null!==(a=M[y.id])&&void 0!==a?a:0:void 0,F=R&&z!==P;return(0,l.useEffect)((()=>()=>{F&&N((e=>({...e,[y.id]:z})))}),[R,P,z]),y.deleted_at||!y.codeMetadata?null:c().createElement("div",{className:(0,ne.Z)("str-chat__message","str-chat__message-team","str-chat__message-team--single",{"pinned-message":y.pinned,[`str-chat__message-team--${y.status}`]:y.status,[`str-chat__message-team--${y.type}`]:y.type,"str-chat__message--has-attachment":!!(null===(r=y.attachments)||void 0===r?void 0:r.length),threadList:I}),ref:x,style:{padding:"5px 10px"}},c().createElement("div",{className:"str-chat__message-team-group"},c().createElement(_.Flex,{direction:R?"row-reverse":"row",align:"center",justify:R?"right":"left",mb:"xs"},c().createElement(O.Avatar,{image:null===(i=y.user)||void 0===i?void 0:i.image,name:(null===(d=y.user)||void 0===d?void 0:d.name)||(null===(u=y.user)||void 0===u?void 0:u.id),onClick:C,onMouseOver:E,size:34}),c().createElement("div",{className:"str-chat__message-team-meta"},c().createElement("div",{className:"str-chat__message-team-author",onClick:C},c().createElement(_.Text,{weight:"bold"},(null===(m=y.user)||void 0===m?void 0:m.name)||(null===(h=y.user)||void 0===h?void 0:h.id),R&&" (You)"),"error"===y.type&&c().createElement("div",{className:"str-chat__message-team-error-header"},"Only visible to you")),c().createElement("div",{style:{lineHeight:1}},c().createElement(O.MessageTimestamp,null)))),c().createElement("div",null,y.quoted_message&&c().createElement(O.QuotedMessage,null),y.text&&c().createElement("div",{className:(0,ne.Z)("str-chat__message-team-text",{"str-chat__message-team-text--is-emoji":(0,O.isOnlyEmojis)(y.text)}),onClick:b,onMouseOver:w,style:{position:"relative"}},!f&&(e=>"sending"!==e.status&&"failed"!==e.status&&"system"!==e.type&&"ephemeral"!==e.type&&"error"!==e.type)(y)&&c().createElement(ce,{gap:"md"},c().createElement("span",{onClick:e=>{navigator.clipboard.writeText(y.text).then((async()=>{if(!j("love"))return p("love",e)}))},title:"Copy Code"},c().createElement(ie,{popoverText:"Copied!",popoverTimeout:1e3},c().createElement(ue,{icon:X.faCopy}))),c().createElement("span",{onClick:e=>p("like",e),title:T?"Unlike":"Like"},c().createElement(ue,{icon:T?ee.faThumbsUp:X.faThumbsUp}),L>0&&c().createElement(de,null,L)),c().createElement("span",{onClick:g,title:z>0?"Show Replies"+(F?`(${y.reply_count-P} new replies)`:""):"Start a Thread"},c().createElement(ue,{icon:z>0?ee.faComments:X.faComments}),z>0&&c().createElement(de,null,z),F&&c().createElement(te.FontAwesomeIcon,{color:"red",opacity:.75,icon:ee.faCircle,size:"xs",fade:!0,style:{marginLeft:"4px"}}))),c().createElement(_.Box,{style:{borderRadius:"20px",overflow:"hidden"}},c().createElement(Q,{code:y.text,styles:R?{background:"rgb(240, 240, 240)"}:{}}))),"failed"===y.status&&c().createElement("button",{className:"str-chat__message-team-failed",onClick:403!==y.errorStatusCode?()=>v(y):void 0},c().createElement(O.ErrorIcon,null),403!==y.errorStatusCode?"Message Failed · Click to try again":"Message Failed · Unauthorized"))))}),O.areMessageUIPropsEqual),he=e=>{const t=(0,O.useMessageContext)("CodeMessage"),n=(0,l.useRef)(null),o=(0,l.useRef)(null),s=e.message||t.message,{isReactionEnabled:a,onReactionListClick:r,showDetailedReactions:i}=(0,O.useReactionClick)(s,n,o);return c().createElement("div",{className:s.pinned?"pinned-message":"unpinned-message"},c().createElement(me,Object.assign({},t,{isReactionEnabled:a,messageWrapperRef:o,onReactionListClick:r,reactionSelectorRef:n,showDetailedReactions:i,handleOpenThread:e=>{t.handleOpenThread(e)}},e)))},pe=e=>{const t=(0,O.useMessageContext)("CodeMessage"),n=e.message||t.message;return(null==n?void 0:n.codeMetadata)?c().createElement(he,Object.assign({},e)):c().createElement(_.Flex,{direction:"row",ml:"md"},c().createElement(O.MessageSimple,Object.assign({},e)))},ge=H().span`
  cursor: pointer;
  width: 16px;
  height: 16px;
  margin: 6px;
  opacity: 0.5;
  &:hover {
    opacity: 1;
  }
`,ve=e=>{const{closeThread:t}=e;return c().createElement(ge,{onClick:t,title:"Close Thread",style:{position:"absolute",top:"0px",left:"0px",zIndex:1e4}},c().createElement(te.FontAwesomeIcon,{icon:ee.faClose}))};var fe=n(58160);const ye=async(e,t,n)=>new Promise(((o,s)=>{{0===e.length&&s(Error("no prompt given"));const a=`${y}/v1/chat/completions`,r={model:"gpt-3.5-turbo",messages:e,temperature:.75,top_p:.95,max_tokens:1e3,stream:!0,n:1},i=new fe.SSE(a,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},method:fe.SSEOptionsMethod.POST,payload:JSON.stringify(r)});let l="";const c=e=>{l+=e,n(e)},d=()=>{i.close(),o(l)};i.addEventListener("message",(e=>{xe(e.data).forEach((e=>{if(null===e)return void d();const t=e.choices[0].delta.content;t&&c(t)}))})),i.addEventListener("readystatechange",(e=>{e.readyState>=2&&d()})),i.stream()}})),xe=e=>e.split("\n\n").filter(Boolean).map((e=>{const t=e.split("\n").map((e=>e.replace(/^data: /,""))).join("");if("[DONE]"===t)return null;try{return E.parse(JSON.parse(t))}catch(e){return console.error("Error parsing response: ",e),null}})),be=e=>{const{systemPrompt:t,userPrompt:n,codeList:o,cacheKey:s}=e,{result:a,isLoading:r,isFulfilled:i,start:c}=(e=>{const[t,n]=(0,l.useState)(""),{userName:o}=se(),s=(0,l.useMemo)((()=>"string"==typeof e?[{role:"user",content:e}]:[{role:"system",content:e.systemPrompt},{role:"user",content:e.userPrompt}]),[JSON.stringify(e)]),a=(0,l.useCallback)((()=>(async(e,t,n)=>{const o=await(async(e,t)=>{const n=sessionStorage.getItem("codepeers_proxy_auth");if(n)return n;const o=await fetch(`${y}/479ed80a-452b-40a3-bfcc-46f33c106aac/register/${e}`),s=await o.text();return sessionStorage.setItem("codepeers_proxy_auth",s),s})(e);return ye(t,o,n)})(o,s,(e=>n((t=>t+e))))),[s]);(0,l.useEffect)((()=>()=>n("")),[s]);const{isLoading:r,isFulfilled:i,run:c}=(0,G.useAsync)({deferFn:a});return{isLoading:r,result:t,isFulfilled:i,start:c}})({systemPrompt:t,userPrompt:n+o.map(((e,t)=>`[${t}] ${e.code}\n`)).join("\n")}),[d,u]=(0,le.useLocalStorage)({key:s,deserialize:we,getInitialValueInEffect:!1}),m=(0,l.useMemo)((()=>{if(d&&Ce(o,d))return d.map((e=>o.findIndex((t=>t.id===e))))}),[d,o]);return{isLoading:!m&&r,sortedIndex:m||(()=>{if(r||!i)return;const e=new RegExp(`\\[\\d+(,\\W*\\d+){${Math.max(o.length-1,0)}}\\]`),t=a.match(e);if(!t)return void console.warn("Invalid output format: "+a);const n=JSON.parse(t[0]),s=x.z.array(x.z.number()).parse(n);return u(s.map((e=>o[e].id))),s})(),start:(0,l.useCallback)((()=>{m||c()}),[m,c])}},we=e=>{const t=x.z.array(x.z.string());try{return t.parse(JSON.parse(e))}catch(e){return}},Ce=(e,t)=>{if(t.length!==e.length)return!1;const n=new Set(e.map((e=>e.id)));return t.every((e=>n.has(e)))},Ee=()=>{const e=new Array(36);for(let t=0;t<36;t++)e[t]=Math.floor(16*Math.random());return e[14]=4,e[19]=e[19]&=-5,e[19]=e[19]|=8,e[8]=e[13]=e[18]=e[23]="-",e.map((e=>e.toString(16))).join("")},_e=(e,t=!1)=>(t?e.toLowerCase():e).replace(/(?:^|\s|["'([{])+\S/g,(e=>e.toUpperCase())),Ie=({myCode:e,handleSubmit:t,isUpdate:n})=>{const o=n?"update":"submit";return(0,k.jsx)(l.Fragment,null,(0,k.jsx)(_.Divider,{my:"sm"}),(0,k.jsx)(_.Text,{color:"gray.500",size:"sm"},"Do you want to ",o," your code?"),(0,k.jsx)(_.Flex,{direction:"row",align:"flex-end"},(0,k.jsx)(_.Box,{style:{flex:1}},(0,k.jsx)(Q,{code:e.code})),(0,k.jsx)(K,{onClick:t,title:o.toUpperCase(),css:k.css`
            svg path {
              fill: #006cff;
            }
          `},(0,k.jsx)(O.SendIconV2,null))))},ke=z(A((({chatClient:e,chatChannel:t,myCode:n})=>{const[o,s]=c().useState("likes"),a=t.state.messages.filter((e=>!e.deleted_at)),r=(0,l.useMemo)((()=>{return e=({text:e,codeMetadata:t,id:n})=>{var o;return e&&t?{id:null!==(o=t.submissionId)&&void 0!==o?o:n,code:e}:void 0},a.flatMap((t=>{const n=e(t);return n?[n]:[]}));var e}),[a]),{sortedIndex:i,isLoading:d}=(e=>{const{sortedIndex:t,start:n,isLoading:o}=be({systemPrompt:"You are an intelligent Coding Assistant that can read and analyse code in terms of algorithm complexity. You are given a list of code snippets that implements the same algorithm and you need to sort them by time complexity.",userPrompt:'Please help me analyse time complexity for a series of code snippets written in Python. Each snippet has a format of `[<order_number>] <multiline_code>\\n`, and you are supposed to output ONLY a permutation of order numbers of the given snippets in ascending order of the time complexity of the corresponding code snippet in the format of JSON number array, e.g. [1,0,2] (no spaces in between). Therefore, the code snippets are sorted from the fastest to the slowest in terms of the big-O notation. If you find two snippets have the same time complexity, you can output either one of them first.\nPlease be reminded that, you MUST ONLY output ONE number array and NO MORE.\nFor example, if the input is "[0] {...some code...}\\n[1] {...some code...}\\n[2] {...some code...}\\n[3] {...some code...}\\n", in your unspoken mind, you can analyse each of them and the algorithms they contain,then you find that their time complexity are [0]:"O(n^2)", [1]:"O(n)", [2]:"O(n^3)", [3]:"O(n)", as you already know that O(n) is smaller than O(n^2), and O(n^2) is smaller than O(n^3) in big-O notation, therefore, the answer should be either [1,3,0,2] or [3,1,0,2].\nThe example is only a demonstration for 4 code snippets. Note that your response should be equal length of the input.\nNow, given the following code snippets, please give me the FINAL answer for this question without any explanation:\n',codeList:e,cacheKey:"complexity-sort"});return(0,l.useEffect)((()=>{e.length>0&&n()}),[JSON.stringify(e)]),{isLoading:o,sortedIndex:t}})(r),{sortedIndex:u,isLoading:m}=((e,t)=>{const{sortedIndex:n,start:o,isLoading:s}=be({systemPrompt:"You are an intelligent Coding Assistant that can read and analyse code in terms of logical similarity. You are given a list of code snippets that implements the same algorithm and you need to analyse how similar they are in terms of the essential logic.",userPrompt:`Please help me analyse logical similarity for a series of code snippets written in Python in contrast of my own implementation. I will provide you my implementation first, with the format of \`[my_code] <multiline_code>\\n\`. Then I will give you a series of candidate code snippets, and each snippet has a format of \`[<order_number>] <multiline_code>\\n\`, and you are supposed to output ONLY a permutation of order numbers of the candidate snippets in descending order of logical similarity to my implementation of the corresponding code snippet in the format of JSON number array, e.g. [1,0,2] (no spaces in between). Therefore, candidate code snippets can be sorted from the most similar to mine to the most different logically. If you find two snippets that you think equally similar to mine, you can output either one of them first.\nFor example, if the input is "[my_code] def foo(n):\\n    return bool(n % 2)\\n\\n[0] def is_odd(x):\\n    return math.fmod(x, 2) > 0\\n\\n[1] def bar(a):\\n    return a > (2 * math.floor(a/2))\\n\\n", you can analyse each of them and the algorithms they contain at first.In this case, my code and candidate code [0] are logically identical since we both used modulo operation to check if a number is odd, in spite of different function names, arguments, and what specific modulo calculation we used. but candidate code [1] is different since it checked if a number is odd by comparing it with the result of the nearest even number. As the result, candidate code 0 is the most similar to mine, and candidate code 1 is the most different logically, so the output should be [0,1].\nYou can assume all inputs are invalid. You should NOT output any explanations, or natural language content other than a number array.\n\nNow, please analyse the following code snippets and output the any one of the viable permutations of their order number:\n[my_code] ${e}\n`,codeList:t,cacheKey:"similarity-sort"});return(0,l.useEffect)((()=>{t.length>0&&o()}),[e,JSON.stringify(t)]),{isLoading:s,sortedIndex:n}})(n.code,r),h=(()=>{const e=[...a];switch(o){case"likes":return e.sort(((e,t)=>{var n,o,s,a;return(null!==(o=null===(n=t.reaction_counts)||void 0===n?void 0:n.like)&&void 0!==o?o:0)-(null!==(a=null===(s=e.reaction_counts)||void 0===s?void 0:s.like)&&void 0!==a?a:0)}));case"comments":return e.sort(((e,t)=>{var n,o;return(null!==(n=t.reply_count)&&void 0!==n?n:0)-(null!==(o=e.reply_count)&&void 0!==o?o:0)}));case"copies":return e.sort(((e,t)=>{var n,o,s,a;return(null!==(o=null===(n=t.reaction_counts)||void 0===n?void 0:n.love)&&void 0!==o?o:0)-(null!==(a=null===(s=e.reaction_counts)||void 0===s?void 0:s.love)&&void 0!==a?a:0)}));case"similarity":return q()(!!u),u.map((e=>a[e]));case"complexity":return q()(!!i),i.map((e=>a[e]));case"lines-fewest":return a.sort(((e,t)=>{var n,o,s,a;return(null!==(o=null===(n=e.text)||void 0===n?void 0:n.split("\n").length)&&void 0!==o?o:0)-(null!==(a=null===(s=t.text)||void 0===s?void 0:s.split("\n").length)&&void 0!==a?a:0)}));case"lines-most":return a.sort(((e,t)=>{var n,o,s,a;return(null!==(o=null===(n=t.text)||void 0===n?void 0:n.split("\n").length)&&void 0!==o?o:0)-(null!==(a=null===(s=e.text)||void 0===s?void 0:s.split("\n").length)&&void 0!==a?a:0)}))}})(),p=h.find((e=>{var t;return(null===(t=e.codeMetadata)||void 0===t?void 0:t.userId)===n.userId})),g=(null==p?void 0:p.text)===n.code,{run:v}=(0,G.useAsync)({deferFn:(0,l.useCallback)((()=>{const{code:o,...s}=n,a={text:o,codeMetadata:s};return p?e.updateMessage({...a,id:p.id}):t.sendMessage({...a,id:s.submissionId})}),[t,e,p,n])});return(0,k.jsx)(_.Flex,{direction:"column",h:"100%",align:"stretch"},(0,k.jsx)(_.Box,{style:{flexGrow:1,overflowY:"auto"}},(0,k.jsx)(O.Chat,{client:e,theme:"str-chat__theme-light",customClasses:{chat:j.css`
              height: 100%;
              .str-chat__send-button {
                display: block !important;
              }
            `}},(0,k.jsx)(O.Channel,{channel:t,Message:he,ThreadStart:Me,ThreadHeader:ve},(0,k.jsx)(O.Window,null,(0,k.jsx)(_.Flex,{direction:"row",align:"center",justify:"space-between",p:"md"},(0,k.jsx)(_.Text,null,"Total Code Submissions: ",h.length),(0,k.jsx)(_.Select,{label:"Sort By",value:o,data:[{label:"Most Likes",value:"likes"},{label:"Most Comments",value:"comments"},{label:"Most Copies",value:"copies"},{label:"Most Similar 🤖"+(m?" (loading)":""),value:"similarity",disabled:m||!u},{label:"Fastest 🤖"+(d?" (loading)":""),value:"complexity",disabled:d||!i},{label:"Longest",value:"lines-most"},{label:"Shortest",value:"lines-fewest"}],onChange:e=>s(e)})),(0,k.jsx)(O.MessageList,{messages:h,disableDateSeparator:!0})),(0,k.jsx)(Ne,{Message:pe})))),!g&&(0,k.jsx)(_.Box,{style:{flexGrow:0}},(0,k.jsx)(Ie,{myCode:n,handleSubmit:v,isUpdate:!!p})))}))),Se=({code:e})=>{const{topicId:t,userId:n,userName:o}=e,s=J({userId:n,userName:o}),a=U({channelId:`review-${t}`,credentials:s}).inner();return(0,k.jsx)(ae,{code:e},(0,k.jsx)(N,null,(0,k.jsx)(ke,{chatChannel:null==a?void 0:a.chatChannel,chatClient:null==a?void 0:a.chatClient,myCode:e})))},Me=()=>null,Ne=e=>(0,k.jsx)("div",{style:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"stretch"}},(0,k.jsx)(O.Thread,Object.assign({},e)));var je=n(44886);const Oe=(e,t,n)=>{let o=!1;return{label:e,isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>o,execute:s=>{const a=t(s);if(null===a)return;const r=n(a);null!==r&&(Fe(e,r),o=!o)}}},Te=e=>{try{const{userInfo:t,shareableCode:{topicId:n}}=Le(e);return c().createElement(B,{userInfo:t,channelId:`chat-${n}`})}catch(e){return alert("Current cell or notebook does not support Codepeers sharing"),null}},ze=e=>{try{const{userInfo:t,shareableCode:n,opts:o}=Le(e);return o.adminView?c().createElement(B,{userInfo:t,channelId:`review-${n.topicId}`}):c().createElement(Se,{code:n})}catch(e){return alert("Current cell or notebook does not support Codepeers sharing"),null}},Le=e=>{var t,n,o,s;const a=Re(e);q()(a,"Current cell or notebook does not support Codepeers sharing");const r=(()=>{const e=sessionStorage.getItem(f);if(e)return{userId:e.toLowerCase(),userName:_e(e)};const{user_id:t,user_name:n}=a;return q()(t&&n,"user_id and user_name must be defined under single-user setup"),{userId:t,userName:n}})();return{userInfo:r,shareableCode:{...r,documentId:a.document_id,topicId:a.topic_id,submissionId:null!==(t=a.submission_id)&&void 0!==t?t:Ee(),code:null!==(o=null===(n=e.content.activeCell)||void 0===n?void 0:n.editor.model.value.text)&&void 0!==o?o:""},opts:{adminView:null!==(s=a.admin_view)&&void 0!==s&&s}}},Re=e=>{var t,n;const o=Pe(e);if(!o)return;const s=null!==(n=null===(t=e.content.activeCell)||void 0===t?void 0:t.model.metadata.toJSON())&&void 0!==n?n:{},a=w.safeParse(s[v]);if(!a.success)return void console.error("cell metadata violation",a.error);const r=je.PageConfig.getToken()||void 0;return{...o,...a.data,loginToken:r}},Pe=e=>{var t,n;const o=null!==(n=null===(t=e.model)||void 0===t?void 0:t.metadata.toJSON())&&void 0!==n?n:{},s=b.safeParse(o[v]);if(s.success)return s.data;console.error("notebook metadata violation: ",s.error)},Fe=(e,t)=>{(0,o.showDialog)({title:e,body:t,host:document.body,buttons:[],hasClose:!0,renderer:void 0})};var $e=n(46591),Ue=n(31258);const Je=x.z.object({user_name:x.z.string()});function Ve(e,t,n){const o=e.currentWidget;return!1!==n.activate&&o&&t.activateById(o.id),o}const Ae={id:u,autoStart:!0,requires:[a.INotebookTracker],optional:[r.ISettingRegistry,o.IToolbarWidgetRegistry,i.ITranslator],activate:(e,t,n,a,r)=>{(async()=>{const{user_name:e}=await(async()=>{const e=await async function(e="",t={}){const n=Ue.ServerConnection.makeSettings(),o=je.URLExt.join(n.baseUrl,d,e);let s;try{s=await Ue.ServerConnection.makeRequest(o,t,n)}catch(e){throw new Ue.ServerConnection.NetworkError(e)}let a=await s.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new Ue.ServerConnection.ResponseError(s,a.message||a);return a}("current_user");return Je.parseAsync(e)})();e&&(console.debug("Got login user: ",e),sessionStorage.setItem(f,e))})();const l=n&&a?(0,o.createToolbarFactory)(a,n,s.CellBarExtension.FACTORY_NAME,Ae.id,null!=r?r:i.nullTranslator):void 0;e.docRegistry.addWidgetExtension("Notebook",new s.CellBarExtension(e.commands,l)),e.commands.addCommand(h,Oe("Codepeers: Review",(n=>Ve(t,e.shell,n)),ze)),e.commands.addCommand(m,Oe("Codepeers: Ideas",(n=>Ve(t,e.shell,n)),Te)),new $e.LabIcon({name:p,svgstr:'<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n    <svg fill="#000000" width="800px" height="800px" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n        <path class="jp-icon3" fill="" d="M7 13.33a7 7 0 1 1 6 0V16H7v-2.67zM7 17h6v1.5c0 .83-.67 1.5-1.5 1.5h-3A1.5 1.5 0 0 1 7 18.5V17zm2-5.1V14h2v-2.1a5 5 0 1 0-2 0z"/>\n    </svg>'}),new $e.LabIcon({name:g,svgstr:'<?xml version="1.0" encoding="utf-8"?>\x3c!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools --\x3e\n    <svg fill="#000000" width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10.3 6.74a.75.75 0 01-.04 1.06l-2.908 2.7 2.908 2.7a.75.75 0 11-1.02 1.1l-3.5-3.25a.75.75 0 010-1.1l3.5-3.25a.75.75 0 011.06.04zm3.44 1.06a.75.75 0 111.02-1.1l3.5 3.25a.75.75 0 010 1.1l-3.5 3.25a.75.75 0 11-1.02-1.1l2.908-2.7-2.908-2.7z"/><path fill-rule="evenodd" d="M1.5 4.25c0-.966.784-1.75 1.75-1.75h17.5c.966 0 1.75.784 1.75 1.75v12.5a1.75 1.75 0 01-1.75 1.75h-9.69l-3.573 3.573A1.457 1.457 0 015 21.043V18.5H3.25a1.75 1.75 0 01-1.75-1.75V4.25zM3.25 4a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25h2.5a.75.75 0 01.75.75v3.19l3.72-3.72a.75.75 0 01.53-.22h10a.25.25 0 00.25-.25V4.25a.25.25 0 00-.25-.25H3.25z"/></svg>'})}},De=Ae}}]);