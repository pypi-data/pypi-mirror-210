"use strict";(self.webpackChunkmarpyter=self.webpackChunkmarpyter||[]).push([[427],{9427:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var r=n(14246),s=n(68501),o=n(51486),i=n(94995),d=n(24499);class a extends d.DocumentWidget{constructor(){super(...arguments),this.onResize=e=>{window.dispatchEvent(new Event("resize"))}}}var c=n(18778),l=n(97930),m=n(69406),h=n(25567),p=n.n(h);class u extends o.RenderedHTMLCommon{constructor(e){super(e),this.addClass("jp-RenderedMarp")}render(e){return async function(e){const{host:t,source:n,...r}=e;if(!n)return void(t.textContent="");const s=new(p())({html:!0}),{html:i,css:d}=s.render(n,{htmlAsArray:!1}),a=document.createElement("div");await(0,o.renderHTML)({host:a,source:i,...r});const c=`<style>.marpit{  display: grid;gap: 10px;}</style>\n<style>${d}</style>${a.innerHTML}`;t.innerHTML=c}({host:this.node,source:String(e.data[this.mimeType]),trusted:e.trusted,resolver:this.resolver,sanitizer:this.sanitizer,linkHandler:this.linkHandler,shouldTypeset:this.isAttached,latexTypesetter:this.latexTypesetter})}}const y="text/marp",v={safe:!0,mimeTypes:[y],defaultRank:60,createRenderer:e=>new u(e)};class w extends c.Widget{constructor(e){super({node:document.createElement("iframe")}),this._ready=new l.PromiseDelegate,this._monitor=null,this._context=e.context,this._renderer=e.renderer,this._context.ready.then((async()=>{this._renderContent(),this._monitor=new m.ActivityMonitor({signal:this._context.model.contentChanged}),this._monitor.activityStopped.connect(this.update,this),this._ready.resolve(void 0)})),this.addClass("marpyter-viewer")}get ready(){return this._ready.promise}get htmlContent(){return this._htmlContent}dispose(){this.isDisposed||(this._monitor&&this._monitor.dispose(),this._monitor=null,super.dispose())}onUpdateRequest(e){this._context.isReady&&!this.isDisposed&&this._renderContent()}_renderContent(){var e;const t=this._context.model.toString();if(!this._renderer)return;const n=null===(e=this.node.contentWindow)||void 0===e?void 0:e.document.body;n&&this._renderer.render({trusted:!0,data:{[y]:t},metadata:{},setData:()=>{}}).then((()=>{this._htmlContent=n.innerHTML=this._renderer.node.innerHTML}))}}var _=n(38844);class g extends _.Toolbar{constructor(e){super(e),e.commands&&this.addItem("download",new s.CommandToolbarButton({id:"marpyter:download",label:"Save HTML",icon:_.saveIcon,commands:e.commands}))}}class x extends d.ABCWidgetFactory{constructor(e){super(e),this._rendermime=e.rendermime,this._commands=e.commands}createNewWidget(e){let t;this._rendermime&&(t=this._rendermime.clone({resolver:e.urlResolver}).createRenderer(y));const n=new w({context:e,renderer:t}),r=new g({commands:this._commands});return new a({context:e,content:n,toolbar:r})}}const C=[{id:"marpyter:plugin",description:"A JupyterLab extension.",autoStart:!0,provides:new l.Token("marpyter:IMarpViewerTracker","A widget tracker for marpyter."),requires:[o.IRenderMimeRegistry,i.ITranslator],optional:[r.ILayoutRestorer],activate:(e,t,n)=>{console.log("JupyterLab extension marpyter is activated!");const r=n.load("jupyterlab"),{docRegistry:o}=e;t.addFactory(v);const i=new s.WidgetTracker({namespace:"marpyter-widget"});e.commands.addCommand("marpyter:download",{execute:e=>{var t,n,r,s,o,d;const a=i.currentWidget;if(a){const e=a.content.htmlContent;if(!e)return;const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e));const c=null!==(d=null===(o=null===(s=null===(r=null===(n=null===(t=a.context.path.split("\\"))||void 0===t?void 0:t.pop())||void 0===n?void 0:n.split("/"))||void 0===r?void 0:r.pop())||void 0===s?void 0:s.split("."))||void 0===o?void 0:o[0])&&void 0!==d?d:"Untitled";i.setAttribute("download",`${c}.html`),i.click()}}});const d=new x({name:"Marp Doc",label:r.__("Marp Preview"),fileTypes:["markdown"],rendermime:t,commands:e.commands});return d.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{i.save(t)})),i.add(t)})),o.addWidgetFactory(d),i}}]}}]);