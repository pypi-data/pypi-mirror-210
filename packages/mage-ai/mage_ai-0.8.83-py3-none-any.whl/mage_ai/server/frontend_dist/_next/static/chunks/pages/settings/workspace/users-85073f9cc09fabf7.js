(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2287],{63153:function(e,r,n){"use strict";n.d(r,{Z3:function(){return t},ms:function(){return u},s7:function(){return o}});var t=[{autoComplete:"username",label:"Username",required:!0,uuid:"username"},{autoComplete:"email",disabled:!1,label:"Email",required:!0,type:"email",uuid:"email"}],o="password_current",u=[{autoComplete:"current-password",label:"Current password",type:"password",uuid:o},{autoComplete:"new-password",label:"New password",type:"password",uuid:"password"},{autoComplete:"new-password",label:"Confirm new password",type:"password",uuid:"password_confirmation"}]},20582:function(e,r,n){"use strict";var t=n(82394),o=n(21831),u=n(75582),i=n(21764),s=n(82684),l=n(83455),a=n(60328),d=n(67971),c=n(87372),p=n(55378),f=n(86673),v=n(82944),w=n(81132),m=n(82531),O=n(66166),b=n(63153),h=n(9736),j=n(7715),y=n(96510),_=n(28598);function Z(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function g(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Z(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}r.Z=function(e){var r=e.disabledFields,n=e.hideFields,Z=e.newUser,P=e.onDeleteSuccess,x=e.onSaveSuccess,C=e.showDelete,S=e.title,E=e.user,D=(0,s.useState)(!0),N=D[0],k=D[1],A=(0,s.useState)({}),I=A[0],R=A[1],T=(0,s.useState)(null),M=T[0],q=T[1],U=(0,h.PR)()||{},F=U.id,H=U.owner,G=U.roles,L=w.K$.filter((function(e){return G!==w.No.ADMIN||F===(null===E||void 0===E?void 0:E.id)||e>w.No.ADMIN})),W=(0,l.Db)(Z?m.ZP.users.useCreate():m.ZP.users.useUpdate(null===E||void 0===E?void 0:E.id),{onSuccess:function(e){return(0,y.wD)(e,{callback:function(e){var r=e.user,n=(0,j.GL)(r,b.Z3.concat(b.ms).map((function(e){return e.uuid})));q(n),i.Am.success(Z?"New user created successfully.":"User profile successfully updated.",{position:i.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(r.id)}),null===x||void 0===x||x(n)},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,o=r.message,u=r.type;i.Am.error((null===n||void 0===n?void 0:n.error)||t||o,{position:i.Am.POSITION.BOTTOM_RIGHT,toastId:u})}})}}),V=(0,u.Z)(W,2),X=V[0],B=V[1].isLoading,K=(0,l.Db)(m.ZP.users.useDelete(null===E||void 0===E?void 0:E.id),{onSuccess:function(e){return(0,y.wD)(e,{callback:function(){null===P||void 0===P||P()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.message;alert(t),console.log(n)}})}}),Q=(0,u.Z)(K,2),$=Q[0],z=Q[1].isLoading,J=n?(0,o.Z)(n):[];Z&&J.push(b.s7);var Y=!J||!J.includes(b.s7),ee=(0,O.Z)(E);return(0,s.useEffect)((function(){!E||M&&(null===ee||void 0===ee?void 0:ee.id)===(null===E||void 0===E?void 0:E.id)||q((0,j.GL)(E,b.Z3.concat(b.ms).map((function(e){return e.uuid})))),null!==M&&void 0!==M&&M.password||null!==M&&void 0!==M&&M.password_confirmation?(null===M||void 0===M?void 0:M.password)!==(null===M||void 0===M?void 0:M.password_confirmation)?R({password_confirmation:"Password confirmation does not match."}):!Y||null!==M&&void 0!==M&&M.password_current?R(null):R({password_current:"This field is required."}):null!==M&&void 0!==M&&M.password_current&&Y?null!==M&&void 0!==M&&M.password&&null!==M&&void 0!==M&&M.password_confirmation?R(null):R({password:"This field is required.",password_confirmation:"This field is required."}):null!==M&&void 0!==M&&M.password_current||null!==M&&void 0!==M&&M.password||null!==M&&void 0!==M&&M.password_confirmation||R(null)}),[M,Y,E,ee]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(c.Z,{children:S||"Edit profile"}),(0,_.jsxs)("form",{children:[b.Z3.filter((function(e){var r=e.uuid;return!J||!J.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,u=e.required,i=e.type,s=e.uuid;return(0,_.jsx)(f.Z,{mt:2,children:(0,_.jsx)(v.Z,{autoComplete:r,disabled:n&&!Z,label:o,onChange:function(e){k(!1),q((function(r){return g(g({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:u,setContentOnMount:!0,type:i,value:(null===M||void 0===M?void 0:M[s])||""})},s)})),!(null!==E&&void 0!==E&&E.owner)&&(0,_.jsx)(f.Z,{mt:2,children:(0,_.jsxs)(p.Z,{disabled:null===r||void 0===r?void 0:r.includes("roles"),label:"Roles",onChange:function(e){if(k(!1),e.target.value===w.No.OWNER)q((function(e){return g(g({},e),{},{owner:!0,roles:null})}));else{var r={roles:e.target.value};H&&(r.owner=!1),q((function(e){return g(g({},e),r)}))}},primary:!0,setContentOnMount:!0,value:(null!==M&&void 0!==M&&M.owner?w.No.OWNER:null===M||void 0===M?void 0:M.roles)||(null===E||void 0===E?void 0:E.roles)||"",children:[L.map((function(e){return(0,_.jsx)("option",{value:e,children:w.gG[e]},e)})),!Z&&H&&(0,_.jsx)("option",{value:w.No.OWNER,children:w.gG[w.No.OWNER]},"owner_role")]})}),(0,_.jsxs)(f.Z,{mt:5,children:[(0,_.jsx)(c.Z,{children:Z?"Password":"Change password"}),b.ms.filter((function(e){var r=e.uuid;return!J||!J.includes(r)})).map((function(e){var r=e.autoComplete,n=e.disabled,o=e.label,u=e.required,i=e.type,s=e.uuid;return(0,_.jsx)(f.Z,{mt:2,children:(0,_.jsx)(v.Z,{autoComplete:r,disabled:n,label:o,meta:{error:null===I||void 0===I?void 0:I[s],touched:!(null===I||void 0===I||!I[s])},onChange:function(e){k(!1),q((function(r){return g(g({},r),{},(0,t.Z)({},s,e.target.value))}))},primary:!0,required:u,setContentOnMount:!0,type:i,value:(null===M||void 0===M?void 0:M[s])||""})},s)}))]}),(0,_.jsx)(f.Z,{mt:5,children:(0,_.jsxs)(d.Z,{children:[(0,_.jsx)(a.Z,{disabled:N||I&&!(0,j.Qr)(I),loading:B,onClick:function(){return X({user:M})},primary:!0,children:Z?"Create new user":"Update user profile"}),C&&H&&(0,_.jsx)(f.Z,{ml:1,children:(0,_.jsx)(a.Z,{danger:!0,loading:z,onClick:function(){window.confirm("Are you sure you want to delete ".concat(M.username||M.email,"?"))&&$()},children:"Delete user"})})]})})]})]})}},60921:function(e,r,n){"use strict";n.r(r);var t=n(77837),o=n(82394),u=n(38860),i=n.n(u),s=n(82684),l=n(34376),a=n(60328),d=n(87372),c=n(41788),p=n(30775),f=n(86673),v=n(58180),w=n(19711),m=n(20582),O=n(82531),b=n(66166),h=n(10503),j=n(49125),y=n(79585),_=n(63153),Z=n(9736),g=n(33766),P=n(7715),x=n(59e3),C=n(28598);function S(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function E(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){(0,o.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function D(){var e=(0,l.useRouter)(),r=(0,Z.PR)()||{},n=r.id,t=r.owner,o=(0,s.useState)(null),u=o[0],i=o[1],c=O.ZP.users.list({},{revalidateOnFocus:!1}),S=c.data,D=c.mutate,N=(0,s.useMemo)((function(){return(null===S||void 0===S?void 0:S.users)||[]}),[null===S||void 0===S?void 0:S.users]),k=O.ZP.users.detail(null===u||void 0===u?void 0:u.user_id,{},{revalidateOnFocus:!1}),A=k.data,I=k.mutate,R=null===A||void 0===A?void 0:A.user,T=(0,x.iV)(),M=(0,b.Z)(T);(0,s.useEffect)((function(){var e=T.add_new_user,r=T.user_id;if(!(0,P.Xy)(T,M)){var n=E(E({},M),T);r?n.user_id=r:delete n.user_id,e?n.add_new_user=e:delete n.add_new_user,i(n)}}),[T,M]);var q=null===u||void 0===u?void 0:u.add_new_user,U=(0,s.useMemo)((function(){return q?(0,C.jsx)(f.Z,{p:j.cd,children:(0,C.jsx)(m.Z,{newUser:!0,onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),D()},title:"Add new user",user:{}})}):R?(0,C.jsx)(f.Z,{p:j.cd,children:(0,C.jsx)(m.Z,{hideFields:[_.s7],onDeleteSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),D()},onSaveSuccess:function(){(0,g.u7)({add_new_user:null,user_id:null}),I(),D()},showDelete:!0,title:"Edit user",user:R})}):null}),[I,D,q,R]);return(0,C.jsxs)(p.Z,{after:U,afterHidden:!R&&!q,uuidItemSelected:y.eC,uuidWorkspaceSelected:y.WH,children:[t&&(0,C.jsx)(f.Z,{p:j.cd,children:(0,C.jsx)(a.Z,{beforeIcon:(0,C.jsx)(h.mm,{}),onClick:function(){return(0,g.u7)({add_new_user:1,user_id:null})},primary:!0,children:"Add new user"})}),(0,C.jsx)(f.Z,{p:j.cd,children:(0,C.jsx)(d.Z,{children:"Users"})}),(0,C.jsx)(v.Z,{columnFlex:[1,1,1],columns:[{uuid:"Username"},{uuid:"Email"},{uuid:"Role"}],isSelectedRow:function(e){var r;return(null===(r=N[e])||void 0===r?void 0:r.id)===(null===R||void 0===R?void 0:R.id)},onClickRow:function(r){var t,o=null===(t=N[r])||void 0===t?void 0:t.id;o===n?e.push("/settings/account/profile"):+(null===u||void 0===u?void 0:u.user_id)===o?(0,g.u7)({user_id:null}):(0,g.u7)({add_new_user:null,user_id:o})},rows:N.map((function(e){var r=e.email,n=e.roles_display,t=e.username;return[(0,C.jsx)(w.ZP,{bold:!0,children:t},"username"),(0,C.jsx)(w.ZP,{default:!0,children:r},"email"),(0,C.jsx)(w.ZP,{default:!0,children:n},"roles")]})),uuid:"pipeline-runs"})]})}D.getInitialProps=(0,t.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)}))),r.default=(0,c.Z)(D)},33766:function(e,r,n){"use strict";n.d(r,{O2:function(){return c},g_:function(){return f},u7:function(){return p}});var t=n(75582),o=n(82394),u=n(34376),i=n.n(u),s=n(59e3),l=n(24224);function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function d(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){(0,o.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var c="_offset";function p(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.preserveParams,o=r.pushHistory,u=r.replaceParams,l=(0,s.iV)(),a={};n&&n.forEach((function(e){l[e]&&(a[e]=l[e])}));var c,p=u?a:l;c=window.location.pathname;var f=o?i().push:i().replace,v=d(d({},p),e);Object.entries(e).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1];"undefined"!==typeof o&&null!==o||delete v[n]}));var w=(0,s.uM)(v);w.length>=1&&(w="?".concat(w));var m="".concat(c.split("?")[0]).concat(w);return f(i().router.pathname,m,{shallow:!0})}function f(e,r,n){var o=n.addingMultipleValues,u=n.isList,i=n.itemsPerPage,s=n.pushHistory,a=void 0!==s&&s,f=n.resetLimitParams,v=d({},e);o?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1];if(Array.isArray(o)){var u="".concat(n,"[]");v[u]=o.map(String)}})):u?Object.entries(r).forEach((function(e){var r=(0,t.Z)(e,2),n=r[0],o=r[1],u=String(o),i="".concat(n,"[]"),s=v[i];s&&Array.isArray(s)?(s=s.map(String)).includes(u)?v[i]=(0,l.Od)(s,(function(e){return e===u})):v[i]=s.concat(u):v[i]=[u]})):v=d(d({},v),r),f&&(v._limit=i||20,v[c]=0),p(v,{pushHistory:a})}},48673:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/workspace/users",function(){return n(60921)}])}},function(e){e.O(0,[844,7607,1424,1005,8180,3077,9774,2888,179],(function(){return r=48673,e(e.s=r);var r}));var r=e.O();_N_E=r}]);