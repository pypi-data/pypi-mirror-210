import{c as b,K as R,d as J,i as M,b as I,q as ne,o as x,e as N,f as p,t as V,u as F,l as z,_ as w,P as oe,r as P,B as K,Q as D,R as $,S as se,D as ae,w as H,v as X,h as ce,F as le,y as re,n as U,p as q,j as G,k as ie,s as de,x as ue,O as pe}from"./index-8eacdf1b.js";function Q(l){const _=/[\\]?@{([^}]*)}/g;function y(o){var m,c;const a={};for(let n=0;n<o.length-1;n++){const e=o[n],{componentId:s}=e,{type:t}=l.getComponentById(s);if(t!=="repeater"||n+1>=o.length)continue;const u=o.slice(0,n+1),S=o.slice(0,n+2),{instanceNumber:g}=S.at(-1),E=v(u,"repeaterObject");if(!E)continue;const B=Object.entries(E),j=v(u,"keyVariable"),O=v(u,"valueVariable");a[j]=(m=B[g])==null?void 0:m[0],a[O]=(c=B[g])==null?void 0:c[1]}return a}function i(o,a){if(o==null)return"";const m=y(a);return o.replace(_,(n,e)=>{if(n.charAt(0)=="\\")return n.substring(1);const s=e.trim();if(!s)return"";const t=l.evaluateExpression(s,m);return typeof t>"u"?"":typeof t=="object"?JSON.stringify(t):t})}function d(o){const{componentId:a}=o.at(-1),m=l.getComponentById(a);if(!m)return;const c={},{fields:n}=l.getComponentDefinition(m.type);if(n)return Object.keys(n).forEach(e=>{c[e]=b(()=>v(o,e))}),c}function v(o,a){var S;const{componentId:m}=o.at(-1),c=l.getComponentById(m);if(!c)return;const{fields:n}=l.getComponentDefinition(c.type),e=(S=c.content)==null?void 0:S[a],s=n[a].default,t=i(e,o),u=n[a].type;if(u==R.Object||u==R.KeyValue){if(!t)return JSON.parse(s)??null;if(typeof t!="string")return t;let g;try{g=JSON.parse(t)}catch{return JSON.parse(s)??null}return g}else if(u==R.Number){const g=parseFloat(t);return typeof g===void 0||Number.isNaN(g)?parseFloat(s??"0"):g}else return u==R.IdKey?e:typeof t>"u"||t===null||t===""?s??"":t}return{getEvaluatedFields:d}}const ve={class:"ChildlessPlaceholder"},fe={class:"content"},_e={class:"title"},me={key:0,class:"message"},ge=J({__name:"ChildlessPlaceholder",props:{componentId:null},setup(l){const _=l,y=10,i=M(I.core),{componentId:d}=ne(_),v=b(()=>i.getComponentById(d.value)),o=b(()=>i.getComponentDefinition(v.value.type)),a=(c,n)=>{const s=c.map(u=>i.getComponentDefinition(u)).map(u=>u==null?void 0:u.name);return`${s.slice(0,-1).join(", ")} ${s.length>1?n:""} ${s.at(-1)}`},m=b(()=>{const c=i.getContainableTypes(d.value);let n;return c.length<=y&&(n=`You can add ${a(c,"and")} components`),n});return(c,n)=>(x(),N("div",ve,[p("div",fe,[p("div",_e,[p("h2",null,"Empty "+V(F(o).name),1)]),F(m)?(x(),N("div",me,V(F(m)),1)):z("",!0)])]))}});const he=w(ge,[["__scopeId","data-v-b958fd6f"]]),ye=l=>()=>D("div",`Component type ${l} not supported.`),Ce={props:["componentId","instancePath","instanceData"],setup(l){const _=M(I.core),y=M(I.builderManager),i=l.componentId,d=b(()=>_.getComponentById(i)),v=oe[d.value.type];if(!v)return ye(d.value.type);const o=l.instancePath,a=l.instanceData,c=Q(_).getEvaluatedFields(o),n=b(()=>_.getComponents(i,!0)),e=b(()=>!!y&&y.getMode()!="preview"),s=()=>{if(!(n.value.length>0))return D(he,{componentId:d.value.id})},t=(r,f=0)=>D(Y,{componentId:r,key:`${r}:${f}`,instancePath:[...o,{componentId:r,instanceNumber:f}],instanceData:[...a,P(null)]}),u=(r=0,f=()=>!0,h=!1)=>{const C=T=>D("div",{"data-streamsync-slot-of-id":i,"data-streamsync-position":T}),k=e.value&&!h,L=n.value.filter(f).map((T,W)=>[t(T.id,r),...k?[C(W+1)]:[]]);return[...k?[C(0)]:[]].concat(L.flat())};$(I.evaluatedFields,c),$(I.componentId,i),$(I.isBeingEdited,e),$(I.instancePath,o),$(I.instanceData,a),$(I.renderProxiedComponent,t),$(I.getChildrenVNodes,u);const g={"data-streamsync-id":i,"data-streamsync-instance-path":(r=>r.map(f=>`${f.componentId}:${f.instanceNumber}`).join(","))(o)},E=P(!1);K(()=>(y==null?void 0:y.getSelectedId())==i,r=>{E.value=r}),K(()=>c,()=>{E.value=!1},{deep:!0});const B=b(()=>n.value.length==0),j=b(()=>_.isComponentVisible(i)),O=r=>{if(!r.startsWith("$"))return h=>_.forwardEvent(h,o);if(r.startsWith("$goToPage_")){const h=r.substring(10);return C=>_.setActivePageFromKey(h)}return null},Z=b(()=>{const r={};if(d.value.binding){const f=d.value.binding.eventType,h=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`;r[h]=C=>_.forwardEvent(C,o)}return Object.entries(d.value.handlers??{}).forEach(([f,h])=>{const C=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`;r[C]=O(h)}),r}),ee=b(()=>{var h;const r=(h=_.getComponentDefinition(d.value.type))==null?void 0:h.fields;if(!r)return;const f={};return Object.keys(r).forEach(C=>{r[C].applyStyleVariable&&c[C]&&(f[`--${C}`]=c[C].value)}),f}),te=function(){return{class:{component:!0,childless:B.value,selected:E.value},style:{...ee.value,...j.value?{}:{display:"none"}},...g,...Z.value,draggable:e.value}};return()=>{const r=e.value?s():void 0,f=({instanceNumber:k=0,componentFilter:L=()=>!0,positionlessSlot:T=!1})=>B.value?T?void 0:r:u(k,L,T),h={...te()};return D(v,h,{default:f})}}};const Y=w(Ce,[["__scopeId","data-v-60f60e1c"]]),A=l=>(q("data-v-cbbb395f"),l=l(),G(),l),be=A(()=>p("i",{class:"ri-notification-2-line ri-xl"},null,-1)),Ie={class:"counter"},Se=A(()=>p("div",{class:"balloonFlash"},null,-1)),$e={class:"main"},xe=A(()=>p("i",{class:"ri-close-line"},null,-1)),Ee=A(()=>p("i",{class:"ri-error-warning-fill ri-xl"},null,-1)),Te=[Ee],Ve={class:"content"},Ne={class:"title"},Pe={class:"time"},Be={class:"message"},De=J({__name:"RendererNotifications",setup(l){const y=M(I.core),i=P(!1),d=P(null),v=se([]),o=c=>{const{type:n,title:e,message:s,code:t}=c;v.unshift({type:n,title:e,message:s,code:t,timestampReceived:new Date}),v.splice(100),d.value.classList.remove("alert"),d.value.offsetWidth,d.value.classList.add("alert")};ae(()=>{y.addMailSubscription("notification",o)});const a=()=>{v.length!=0&&(i.value=!i.value)},m=()=>{v.splice(0),i.value=!1};return(c,n)=>H((x(),N("div",{class:"RendererNotifications",onClick:a},[p("div",{class:"balloon",ref_key:"balloon",ref:d,title:"Toggle notifications"},[be,p("div",Ie,V(v.length),1)],512),Se,H(p("div",$e,[p("div",{class:"clearContainer"},[p("button",{onClick:m},[xe,ce(" Clear all ")])]),(x(!0),N(le,null,re(v,(e,s)=>(x(),N("div",{class:"notification",key:s},[p("div",{class:U(["icon",e.type])},Te,2),p("div",Ve,[p("header",null,[p("strong",Ne,V(e.title),1),p("span",Pe,V(e.timestampReceived.toLocaleTimeString()),1)]),p("div",Be,V(e.message),1)])]))),128))],512),[[X,i.value]])],512)),[[X,v.length>0]])}});const Fe=w(De,[["__scopeId","data-v-cbbb395f"]]),Me=l=>(q("data-v-6abd8afe"),l=l(),G(),l),ke=Me(()=>p("div",{class:"loadingBar"},null,-1)),Re={class:"rootComponentArea"},we=J({__name:"ComponentRenderer",setup(l){const _=M(I.core),y=Q(_),i=_.getComponents();i.length==0&&console.error("No pages found.");const d=[{componentId:"root",instanceNumber:0}],v=[P(null)],o=P(i[0]),a=y.getEvaluatedFields(d),m=b(()=>{var e,s,t,u,S,g;return{"--accentColor":(e=a.accentColor)==null?void 0:e.value,"--emptinessColor":(s=a.emptinessColor)==null?void 0:s.value,"--containerBackgroundColor":(t=a.parentIdBackgroundColor)==null?void 0:t.value,"--primaryTextColor":(u=a.primaryTextColor)==null?void 0:u.value,"--secondaryTextColor":(S=a.secondaryTextColor)==null?void 0:S.value,"--separatorColor":(g=a.separatorColor)==null?void 0:g.value}}),c=b(()=>_.isMessagePending.value);K(()=>{var e;return(e=a.appName)==null?void 0:e.value},e=>{n(e)},{immediate:!0});function n(e){const s=_.getMode();let t;e&&s=="edit"?t=`${e} | Streamsync Builder`:!e&&s=="edit"?t="Streamsync Builder":e&&s=="run"?t=`${e}`:!e&&s=="run"&&(t="Streamsync App"),document.title=t}return(e,s)=>(x(),N("div",{class:U(["ComponentRenderer",{loadingActive:F(c)}]),tabindex:"-1",style:pe(F(m))},[ie(Fe,{class:"notifications"}),ke,p("div",Re,[o.value?(x(),de(Y,{key:0,"component-id":o.value.id,"instance-path":d,"instance-data":v},null,8,["component-id"])):z("",!0),ue(e.$slots,"default",{},void 0,!0)])],6))}});const Oe=w(we,[["__scopeId","data-v-6abd8afe"]]);export{Oe as default};
